//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: core/src/main/java/tuxkids/tuxblocks/core/utils/LowDiscrepancySequence.java
//
//  Created by Thomas on 7/26/13.
//

#include "IOSDoubleArray.h"
#include "IOSObjectArray.h"
#include "java/lang/Math.h"
#include "tuxkids/tuxblocks/core/utils/LowDiscrepancySequence.h"

@implementation TuxkidsTuxblocksCoreUtilsLowDiscrepancySequence

@synthesize dim = dim_;
@synthesize index = index_;
@synthesize x = x_;
@synthesize z = z_;

- (id)initWithInt:(int)dim {
  if ((self = [super init])) {
    self.dim = dim;
    index_ = 1;
    x_ = [IOSDoubleArray arrayWithLength:dim];
    z_ = [IOSDoubleArray arrayWithLength:dim];
  }
  return self;
}

- (NSString *)getName {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (void)restart {
  index_ = 1;
}

- (IOSDoubleArray *)nextPoint {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (void)nextPointWithDoubleArray:(IOSDoubleArray *)r {
  IOSDoubleArray *x = [self nextPoint];
  for (int k = 0; k < dim_; k++) (*[((IOSDoubleArray *) nil_chk(r)) doubleRefAtIndex:k]) = [((IOSDoubleArray *) nil_chk(x)) doubleAtIndex:k];
}

- (double)productWithInt:(int)i
                 withInt:(int)j
        withDoubleArray2:(IOSObjectArray *)r {
  double f = 1;
  for (int k = 0; k < dim_; k++) f *= (1 - [JavaLangMath maxWithDouble:[((IOSDoubleArray *) nil_chk([((IOSObjectArray *) nil_chk(r)) objectAtIndex:i])) doubleAtIndex:k] withDouble:[((IOSDoubleArray *) nil_chk([((IOSObjectArray *) nil_chk(r)) objectAtIndex:j])) doubleAtIndex:k]]);
  return f;
}

- (double)productWithInt:(int)i
        withDoubleArray2:(IOSObjectArray *)r {
  double f = 1;
  for (int k = 0; k < dim_; k++) f *= (1 - [((IOSDoubleArray *) nil_chk([((IOSObjectArray *) nil_chk(r)) objectAtIndex:i])) doubleAtIndex:k]);
  return f;
}

- (double)productSQWithInt:(int)i
          withDoubleArray2:(IOSObjectArray *)r {
  double f = 1;
  for (int k = 0; k < dim_; k++) f *= (1 - [((IOSDoubleArray *) nil_chk([((IOSObjectArray *) nil_chk(r)) objectAtIndex:i])) doubleAtIndex:k] * [((IOSDoubleArray *) nil_chk([((IOSObjectArray *) nil_chk(r)) objectAtIndex:i])) doubleAtIndex:k]);
  return f;
}

- (double)L2_discrepancyWithInt:(int)N
               withDoubleArray2:(IOSObjectArray *)r
                     withDouble:(double)x {
  double a = 1, b = 1;
  for (int k = 0; k < dim_; k++) {
    a /= 2.0;
    b /= 3.0;
  }
  if (N == 0) {
    double two_h_1 = [self productWithInt:0 withDoubleArray2:r] - 2 * a * [self productSQWithInt:0 withDoubleArray2:r] + b;
    return [JavaLangMath sqrtWithDouble:two_h_1];
  }
  double f = N * x, h_N = 0.5 * f * f, h;
  h = h_N;
  for (int i = 0; i < N; i++) h += [self productWithInt:i withInt:N withDoubleArray2:r];
  h += 0.5 * [self productWithInt:N withDoubleArray2:r];
  double sum = 0;
  for (int i = 0; i < N; i++) sum += [self productSQWithInt:i withDoubleArray2:r];
  sum += (N + 1) * [self productSQWithInt:N withDoubleArray2:r];
  sum *= a;
  h -= sum;
  h += (N + 0.5) * b;
  return [JavaLangMath sqrtWithDouble:2 * h] / (N + 1);
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TuxkidsTuxblocksCoreUtilsLowDiscrepancySequence *typedCopy = (TuxkidsTuxblocksCoreUtilsLowDiscrepancySequence *) copy;
  typedCopy.dim = dim_;
  typedCopy.index = index_;
  typedCopy.x = x_;
  typedCopy.z = z_;
}

@end
