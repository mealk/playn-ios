//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: core/src/main/java/tuxkids/tuxblocks/core/solve/SolveScreen.java
//
//  Created by Thomas on 7/25/13.
//

#include "java/lang/Integer.h"
#include "java/lang/Math.h"
#include "java/util/ArrayList.h"
#include "java/util/Iterator.h"
#include "java/util/List.h"
#include "playn/core/Assets.h"
#include "playn/core/Connection.h"
#include "playn/core/Graphics.h"
#include "playn/core/GroupLayer.h"
#include "playn/core/Image.h"
#include "playn/core/ImageLayer.h"
#include "playn/core/Layer.h"
#include "playn/core/PlayN.h"
#include "playn/core/Pointer.h"
#include "playn/core/util/Clock.h"
#include "pythagoras/f/Point.h"
#include "tripleplay/game/Screen.h"
#include "tripleplay/game/ScreenStack.h"
#include "tripleplay/game/trans/SlideTransition.h"
#include "tuxkids/tuxblocks/core/Button.h"
#include "tuxkids/tuxblocks/core/Constant.h"
#include "tuxkids/tuxblocks/core/GameState.h"
#include "tuxkids/tuxblocks/core/MenuSprite.h"
#include "tuxkids/tuxblocks/core/screen/GameScreen.h"
#include "tuxkids/tuxblocks/core/solve/EquationSprite.h"
#include "tuxkids/tuxblocks/core/solve/NumberSelectScreen.h"
#include "tuxkids/tuxblocks/core/solve/SolveScreen.h"
#include "tuxkids/tuxblocks/core/solve/blocks/BaseBlock.h"
#include "tuxkids/tuxblocks/core/solve/blocks/Block.h"
#include "tuxkids/tuxblocks/core/solve/blocks/ModifierBlock.h"
#include "tuxkids/tuxblocks/core/solve/expression/Equation.h"
#include "tuxkids/tuxblocks/core/solve/expression/Expression.h"
#include "tuxkids/tuxblocks/core/solve/expression/ModificationOperation.h"

@implementation TuxkidsTuxblocksCoreSolveSolveScreen

@synthesize startEquation = startEquation_;
@synthesize baseBlocks = baseBlocks_;
@synthesize leftBaseBlocks = leftBaseBlocks_;
@synthesize rightBaseBlocks = rightBaseBlocks_;
@synthesize draggingFrom = draggingFrom_;
@synthesize highlight = highlight_;
@synthesize flipModifierPreview = flipModifierPreview_;
@synthesize dragging = dragging_;
@synthesize dragOffset = dragOffset_;
@synthesize equationSprite = equationSprite_;
@synthesize simplyfyResult = simplyfyResult_;
@synthesize buttonBack = buttonBack_;
@synthesize buttonImageOk = buttonImageOk_;
@synthesize buttonImageBack = buttonImageBack_;
@synthesize menu = menu_;
@synthesize equalsX = equalsX_;
@synthesize startDoubleClick = startDoubleClick_;
@synthesize startDoubleClickTime = startDoubleClickTime_;

- (void)setEquationWithTuxkidsTuxblocksCoreSolveExpressionEquation:(TuxkidsTuxblocksCoreSolveExpressionEquation *)equation {
  self.startEquation = equation;
}

- (BOOL)solved {
  if (dragging_ != nil) return NO;
  {
    id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk(baseBlocks_)) iterator];
    while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
      TuxkidsTuxblocksCoreSolveBlocksBaseBlock *baseBlock = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
      if ([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(baseBlock)) hasModifier]) return NO;
    }
  }
  return YES;
}

- (TuxkidsTuxblocksCoreSolveExpressionEquation *)equation {
  return [[TuxkidsTuxblocksCoreSolveExpressionEquation alloc] initWithTuxkidsTuxblocksCoreSolveExpressionExpression:[((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk([((id<JavaUtilList>) nil_chk(leftBaseBlocks_)) getWithInt:0])) topLevelExpression] withTuxkidsTuxblocksCoreSolveExpressionExpression:[((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk([((id<JavaUtilList>) nil_chk(rightBaseBlocks_)) getWithInt:0])) topLevelExpression] withInt:[((TuxkidsTuxblocksCoreSolveExpressionEquation *) nil_chk(startEquation_)) answer] withInt:[((TuxkidsTuxblocksCoreSolveExpressionEquation *) nil_chk(startEquation_)) difficulty]];
}

- (id)initWithTripleplayGameScreenStack:(TripleplayGameScreenStack *)screens
      withTuxkidsTuxblocksCoreGameState:(TuxkidsTuxblocksCoreGameState *)gameState {
  if ((self = [super initWithTripleplayGameScreenStack:screens withTuxkidsTuxblocksCoreGameState:gameState])) {
    baseBlocks_ = [[JavaUtilArrayList alloc] init];
    leftBaseBlocks_ = [[JavaUtilArrayList alloc] init];
    rightBaseBlocks_ = [[JavaUtilArrayList alloc] init];
    dragOffset_ = [[PythagorasFPoint alloc] init];
    menu_ = [[TuxkidsTuxblocksCoreMenuSprite alloc] initWithFloat:[self width] withFloat:[TuxkidsTuxblocksCoreScreenGameScreen defaultButtonSize] * 1.2f];
    (void) [((id<PlaynCoreLayer>) nil_chk([((TuxkidsTuxblocksCoreMenuSprite *) nil_chk(menu_)) layer])) setDepthWithFloat:-1];
    [((id<PlaynCoreGroupLayer>) nil_chk(layer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreMenuSprite *) nil_chk(menu_)) layer]];
    buttonImageBack_ = [((id<PlaynCoreAssets>) nil_chk([PlaynCorePlayN assets])) getImageWithNSString:[TuxkidsTuxblocksCoreConstant BUTTON_DOWN]];
    buttonImageOk_ = [((id<PlaynCoreAssets>) nil_chk([PlaynCorePlayN assets])) getImageWithNSString:[TuxkidsTuxblocksCoreConstant BUTTON_OK]];
    buttonBack_ = [self createMenuButtonWithNSString:[TuxkidsTuxblocksCoreConstant BUTTON_DOWN]];
    [((TuxkidsTuxblocksCoreButton *) nil_chk(buttonBack_)) setPositionWithFloat:[((TuxkidsTuxblocksCoreButton *) nil_chk(buttonBack_)) width] * 0.6f withFloat:[((TuxkidsTuxblocksCoreButton *) nil_chk(buttonBack_)) height] * 0.6f];
    (void) [((id<PlaynCoreLayer>) nil_chk([((TuxkidsTuxblocksCoreButton *) nil_chk(buttonBack_)) layerAddable])) setDepthWithFloat:10];
    [((TuxkidsTuxblocksCoreButton *) nil_chk(buttonBack_)) setOnReleasedListenerWithTuxkidsTuxblocksCoreButton_OnReleasedListener:[[TuxkidsTuxblocksCoreSolveSolveScreen_$1 alloc] initWithTuxkidsTuxblocksCoreSolveSolveScreen:self]];
    [((id<PlaynCoreGroupLayer>) nil_chk(layer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreButton *) nil_chk(buttonBack_)) layerAddable]];
  }
  return self;
}

- (void)popThis {
  [self popThisWithTripleplayGameScreenStack_Transition:[((TripleplayGameTransSlideTransition *) nil_chk([((TripleplayGameScreenStack *) nil_chk(screens_)) slide])) up]];
}

- (void)wasAdded {
  [super wasAdded];
  TuxkidsTuxblocksCoreSolveBlocksBaseBlock *leftHandSide = [TuxkidsTuxblocksCoreSolveBlocksBlock createBlockWithTuxkidsTuxblocksCoreSolveExpressionExpression:[((TuxkidsTuxblocksCoreSolveExpressionEquation *) nil_chk(startEquation_)) leftHandSide]];
  TuxkidsTuxblocksCoreSolveBlocksBaseBlock *rightHandSide = [TuxkidsTuxblocksCoreSolveBlocksBlock createBlockWithTuxkidsTuxblocksCoreSolveExpressionExpression:[((TuxkidsTuxblocksCoreSolveExpressionEquation *) nil_chk(startEquation_)) rightHandSide]];
  float blockHeight = [JavaLangMath maxWithFloat:[((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(leftHandSide)) groupHeight] withFloat:[((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(rightHandSide)) groupHeight]];
  (void) [((id<PlaynCoreGroupLayer>) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(leftHandSide)) layer])) setTyWithFloat:([((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCoreScreenGameScreen graphics])) height] + blockHeight + [((TuxkidsTuxblocksCoreMenuSprite *) nil_chk(menu_)) height]) / 2];
  (void) [((id<PlaynCoreGroupLayer>) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(leftHandSide)) layer])) setTxWithFloat:[((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCoreScreenGameScreen graphics])) width] / 4 - [((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(leftHandSide)) groupWidth] / 2];
  [((id<PlaynCoreGroupLayer>) nil_chk(layer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(leftHandSide)) layer]];
  if ([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(leftHandSide)) hasModifier]) (void) [((id<PlaynCoreImageLayer>) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksModifierBlock *) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(leftHandSide)) lastModifier])) layer])) addListenerWithPlaynCorePointer_Listener:self];
  [((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(leftHandSide)) setSimplifyListenerWithTuxkidsTuxblocksCoreSolveBlocksBaseBlock_OnSimplifyListener:self];
  [((id<JavaUtilList>) nil_chk(baseBlocks_)) addWithId:leftHandSide];
  [((id<JavaUtilList>) nil_chk(leftBaseBlocks_)) addWithId:leftHandSide];
  (void) [((id<PlaynCoreGroupLayer>) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(rightHandSide)) layer])) setTyWithFloat:([((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCoreScreenGameScreen graphics])) height] + blockHeight + [((TuxkidsTuxblocksCoreMenuSprite *) nil_chk(menu_)) height]) / 2];
  (void) [((id<PlaynCoreGroupLayer>) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(rightHandSide)) layer])) setTxWithFloat:3 * [((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCoreScreenGameScreen graphics])) width] / 4 - [((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(rightHandSide)) groupWidth] / 2];
  [((id<PlaynCoreGroupLayer>) nil_chk(layer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(rightHandSide)) layer]];
  if ([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(rightHandSide)) hasModifier]) (void) [((id<PlaynCoreImageLayer>) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksModifierBlock *) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(rightHandSide)) lastModifier])) layer])) addListenerWithPlaynCorePointer_Listener:self];
  [((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(rightHandSide)) setSimplifyListenerWithTuxkidsTuxblocksCoreSolveBlocksBaseBlock_OnSimplifyListener:self];
  [((id<JavaUtilList>) nil_chk(baseBlocks_)) addWithId:rightHandSide];
  [((id<JavaUtilList>) nil_chk(rightBaseBlocks_)) addWithId:rightHandSide];
  equalsX_ = [self width] / 2;
  equationSprite_ = [[TuxkidsTuxblocksCoreSolveEquationSprite alloc] initWithTuxkidsTuxblocksCoreSolveBlocksBaseBlock:leftHandSide withTuxkidsTuxblocksCoreSolveBlocksBaseBlock:rightHandSide];
  [self refreshEquationSprite];
}

- (void)wasRemoved {
  [super wasRemoved];
  {
    id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk(baseBlocks_)) iterator];
    while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
      TuxkidsTuxblocksCoreSolveBlocksBaseBlock *block = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
      [((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(block)) destroy];
    }
  }
  [((id<JavaUtilList>) nil_chk(baseBlocks_)) clear];
  [((id<JavaUtilList>) nil_chk(leftBaseBlocks_)) clear];
  [((id<JavaUtilList>) nil_chk(rightBaseBlocks_)) clear];
  [((id<PlaynCoreImageLayer>) nil_chk([((TuxkidsTuxblocksCoreSolveEquationSprite *) nil_chk(equationSprite_)) layer])) destroy];
  {
    id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk(baseBlocks_)) iterator];
    while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
      TuxkidsTuxblocksCoreSolveBlocksBaseBlock *baseBlock = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
      [((id<PlaynCoreGroupLayer>) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(baseBlock)) layer])) destroy];
    }
  }
}

- (void)refreshEquationSprite {
  [((TuxkidsTuxblocksCoreSolveEquationSprite *) nil_chk(equationSprite_)) refreshWithTuxkidsTuxblocksCoreSolveBlocksModifierBlock:dragging_ withTuxkidsTuxblocksCoreSolveBlocksBaseBlock:highlight_ withBOOL:flipModifierPreview_];
  id<PlaynCoreImageLayer> layer = [((TuxkidsTuxblocksCoreSolveEquationSprite *) nil_chk(equationSprite_)) layer];
  [((id<PlaynCoreGroupLayer>) nil_chk(self.layer)) addWithPlaynCoreLayer:layer];
  (void) [((id<PlaynCoreImageLayer>) nil_chk(layer)) setTyWithFloat:10];
  (void) [((id<PlaynCoreImageLayer>) nil_chk(layer)) setTxWithFloat:[((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCoreScreenGameScreen graphics])) width] / 2];
  [((TuxkidsTuxblocksCoreButton *) nil_chk(buttonBack_)) setImageWithPlaynCoreImage:[self solved] ? buttonImageOk_ : buttonImageBack_];
}

- (void)updateWithInt:(int)delta {
  [super updateWithInt:delta];
}

- (void)paintWithPlaynCoreUtilClock:(id<PlaynCoreUtilClock>)clock {
  [super paintWithPlaynCoreUtilClock:clock];
}

- (void)onPointerStartWithPlaynCorePointer_Event:(id<PlaynCorePointer_Event>)event {
  if (dragging_ != nil) return;
  dragging_ = nil;
  draggingFrom_ = nil;
  if ([((id<PlaynCorePointer_Event>) nil_chk(event)) hit] != nil) {
    {
      id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk(baseBlocks_)) iterator];
      while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
        TuxkidsTuxblocksCoreSolveBlocksBaseBlock *baseBlock = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
        if ([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(baseBlock)) hasModifier] && [((TuxkidsTuxblocksCoreSolveBlocksModifierBlock *) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(baseBlock)) lastModifier])) layer] == [((id<PlaynCorePointer_Event>) nil_chk(event)) hit]) {
          if ([((TuxkidsTuxblocksCoreSolveExpressionModificationOperation *) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksModifierBlock *) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(baseBlock)) lastModifier])) getModifier])) getPrecedence] == TuxkidsTuxblocksCoreSolveExpressionExpression_PREC_MULT && [((id<JavaUtilList>) nil_chk(baseBlocks_)) size] > 2) {
            if (startDoubleClick_ != nil && startDoubleClickTime_ + TuxkidsTuxblocksCoreSolveSolveScreen_DOUBLE_CLICK_TIME > [((id<PlaynCorePointer_Event>) nil_chk(event)) time]) {
              TuxkidsTuxblocksCoreSolveExpressionModificationOperation *toFlip = [((TuxkidsTuxblocksCoreSolveBlocksModifierBlock *) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(baseBlock)) lastModifier])) getModifier];
              {
                id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk(baseBlocks_)) iterator];
                while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
                  TuxkidsTuxblocksCoreSolveBlocksBaseBlock *baseBlock2 = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
                  [((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(baseBlock2)) addModifierWithTuxkidsTuxblocksCoreSolveExpressionModificationOperation:[((TuxkidsTuxblocksCoreSolveExpressionModificationOperation *) nil_chk(toFlip)) getInverse]];
                  (void) [((id<PlaynCoreImageLayer>) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksModifierBlock *) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(baseBlock2)) lastModifier])) layer])) addListenerWithPlaynCorePointer_Listener:self];
                }
              }
              [self refreshEquationSprite];
            }
            else {
              startDoubleClick_ = baseBlock;
              startDoubleClickTime_ = [((id<PlaynCorePointer_Event>) nil_chk(event)) time];
            }
            continue;
          }
          draggingFrom_ = baseBlock;
          break;
        }
      }
    }
    if (draggingFrom_ != nil) {
      dragging_ = [draggingFrom_ pop];
      if ([draggingFrom_ hasModifier]) {
        (void) [((id<PlaynCoreImageLayer>) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksModifierBlock *) nil_chk([draggingFrom_ lastModifier])) layer])) addListenerWithPlaynCorePointer_Listener:self];
      }
      (void) [((PythagorasFPoint *) nil_chk(dragOffset_)) setWithFloat:[((id<PlaynCoreGroupLayer>) nil_chk([draggingFrom_ layer])) tx] + [((id<PlaynCoreImageLayer>) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksModifierBlock *) nil_chk(dragging_)) layer])) tx] - [((id<PlaynCorePointer_Event>) nil_chk(event)) x] withFloat:[((id<PlaynCoreGroupLayer>) nil_chk([draggingFrom_ layer])) ty] + [((id<PlaynCoreImageLayer>) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksModifierBlock *) nil_chk(dragging_)) layer])) ty] - [((id<PlaynCorePointer_Event>) nil_chk(event)) y]];
      (void) [((id<PlaynCoreImageLayer>) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksModifierBlock *) nil_chk(dragging_)) layer])) setTranslationWithFloat:[((id<PlaynCorePointer_Event>) nil_chk(event)) x] + ((PythagorasFPoint *) nil_chk(dragOffset_)).x_ withFloat:[((id<PlaynCorePointer_Event>) nil_chk(event)) y] + ((PythagorasFPoint *) nil_chk(dragOffset_)).y_];
      [((id<PlaynCoreGroupLayer>) nil_chk(layer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreSolveBlocksModifierBlock *) nil_chk(dragging_)) layer]];
      (void) [((id<PlaynCoreImageLayer>) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksModifierBlock *) nil_chk(dragging_)) layer])) setDepthWithFloat:2];
      [self refreshEquationSprite];
    }
  }
}

- (void)onPointerEndWithPlaynCorePointer_Event:(id<PlaynCorePointer_Event>)event {
  if (dragging_ != nil) {
    {
      id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk(baseBlocks_)) iterator];
      while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
        TuxkidsTuxblocksCoreSolveBlocksBaseBlock *baseBlock = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
        [((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(baseBlock)) stopShowingPreview];
      }
    }
    [((id<PlaynCoreGroupLayer>) nil_chk(layer_)) removeWithPlaynCoreLayer:[dragging_ layer]];
    TuxkidsTuxblocksCoreSolveBlocksBaseBlock *dragStop = highlight_;
    if (flipModifierPreview_) {
      [((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(dragStop)) addModifierWithTuxkidsTuxblocksCoreSolveExpressionModificationOperation:[dragging_ getModifier]];
    }
    else {
      [((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(dragStop)) addModifierWithTuxkidsTuxblocksCoreSolveExpressionModificationOperation:[dragging_ getOriginalModifier]];
    }
    (void) [((id<PlaynCoreImageLayer>) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksModifierBlock *) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(dragStop)) lastModifier])) layer])) addListenerWithPlaynCorePointer_Listener:self];
    dragging_ = nil;
    [self refreshEquationSprite];
  }
  dragging_ = nil;
}

- (void)onPointerDragWithPlaynCorePointer_Event:(id<PlaynCorePointer_Event>)event {
  if (dragging_ != nil) {
    (void) [((id<PlaynCoreImageLayer>) nil_chk([dragging_ layer])) setTranslationWithFloat:[((id<PlaynCorePointer_Event>) nil_chk(event)) x] + ((PythagorasFPoint *) nil_chk(dragOffset_)).x_ withFloat:[((id<PlaynCorePointer_Event>) nil_chk(event)) y] + ((PythagorasFPoint *) nil_chk(dragOffset_)).y_];
    BOOL invert = ([((id<PlaynCoreGroupLayer>) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(draggingFrom_)) layer])) tx] < equalsX_) != ([((id<PlaynCorePointer_Event>) nil_chk(event)) x] < equalsX_);
    [dragging_ setInvertedWithBOOL:invert];
    [self refreshEquationSprite];
    float blockCX = [((id<PlaynCoreImageLayer>) nil_chk([dragging_ layer])) tx] + [dragging_ width] / 2;
    float blockCY = [((id<PlaynCoreImageLayer>) nil_chk([dragging_ layer])) ty] + [dragging_ height] / 2;
    highlight_ = draggingFrom_;
    flipModifierPreview_ = NO;
    {
      id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk(baseBlocks_)) iterator];
      while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
        TuxkidsTuxblocksCoreSolveBlocksBaseBlock *baseBlock = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
        [((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(baseBlock)) updateShowPreviewWithFloat:blockCX withFloat:blockCY withTuxkidsTuxblocksCoreSolveExpressionModificationOperation:[dragging_ getModifier]];
        if (baseBlock != draggingFrom_ && [((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(baseBlock)) isShowingPreview]) {
          highlight_ = baseBlock;
          flipModifierPreview_ = YES;
        }
      }
    }
  }
}

- (void)onPointerCancelWithPlaynCorePointer_Event:(id<PlaynCorePointer_Event>)event {
}

- (void)onSimplifyWithTuxkidsTuxblocksCoreSolveBlocksBaseBlock:(TuxkidsTuxblocksCoreSolveBlocksBaseBlock *)baseBlock
                                                  withNSString:(NSString *)expression
                                                       withInt:(int)answer
                                                       withInt:(int)start {
  simplyfyResult_ = baseBlock;
  TuxkidsTuxblocksCoreSolveNumberSelectScreen *nss = [[TuxkidsTuxblocksCoreSolveNumberSelectScreen alloc] initWithTripleplayGameScreenStack:screens_ withTuxkidsTuxblocksCoreGameState:state__ withNSString:expression withInt:answer];
  [((TuxkidsTuxblocksCoreSolveNumberSelectScreen *) nil_chk(nss)) setFocusedNumberWithInt:start];
  [self pushScreenWithTuxkidsTuxblocksCoreScreenGameScreen:nss];
}

- (void)onChildScreenFinishedWithTuxkidsTuxblocksCoreScreenGameScreen:(TuxkidsTuxblocksCoreScreenGameScreen *)screen {
  [super onChildScreenFinishedWithTuxkidsTuxblocksCoreScreenGameScreen:screen];
  if ([screen isKindOfClass:[TuxkidsTuxblocksCoreSolveNumberSelectScreen class]]) {
    if ([((TuxkidsTuxblocksCoreSolveNumberSelectScreen *) screen) hasCorrectAnswer]) {
      JavaLangInteger *answer = [((TuxkidsTuxblocksCoreSolveNumberSelectScreen *) screen) selectedAnswer];
      [((TuxkidsTuxblocksCoreSolveBlocksBaseBlock *) nil_chk(simplyfyResult_)) simplfyWithInt:[((JavaLangInteger *) nil_chk(answer)) intValue]];
      [self refreshEquationSprite];
    }
  }
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TuxkidsTuxblocksCoreSolveSolveScreen *typedCopy = (TuxkidsTuxblocksCoreSolveSolveScreen *) copy;
  typedCopy.startEquation = startEquation_;
  typedCopy.baseBlocks = baseBlocks_;
  typedCopy.leftBaseBlocks = leftBaseBlocks_;
  typedCopy.rightBaseBlocks = rightBaseBlocks_;
  typedCopy.draggingFrom = draggingFrom_;
  typedCopy.highlight = highlight_;
  typedCopy.flipModifierPreview = flipModifierPreview_;
  typedCopy.dragging = dragging_;
  typedCopy.dragOffset = dragOffset_;
  typedCopy.equationSprite = equationSprite_;
  typedCopy.simplyfyResult = simplyfyResult_;
  typedCopy.buttonBack = buttonBack_;
  typedCopy.buttonImageOk = buttonImageOk_;
  typedCopy.buttonImageBack = buttonImageBack_;
  typedCopy.menu = menu_;
  typedCopy.equalsX = equalsX_;
  typedCopy.startDoubleClick = startDoubleClick_;
  typedCopy.startDoubleClickTime = startDoubleClickTime_;
}

@end
@implementation TuxkidsTuxblocksCoreSolveSolveScreen_$1

@synthesize this$0 = this$0_;

- (void)onReleaseWithPlaynCorePointer_Event:(id<PlaynCorePointer_Event>)event
                                   withBOOL:(BOOL)inButton {
  if (inButton) [this$0_ popThis];
}

- (id)initWithTuxkidsTuxblocksCoreSolveSolveScreen:(TuxkidsTuxblocksCoreSolveSolveScreen *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TuxkidsTuxblocksCoreSolveSolveScreen_$1 *typedCopy = (TuxkidsTuxblocksCoreSolveSolveScreen_$1 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
