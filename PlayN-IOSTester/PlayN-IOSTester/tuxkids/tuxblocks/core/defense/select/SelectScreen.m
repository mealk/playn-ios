//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: core/src/main/java/tuxkids/tuxblocks/core/defense/select/SelectScreen.java
//
//  Created by Thomas on 7/26/13.
//

#include "java/util/ArrayList.h"
#include "java/util/Iterator.h"
#include "java/util/List.h"
#include "playn/core/Color.h"
#include "playn/core/Graphics.h"
#include "playn/core/GroupLayer.h"
#include "playn/core/ImmediateLayer.h"
#include "playn/core/Layer.h"
#include "playn/core/Pointer.h"
#include "playn/core/Surface.h"
#include "playn/core/util/Clock.h"
#include "tripleplay/game/Screen.h"
#include "tripleplay/game/ScreenStack.h"
#include "tripleplay/game/trans/SlideTransition.h"
#include "tripleplay/util/Colors.h"
#include "tuxkids/tuxblocks/core/Button.h"
#include "tuxkids/tuxblocks/core/Constant.h"
#include "tuxkids/tuxblocks/core/GameState.h"
#include "tuxkids/tuxblocks/core/MenuSprite.h"
#include "tuxkids/tuxblocks/core/defense/Grid.h"
#include "tuxkids/tuxblocks/core/defense/select/Problem.h"
#include "tuxkids/tuxblocks/core/defense/select/ProblemButton.h"
#include "tuxkids/tuxblocks/core/defense/select/SelectScreen.h"
#include "tuxkids/tuxblocks/core/screen/GameScreen.h"
#include "tuxkids/tuxblocks/core/solve/SolveScreen.h"
#include "tuxkids/tuxblocks/core/solve/blocks/Equation.h"

@implementation TuxkidsTuxblocksCoreDefenseSelectSelectScreen

@synthesize grid = grid_;
@synthesize gridHolder = gridHolder_;
@synthesize problemLayer = problemLayer_;
@synthesize selectedProblem = selectedProblem_;
@synthesize problemButtons = problemButtons_;
@synthesize bottomLeft = bottomLeft_;
@synthesize bottomRight = bottomRight_;
@synthesize solveScreen = solveScreen_;
@synthesize del = del_;

- (id)initWithTripleplayGameScreenStack:(TripleplayGameScreenStack *)screens
      withTuxkidsTuxblocksCoreGameState:(TuxkidsTuxblocksCoreGameState *)gameState
    withTuxkidsTuxblocksCoreDefenseGrid:(TuxkidsTuxblocksCoreDefenseGrid *)grid {
  if ((self = [super initWithTripleplayGameScreenStack:screens withTuxkidsTuxblocksCoreGameState:gameState])) {
    problemButtons_ = [[JavaUtilArrayList alloc] init];
    self.grid = grid;
    TuxkidsTuxblocksCoreButton *button = [self createMenuButtonWithNSString:[TuxkidsTuxblocksCoreConstant BUTTON_FORWARD]];
    (void) [((id<PlaynCoreLayer>) nil_chk([((TuxkidsTuxblocksCoreButton *) nil_chk(button)) layerAddable])) setDepthWithFloat:1];
    [((TuxkidsTuxblocksCoreButton *) nil_chk(button)) setPositionWithFloat:[self width] - [((TuxkidsTuxblocksCoreButton *) nil_chk(button)) width] * 0.6f withFloat:[((TuxkidsTuxblocksCoreButton *) nil_chk(button)) height] * 0.6f];
    [((TuxkidsTuxblocksCoreButton *) nil_chk(button)) setOnReleasedListenerWithTuxkidsTuxblocksCoreButton_OnReleasedListener:[[TuxkidsTuxblocksCoreDefenseSelectSelectScreen_$1 alloc] initWithTuxkidsTuxblocksCoreDefenseSelectSelectScreen:self]];
    [((id<PlaynCoreGroupLayer>) nil_chk(layer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreButton *) nil_chk(button)) layerAddable]];
    TuxkidsTuxblocksCoreMenuSprite *menu = [[TuxkidsTuxblocksCoreMenuSprite alloc] initWithFloat:[self width] withFloat:[TuxkidsTuxblocksCoreScreenGameScreen defaultButtonSize] * 1.2f];
    (void) [((id<PlaynCoreLayer>) nil_chk([((TuxkidsTuxblocksCoreMenuSprite *) nil_chk(menu)) layer])) setDepthWithFloat:-1];
    [((id<PlaynCoreGroupLayer>) nil_chk(layer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreMenuSprite *) nil_chk(menu)) layer]];
    gridHolder_ = [((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCoreScreenGameScreen graphics])) createGroupLayer];
    (void) [((id<PlaynCoreGroupLayer>) nil_chk(gridHolder_)) setScaleWithFloat:[((TuxkidsTuxblocksCoreMenuSprite *) nil_chk(menu)) height] / [((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(grid)) height]];
    (void) [((id<PlaynCoreGroupLayer>) nil_chk(gridHolder_)) setTranslationWithFloat:0 withFloat:0];
    (void) [((id<PlaynCoreGroupLayer>) nil_chk(gridHolder_)) setAlphaWithFloat:0.75f];
    [((id<PlaynCoreGroupLayer>) nil_chk(layer_)) addWithPlaynCoreLayer:gridHolder_];
    problemLayer_ = [((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCoreScreenGameScreen graphics])) createGroupLayer];
    (void) [((id<PlaynCoreGroupLayer>) nil_chk(problemLayer_)) setTyWithFloat:[((TuxkidsTuxblocksCoreMenuSprite *) nil_chk(menu)) height]];
    [((id<PlaynCoreGroupLayer>) nil_chk(layer_)) addWithPlaynCoreLayer:problemLayer_];
    {
      id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk([((TuxkidsTuxblocksCoreGameState *) nil_chk(state__)) problems])) iterator];
      while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
        TuxkidsTuxblocksCoreDefenseSelectProblem *problem = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
        [self addProblemButtonWithTuxkidsTuxblocksCoreDefenseSelectProblem:problem];
      }
    }
    solveScreen_ = [[TuxkidsTuxblocksCoreSolveSolveScreen alloc] initWithTripleplayGameScreenStack:screens withTuxkidsTuxblocksCoreGameState:gameState];
    id<PlaynCoreImmediateLayer> il = [((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCoreScreenGameScreen graphics])) createImmediateLayerWithPlaynCoreImmediateLayer_Renderer:[[TuxkidsTuxblocksCoreDefenseSelectSelectScreen_$2 alloc] initWithTuxkidsTuxblocksCoreDefenseSelectSelectScreen:self]];
    [((id<PlaynCoreGroupLayer>) nil_chk(gridHolder_)) addWithPlaynCoreLayer:il];
    [((TuxkidsTuxblocksCoreGameState *) nil_chk(state__)) setProblemAddedListenerWithTuxkidsTuxblocksCoreGameState_ProblemAddedListener:self];
  }
  return self;
}

- (void)popThis {
  [self popThisWithTripleplayGameScreenStack_Transition:[((TripleplayGameTransSlideTransition *) nil_chk([((TripleplayGameScreenStack *) nil_chk(screens_)) slide])) left]];
}

- (void)addProblemButtonWithTuxkidsTuxblocksCoreDefenseSelectProblem:(TuxkidsTuxblocksCoreDefenseSelectProblem *)problem {
  int margin = TuxkidsTuxblocksCoreDefenseSelectProblemButton_MARGIN;
  int width = (int) (([self width] - margin * (TuxkidsTuxblocksCoreDefenseSelectSelectScreen_COLS + 1)) / TuxkidsTuxblocksCoreDefenseSelectSelectScreen_COLS);
  int minHeight = (int) ([self height] / 6);
  int col;
  if (bottomLeft_ == nil) {
    col = 0;
  }
  else if (bottomRight_ == nil) {
    col = 1;
  }
  else if ([((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(bottomLeft_)) bottom] <= [bottomRight_ bottom]) {
    col = 0;
  }
  else {
    col = 1;
  }
  TuxkidsTuxblocksCoreDefenseSelectProblemButton *above = col == 0 ? bottomLeft_ : bottomRight_;
  float aboveY = above == nil ? 0 : [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(above)) bottom];
  TuxkidsTuxblocksCoreDefenseSelectProblemButton *pb = [[TuxkidsTuxblocksCoreDefenseSelectProblemButton alloc] initWithTuxkidsTuxblocksCoreDefenseSelectProblem:problem withFloat:width withFloat:minHeight withInt:[((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(grid_)) towerColor]];
  [((id<PlaynCoreGroupLayer>) nil_chk(problemLayer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(pb)) layerAddable]];
  [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(pb)) setPositionWithFloat:(col + 0.5f) * [self width] / TuxkidsTuxblocksCoreDefenseSelectSelectScreen_COLS withFloat:aboveY + margin + [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(pb)) height] / 2];
  [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(pb)) setTintWithInt:[PlaynCoreColor withAlphaWithInt:[TripleplayUtilColors WHITE] withInt:225] withInt:[TripleplayUtilColors LIGHT_GRAY]];
  [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(pb)) setOnReleasedListenerWithTuxkidsTuxblocksCoreButton_OnReleasedListener:[[TuxkidsTuxblocksCoreDefenseSelectSelectScreen_$3 alloc] initWithTuxkidsTuxblocksCoreDefenseSelectSelectScreen:self withTuxkidsTuxblocksCoreDefenseSelectProblemButton:pb]];
  [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(pb)) fadeInWithFloat:1];
  if (above != nil) {
    [above setBelowWithTuxkidsTuxblocksCoreDefenseSelectProblemButton:pb];
    [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(pb)) setAboveWithTuxkidsTuxblocksCoreDefenseSelectProblemButton:above];
  }
  if (col == 0) {
    bottomLeft_ = pb;
  }
  else {
    bottomRight_ = pb;
  }
  [((id<JavaUtilList>) nil_chk(problemButtons_)) addWithId:pb];
}

- (void)solveProblemWithTuxkidsTuxblocksCoreDefenseSelectProblemButton:(TuxkidsTuxblocksCoreDefenseSelectProblemButton *)button {
  [((TuxkidsTuxblocksCoreGameState *) nil_chk(state__)) solveProblemWithTuxkidsTuxblocksCoreDefenseSelectProblem:[((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(button)) problem]];
  [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(button)) destroy];
  if ([((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(button)) above] != nil) {
    [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk([((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(button)) above])) setBelowWithTuxkidsTuxblocksCoreDefenseSelectProblemButton:[((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(button)) below]];
  }
  if ([((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(button)) below] != nil) {
    [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk([((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(button)) below])) setAboveWithTuxkidsTuxblocksCoreDefenseSelectProblemButton:[((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(button)) above]];
  }
  if (bottomLeft_ == button) bottomLeft_ = [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(bottomLeft_)) above];
  if (bottomRight_ == button) bottomRight_ = [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(bottomRight_)) above];
}

- (void)showTransitionCompleted {
  [super showTransitionCompleted];
}

- (void)updateWithInt:(int)delta {
  [super updateWithInt:delta];
  [((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(grid_)) updateWithInt:delta];
}

- (void)paintWithPlaynCoreUtilClock:(id<PlaynCoreUtilClock>)clock {
  [super paintWithPlaynCoreUtilClock:clock];
  [((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(grid_)) paintWithPlaynCoreUtilClock:clock];
  if ([self entering]) return;
  {
    id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk(problemButtons_)) iterator];
    while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
      TuxkidsTuxblocksCoreDefenseSelectProblemButton *problem = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
      [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(problem)) paintWithPlaynCoreUtilClock:clock];
    }
  }
  if (del_ && selectedProblem_ != nil && [((id<PlaynCoreLayer>) nil_chk([((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(selectedProblem_)) layerAddable])) alpha] < 0.03f) {
    [self solveProblemWithTuxkidsTuxblocksCoreDefenseSelectProblemButton:selectedProblem_];
    del_ = NO;
  }
}

- (void)onChildScreenFinishedWithTuxkidsTuxblocksCoreScreenGameScreen:(TuxkidsTuxblocksCoreScreenGameScreen *)screen {
  [super onChildScreenFinishedWithTuxkidsTuxblocksCoreScreenGameScreen:screen];
  if ([screen isKindOfClass:[TuxkidsTuxblocksCoreSolveSolveScreen class]]) {
    [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(selectedProblem_)) setEquationWithTuxkidsTuxblocksCoreSolveBlocksEquation:[((TuxkidsTuxblocksCoreSolveSolveScreen *) screen) equation]];
    del_ = [((TuxkidsTuxblocksCoreSolveSolveScreen *) screen) solved];
    if (del_) {
      [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(selectedProblem_)) setEnabledWithBOOL:NO];
      [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(selectedProblem_)) fadeOut];
    }
  }
}

- (void)onProblemAddedWithTuxkidsTuxblocksCoreDefenseSelectProblem:(TuxkidsTuxblocksCoreDefenseSelectProblem *)problem {
  [self addProblemButtonWithTuxkidsTuxblocksCoreDefenseSelectProblem:problem];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TuxkidsTuxblocksCoreDefenseSelectSelectScreen *typedCopy = (TuxkidsTuxblocksCoreDefenseSelectSelectScreen *) copy;
  typedCopy.grid = grid_;
  typedCopy.gridHolder = gridHolder_;
  typedCopy.problemLayer = problemLayer_;
  typedCopy.selectedProblem = selectedProblem_;
  typedCopy.problemButtons = problemButtons_;
  typedCopy.bottomLeft = bottomLeft_;
  typedCopy.bottomRight = bottomRight_;
  typedCopy.solveScreen = solveScreen_;
  typedCopy.del = del_;
}

@end
@implementation TuxkidsTuxblocksCoreDefenseSelectSelectScreen_$1

@synthesize this$0 = this$0_;

- (void)onReleaseWithPlaynCorePointer_Event:(id<PlaynCorePointer_Event>)event
                                   withBOOL:(BOOL)inButton {
  if (inButton) {
    [this$0_ popThis];
  }
}

- (id)initWithTuxkidsTuxblocksCoreDefenseSelectSelectScreen:(TuxkidsTuxblocksCoreDefenseSelectSelectScreen *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TuxkidsTuxblocksCoreDefenseSelectSelectScreen_$1 *typedCopy = (TuxkidsTuxblocksCoreDefenseSelectSelectScreen_$1 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
@implementation TuxkidsTuxblocksCoreDefenseSelectSelectScreen_$2

@synthesize this$0 = this$0_;

- (void)renderWithPlaynCoreSurface:(id<PlaynCoreSurface>)surface {
  (void) [((id<PlaynCoreSurface>) nil_chk(surface)) drawLayerWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(this$0_.grid)) layer]];
}

- (id)initWithTuxkidsTuxblocksCoreDefenseSelectSelectScreen:(TuxkidsTuxblocksCoreDefenseSelectSelectScreen *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TuxkidsTuxblocksCoreDefenseSelectSelectScreen_$2 *typedCopy = (TuxkidsTuxblocksCoreDefenseSelectSelectScreen_$2 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
@implementation TuxkidsTuxblocksCoreDefenseSelectSelectScreen_$3

@synthesize this$0 = this$0_;
@synthesize val$pb = val$pb_;

- (void)onReleaseWithPlaynCorePointer_Event:(id<PlaynCorePointer_Event>)event
                                   withBOOL:(BOOL)inButton {
  if (inButton) {
    this$0_.selectedProblem = val$pb_;
    [((TuxkidsTuxblocksCoreSolveSolveScreen *) nil_chk(this$0_.solveScreen)) setEquationWithTuxkidsTuxblocksCoreSolveBlocksEquation:[((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(val$pb_)) equation]];
    [this$0_ pushScreenWithTuxkidsTuxblocksCoreScreenGameScreen:this$0_.solveScreen withTripleplayGameScreenStack_Transition:[((TripleplayGameTransSlideTransition *) nil_chk([((TripleplayGameScreenStack *) nil_chk(this$0_.screens)) slide])) down]];
  }
}

- (id)initWithTuxkidsTuxblocksCoreDefenseSelectSelectScreen:(TuxkidsTuxblocksCoreDefenseSelectSelectScreen *)outer$
         withTuxkidsTuxblocksCoreDefenseSelectProblemButton:(TuxkidsTuxblocksCoreDefenseSelectProblemButton *)capture$0 {
  if ((self = [super init])) {
    this$0_ = outer$;
    val$pb_ = capture$0;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TuxkidsTuxblocksCoreDefenseSelectSelectScreen_$3 *typedCopy = (TuxkidsTuxblocksCoreDefenseSelectSelectScreen_$3 *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy.val$pb = val$pb_;
}

@end
