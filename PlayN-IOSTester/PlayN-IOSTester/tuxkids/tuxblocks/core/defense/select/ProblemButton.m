//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: core/src/main/java/tuxkids/tuxblocks/core/defense/select/ProblemButton.java
//
//  Created by Thomas on 7/26/13.
//

#include "java/lang/Math.h"
#include "playn/core/Canvas.h"
#include "playn/core/CanvasImage.h"
#include "playn/core/Font.h"
#include "playn/core/Graphics.h"
#include "playn/core/Image.h"
#include "playn/core/Layer.h"
#include "playn/core/TextFormat.h"
#include "playn/core/TextLayout.h"
#include "playn/core/util/Clock.h"
#include "tripleplay/util/Colors.h"
#include "tuxkids/tuxblocks/core/Button.h"
#include "tuxkids/tuxblocks/core/Constant.h"
#include "tuxkids/tuxblocks/core/PlayNObject.h"
#include "tuxkids/tuxblocks/core/defense/round/Reward.h"
#include "tuxkids/tuxblocks/core/defense/select/Problem.h"
#include "tuxkids/tuxblocks/core/defense/select/ProblemButton.h"
#include "tuxkids/tuxblocks/core/defense/tower/Tower.h"
#include "tuxkids/tuxblocks/core/defense/tower/TowerType.h"
#include "tuxkids/tuxblocks/core/solve/blocks/Equation.h"
#include "tuxkids/tuxblocks/core/solve/markup/ExpressionWriter.h"
#include "tuxkids/tuxblocks/core/solve/markup/Renderer.h"

@implementation TuxkidsTuxblocksCoreDefenseSelectProblemButton

@synthesize problem_ = problem__;
@synthesize minHeight = minHeight_;
@synthesize above_ = above__;
@synthesize below_ = below__;
@synthesize towerColor = towerColor_;
@synthesize targetAlpha = targetAlpha_;

+ (int)MARGIN {
  return TuxkidsTuxblocksCoreDefenseSelectProblemButton_MARGIN;
}

- (TuxkidsTuxblocksCoreSolveBlocksEquation *)equation {
  return [((TuxkidsTuxblocksCoreDefenseSelectProblem *) nil_chk(problem__)) equation];
}

- (void)setEquationWithTuxkidsTuxblocksCoreSolveBlocksEquation:(TuxkidsTuxblocksCoreSolveBlocksEquation *)equation {
  [((TuxkidsTuxblocksCoreDefenseSelectProblem *) nil_chk(problem__)) setEquationWithTuxkidsTuxblocksCoreSolveBlocksEquation:equation];
  [self setImageWithPlaynCoreImage:[TuxkidsTuxblocksCoreDefenseSelectProblemButton createImageWithTuxkidsTuxblocksCoreDefenseSelectProblem:problem__ withFloat:[self width] withFloat:minHeight_ withInt:towerColor_]];
  float top = [self top];
  [self setSizeWithFloat:[((id<PlaynCoreImage>) nil_chk([self image])) width] withFloat:[((id<PlaynCoreImage>) nil_chk([self image])) height]];
  [self setTopWithFloat:top];
}

- (void)setAboveWithTuxkidsTuxblocksCoreDefenseSelectProblemButton:(TuxkidsTuxblocksCoreDefenseSelectProblemButton *)above {
  self.above_ = above;
}

- (void)setBelowWithTuxkidsTuxblocksCoreDefenseSelectProblemButton:(TuxkidsTuxblocksCoreDefenseSelectProblemButton *)below {
  self.below_ = below;
}

- (TuxkidsTuxblocksCoreDefenseSelectProblemButton *)above {
  return above__;
}

- (TuxkidsTuxblocksCoreDefenseSelectProblemButton *)below {
  return below__;
}

- (TuxkidsTuxblocksCoreDefenseSelectProblem *)problem {
  return problem__;
}

- (id)initWithTuxkidsTuxblocksCoreDefenseSelectProblem:(TuxkidsTuxblocksCoreDefenseSelectProblem *)problem
                                             withFloat:(float)width
                                             withFloat:(float)minHeight
                                               withInt:(int)towerColor {
  if ((self = [super initWithPlaynCoreImage:[TuxkidsTuxblocksCoreDefenseSelectProblemButton createImageWithTuxkidsTuxblocksCoreDefenseSelectProblem:problem withFloat:width withFloat:minHeight withInt:towerColor] withBOOL:NO])) {
    targetAlpha_ = 1;
    self.problem_ = problem;
    self.minHeight = minHeight;
    self.towerColor = towerColor;
  }
  return self;
}

+ (id<PlaynCoreImage>)createImageWithTuxkidsTuxblocksCoreDefenseSelectProblem:(TuxkidsTuxblocksCoreDefenseSelectProblem *)problem
                                                                    withFloat:(float)width
                                                                    withFloat:(float)minHeight
                                                                      withInt:(int)towerColor {
  float strokeWidth = 5;
  float padding = strokeWidth * 2;
  float rectRad = strokeWidth * 1.5f;
  float eqTextSize = (minHeight - padding * 2) * 0.25f;
  PlaynCoreTextFormat *textFormat = [((PlaynCoreTextFormat *) [[PlaynCoreTextFormat alloc] init]) withFontWithPlaynCoreFont:[((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCorePlayNObject graphics])) createFontWithNSString:[TuxkidsTuxblocksCoreConstant FONT_NAME] withPlaynCoreFont_StyleEnum:[PlaynCoreFont_StyleEnum PLAIN] withFloat:eqTextSize]];
  TuxkidsTuxblocksCoreSolveMarkupExpressionWriter *writer = [((TuxkidsTuxblocksCoreSolveMarkupRenderer *) nil_chk([((TuxkidsTuxblocksCoreSolveBlocksEquation *) nil_chk([((TuxkidsTuxblocksCoreDefenseSelectProblem *) nil_chk(problem)) equation])) renderer])) getExpressionWriterWithPlaynCoreTextFormat:textFormat];
  float eqWidth = [((TuxkidsTuxblocksCoreSolveMarkupExpressionWriter *) nil_chk(writer)) width];
  float eqHeight = [((TuxkidsTuxblocksCoreSolveMarkupExpressionWriter *) nil_chk(writer)) height];
  float height = [JavaLangMath maxWithFloat:eqHeight + padding * 2 withFloat:minHeight];
  id<PlaynCoreCanvasImage> image = [((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCorePlayNObject graphics])) createImageWithFloat:width withFloat:height];
  id<PlaynCoreCanvas> canvas = [((id<PlaynCoreCanvasImage>) nil_chk(image)) canvas];
  float rewardImageSize = minHeight - padding * 2;
  float cellSize = rewardImageSize / 3;
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) setFillColorWithInt:[TripleplayUtilColors WHITE]];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) setStrokeColorWithInt:[TripleplayUtilColors DARK_GRAY]];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) setStrokeWidthWithFloat:strokeWidth];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) fillRoundRectWithFloat:strokeWidth / 2 withFloat:strokeWidth / 2 withFloat:width - strokeWidth withFloat:height - strokeWidth withFloat:rectRad];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) strokeRoundRectWithFloat:strokeWidth / 2 withFloat:strokeWidth / 2 withFloat:width - strokeWidth withFloat:height - strokeWidth withFloat:rectRad];
  TuxkidsTuxblocksCoreDefenseTowerTowerTypeEnum *reward = ((TuxkidsTuxblocksCoreDefenseRoundReward *) nil_chk([((TuxkidsTuxblocksCoreDefenseSelectProblem *) nil_chk(problem)) reward])).tower;
  id<PlaynCoreImage> rewardImage = [((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk([((TuxkidsTuxblocksCoreDefenseTowerTowerTypeEnum *) nil_chk(reward)) instance])) createImageWithFloat:cellSize withInt:towerColor];
  float rewardImageX = width - padding - (rewardImageSize + [((id<PlaynCoreImage>) nil_chk(rewardImage)) width]) / 2;
  float rewardImageY = padding + (rewardImageSize - [((id<PlaynCoreImage>) nil_chk(rewardImage)) height]) / 2;
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) drawImageWithPlaynCoreImage:rewardImage withFloat:rewardImageX withFloat:rewardImageY];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) setFillColorWithInt:[TripleplayUtilColors BLACK]];
  PlaynCoreTextFormat *countFormat = [((PlaynCoreTextFormat *) [[PlaynCoreTextFormat alloc] init]) withFontWithPlaynCoreFont:[((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCorePlayNObject graphics])) createFontWithNSString:[TuxkidsTuxblocksCoreConstant FONT_NAME] withPlaynCoreFont_StyleEnum:[PlaynCoreFont_StyleEnum PLAIN] withFloat:rewardImageSize / 5]];
  id<PlaynCoreTextLayout> countLayout = [((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCorePlayNObject graphics])) layoutTextWithNSString:[NSString stringWithFormat:@"x%d", ((TuxkidsTuxblocksCoreDefenseRoundReward *) nil_chk([((TuxkidsTuxblocksCoreDefenseSelectProblem *) nil_chk(problem)) reward])).count] withPlaynCoreTextFormat:countFormat];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) fillTextWithPlaynCoreTextLayout:countLayout withFloat:width - padding - rewardImageSize withFloat:padding];
  float lineX = width - padding * 2 - rewardImageSize;
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) drawLineWithFloat:lineX withFloat:0 withFloat:lineX withFloat:height];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) setStrokeWidthWithFloat:1];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) setFillColorWithInt:[TripleplayUtilColors BLACK]];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) setStrokeColorWithInt:[TripleplayUtilColors BLACK]];
  float eqStartX = (lineX - eqWidth) / 2;
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) save];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) translateWithFloat:eqStartX withFloat:(height - [((TuxkidsTuxblocksCoreSolveMarkupExpressionWriter *) nil_chk(writer)) height]) / 2];
  [((TuxkidsTuxblocksCoreSolveMarkupExpressionWriter *) nil_chk(writer)) drawExpressionWithPlaynCoreCanvas:canvas withTuxkidsTuxblocksCoreSolveMarkupExpressionWriter_Config:[[TuxkidsTuxblocksCoreSolveMarkupExpressionWriter_Config alloc] initWithInt:[TripleplayUtilColors BLACK] withInt:[TripleplayUtilColors BLACK] withInt:[TripleplayUtilColors BLACK]]];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) restore];
  return image;
}

- (void)fadeInWithFloat:(float)targetAlpha {
  (void) [((id<PlaynCoreLayer>) nil_chk([self layerAddable])) setAlphaWithFloat:0];
  self.targetAlpha = targetAlpha;
}

- (void)fadeOut {
  self.targetAlpha = 0;
}

- (void)paintWithPlaynCoreUtilClock:(id<PlaynCoreUtilClock>)clock {
  id<PlaynCoreLayer> layer = [self layerAddable];
  if ([((id<PlaynCoreLayer>) nil_chk(layer)) alpha] != targetAlpha_) {
    (void) [((id<PlaynCoreLayer>) nil_chk(layer)) setAlphaWithFloat:[TuxkidsTuxblocksCorePlayNObject lerpTimeWithFloat:[((id<PlaynCoreLayer>) nil_chk(layer)) alpha] withFloat:targetAlpha_ withFloat:0.99f withFloat:[((id<PlaynCoreUtilClock>) nil_chk(clock)) dt]]];
    if ([JavaLangMath absWithFloat:[((id<PlaynCoreLayer>) nil_chk(layer)) alpha] - targetAlpha_] < 0.01) (void) [((id<PlaynCoreLayer>) nil_chk(layer)) setAlphaWithFloat:targetAlpha_];
  }
  float desiredY = above__ == nil ? 0 : [((TuxkidsTuxblocksCoreDefenseSelectProblemButton *) nil_chk(above__)) bottom];
  desiredY += TuxkidsTuxblocksCoreDefenseSelectProblemButton_MARGIN + [self height] / 2;
  float y = [TuxkidsTuxblocksCorePlayNObject lerpTimeWithFloat:[self y] withFloat:desiredY withFloat:0.99f withFloat:[((id<PlaynCoreUtilClock>) nil_chk(clock)) dt]];
  [self setPositionWithFloat:[self x] withFloat:y];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TuxkidsTuxblocksCoreDefenseSelectProblemButton *typedCopy = (TuxkidsTuxblocksCoreDefenseSelectProblemButton *) copy;
  typedCopy.problem_ = problem__;
  typedCopy.minHeight = minHeight_;
  typedCopy.above_ = above__;
  typedCopy.below_ = below__;
  typedCopy.towerColor = towerColor_;
  typedCopy.targetAlpha = targetAlpha_;
}

@end
