//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: core/src/main/java/tuxkids/tuxblocks/core/defense/DefenseScreen.java
//
//  Created by Thomas on 7/25/13.
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "java/lang/Integer.h"
#include "playn/core/Graphics.h"
#include "playn/core/GroupLayer.h"
#include "playn/core/Layer.h"
#include "playn/core/Pointer.h"
#include "playn/core/util/Clock.h"
#include "tripleplay/game/Screen.h"
#include "tripleplay/game/ScreenStack.h"
#include "tripleplay/game/trans/SlideTransition.h"
#include "tuxkids/tuxblocks/core/Button.h"
#include "tuxkids/tuxblocks/core/Constant.h"
#include "tuxkids/tuxblocks/core/GameState.h"
#include "tuxkids/tuxblocks/core/MenuSprite.h"
#include "tuxkids/tuxblocks/core/defense/DefenseScreen.h"
#include "tuxkids/tuxblocks/core/defense/Grid.h"
#include "tuxkids/tuxblocks/core/defense/Inventory.h"
#include "tuxkids/tuxblocks/core/defense/round/Level.h"
#include "tuxkids/tuxblocks/core/defense/select/SelectScreen.h"
#include "tuxkids/tuxblocks/core/screen/GameScreen.h"
#include "tuxkids/tuxblocks/core/utils/Formatter.h"

@implementation TuxkidsTuxblocksCoreDefenseDefenseScreen

@synthesize grid = grid_;
@synthesize inventory = inventory_;
@synthesize gridHolder = gridHolder_;
@synthesize selectScreen = selectScreen_;
@synthesize buttonPlus = buttonPlus_;
@synthesize buttonStart = buttonStart_;
@synthesize menuSprite = menuSprite_;

- (id)initWithTripleplayGameScreenStack:(TripleplayGameScreenStack *)screens
      withTuxkidsTuxblocksCoreGameState:(TuxkidsTuxblocksCoreGameState *)gameState {
  return [super initWithTripleplayGameScreenStack:screens withTuxkidsTuxblocksCoreGameState:gameState];
}

- (void)wasAdded {
  float titleBarHeight = [TuxkidsTuxblocksCoreScreenGameScreen defaultButtonSize] * 1.2f;
  float maxGridWidth = [self width] * 0.7f;
  TuxkidsTuxblocksCoreDefenseGrid *testGrid = [[TuxkidsTuxblocksCoreDefenseGrid alloc] initWithTuxkidsTuxblocksCoreGameState:state__ withInt:15 withInt:21 withInt:(int) maxGridWidth withInt:(int) ([self height] - titleBarHeight)];
  grid_ = testGrid;
  [((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(grid_)) setTowerColorWithInt:[((TuxkidsTuxblocksCoreGameState *) nil_chk(state__)) themeColor]];
  gridHolder_ = [((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCoreScreenGameScreen graphics])) createGroupLayer];
  [((id<PlaynCoreGroupLayer>) nil_chk(gridHolder_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(grid_)) layer]];
  (void) [((id<PlaynCoreGroupLayer>) nil_chk(gridHolder_)) setTranslationWithFloat:[self width] - [((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(testGrid)) width] withFloat:([self height] + titleBarHeight - [((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(testGrid)) height]) / 2];
  (void) [((id<PlaynCoreGroupLayer>) nil_chk(gridHolder_)) setDepthWithFloat:1];
  [((id<PlaynCoreGroupLayer>) nil_chk(layer_)) addWithPlaynCoreLayer:gridHolder_];
  inventory_ = [[TuxkidsTuxblocksCoreDefenseInventory alloc] initWithTuxkidsTuxblocksCoreDefenseDefenseScreen:self withTuxkidsTuxblocksCoreDefenseGrid:grid_ withInt:(int) ([self width] - [((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(testGrid)) width]) withInt:(int) ([self height] - titleBarHeight)];
  (void) [((id<PlaynCoreGroupLayer>) nil_chk([((TuxkidsTuxblocksCoreDefenseInventory *) nil_chk(inventory_)) layer])) setDepthWithFloat:1];
  (void) [((id<PlaynCoreGroupLayer>) nil_chk([((TuxkidsTuxblocksCoreDefenseInventory *) nil_chk(inventory_)) layer])) setTyWithFloat:titleBarHeight];
  [((id<PlaynCoreGroupLayer>) nil_chk(layer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreDefenseInventory *) nil_chk(inventory_)) layer]];
  menuSprite_ = [[TuxkidsTuxblocksCoreMenuSprite alloc] initWithFloat:[self width] withFloat:titleBarHeight];
  [((id<PlaynCoreGroupLayer>) nil_chk(layer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreMenuSprite *) nil_chk(menuSprite_)) layer]];
  selectScreen_ = [[TuxkidsTuxblocksCoreDefenseSelectSelectScreen alloc] initWithTripleplayGameScreenStack:screens_ withTuxkidsTuxblocksCoreGameState:state__ withTuxkidsTuxblocksCoreDefenseGrid:grid_];
  [self createPlusButton];
  [self createStartButton];
}

- (void)createPlusButton {
  float size = [TuxkidsTuxblocksCoreScreenGameScreen defaultButtonSize];
  buttonPlus_ = [self createMenuButtonWithNSString:[TuxkidsTuxblocksCoreConstant BUTTON_PLUS]];
  [((TuxkidsTuxblocksCoreButton *) nil_chk(buttonPlus_)) setPositionWithFloat:size * 0.6f withFloat:size * 0.6f];
  (void) [((id<PlaynCoreLayer>) nil_chk([((TuxkidsTuxblocksCoreButton *) nil_chk(buttonPlus_)) layerAddable])) setDepthWithFloat:1];
  [((id<PlaynCoreGroupLayer>) nil_chk(layer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreButton *) nil_chk(buttonPlus_)) layerAddable]];
  [((TuxkidsTuxblocksCoreButton *) nil_chk(buttonPlus_)) setOnReleasedListenerWithTuxkidsTuxblocksCoreButton_OnReleasedListener:[[TuxkidsTuxblocksCoreDefenseDefenseScreen_$1 alloc] initWithTuxkidsTuxblocksCoreDefenseDefenseScreen:self]];
}

- (void)createStartButton {
  float size = [TuxkidsTuxblocksCoreScreenGameScreen defaultButtonSize];
  buttonStart_ = [self createMenuButtonWithNSString:[TuxkidsTuxblocksCoreConstant BUTTON_OK]];
  [((TuxkidsTuxblocksCoreButton *) nil_chk(buttonStart_)) setPositionWithFloat:[self width] - size * 0.6f withFloat:size * 0.6f];
  (void) [((id<PlaynCoreLayer>) nil_chk([((TuxkidsTuxblocksCoreButton *) nil_chk(buttonStart_)) layerAddable])) setDepthWithFloat:1];
  [((id<PlaynCoreGroupLayer>) nil_chk(layer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreButton *) nil_chk(buttonStart_)) layerAddable]];
  [((TuxkidsTuxblocksCoreButton *) nil_chk(buttonStart_)) setOnReleasedListenerWithTuxkidsTuxblocksCoreButton_OnReleasedListener:[[TuxkidsTuxblocksCoreDefenseDefenseScreen_$2 alloc] initWithTuxkidsTuxblocksCoreDefenseDefenseScreen:self]];
}

- (void)wasShown {
  [super wasShown];
  [((TuxkidsTuxblocksCoreDefenseInventory *) nil_chk(inventory_)) refreshCountSprites];
}

- (void)showTransitionCompleted {
  [super showTransitionCompleted];
}

- (void)updateWithInt:(int)delta {
  [super updateWithInt:delta];
  [((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(grid_)) updateWithInt:delta];
  TuxkidsTuxblocksCoreDefenseRoundLevel *level = [((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(grid_)) level];
  (void) [((id<PlaynCoreLayer>) nil_chk([((TuxkidsTuxblocksCoreButton *) nil_chk(buttonStart_)) layerAddable])) setVisibleWithBOOL:NO];
  if ([((TuxkidsTuxblocksCoreDefenseRoundLevel *) nil_chk(level)) finished]) {
    [((TuxkidsTuxblocksCoreMenuSprite *) nil_chk(menuSprite_)) setTextWithNSString:@"Level Complete!"];
  }
  if ([((TuxkidsTuxblocksCoreDefenseRoundLevel *) nil_chk(level)) duringRound]) {
    [((TuxkidsTuxblocksCoreMenuSprite *) nil_chk(menuSprite_)) setTextWithNSString:[NSString stringWithFormat:@"Round %d", [((TuxkidsTuxblocksCoreDefenseRoundLevel *) nil_chk(level)) round]]];
  }
  else {
    int nextRoundIn = [((TuxkidsTuxblocksCoreDefenseRoundLevel *) nil_chk([((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(grid_)) level])) timeUntilNextRound] / 1000 + 1;
    [((TuxkidsTuxblocksCoreMenuSprite *) nil_chk(menuSprite_)) setTextWithNSString:[TuxkidsTuxblocksCoreUtilsFormatter formatWithNSString:@"Next round in %d..." withNSObjectArray:[IOSObjectArray arrayWithObjects:(id[]){ [JavaLangInteger valueOfWithInt:nextRoundIn] } count:1 type:[IOSClass classWithClass:[NSObject class]]]]];
    (void) [((id<PlaynCoreLayer>) nil_chk([((TuxkidsTuxblocksCoreButton *) nil_chk(buttonStart_)) layerAddable])) setVisibleWithBOOL:YES];
  }
}

- (void)paintWithPlaynCoreUtilClock:(id<PlaynCoreUtilClock>)clock {
  [super paintWithPlaynCoreUtilClock:clock];
  [((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(grid_)) paintWithPlaynCoreUtilClock:clock];
}

- (void)pushSelectScreen {
  [self pushScreenWithTuxkidsTuxblocksCoreScreenGameScreen:selectScreen_ withTripleplayGameScreenStack_Transition:[((TripleplayGameTransSlideTransition *) nil_chk([((TripleplayGameScreenStack *) nil_chk(screens_)) slide])) right]];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TuxkidsTuxblocksCoreDefenseDefenseScreen *typedCopy = (TuxkidsTuxblocksCoreDefenseDefenseScreen *) copy;
  typedCopy.grid = grid_;
  typedCopy.inventory = inventory_;
  typedCopy.gridHolder = gridHolder_;
  typedCopy.selectScreen = selectScreen_;
  typedCopy.buttonPlus = buttonPlus_;
  typedCopy.buttonStart = buttonStart_;
  typedCopy.menuSprite = menuSprite_;
}

@end
@implementation TuxkidsTuxblocksCoreDefenseDefenseScreen_$1

@synthesize this$0 = this$0_;

- (void)onReleaseWithPlaynCorePointer_Event:(id<PlaynCorePointer_Event>)event
                                   withBOOL:(BOOL)inButton {
  if (inButton) [this$0_ pushSelectScreen];
}

- (id)initWithTuxkidsTuxblocksCoreDefenseDefenseScreen:(TuxkidsTuxblocksCoreDefenseDefenseScreen *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TuxkidsTuxblocksCoreDefenseDefenseScreen_$1 *typedCopy = (TuxkidsTuxblocksCoreDefenseDefenseScreen_$1 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
@implementation TuxkidsTuxblocksCoreDefenseDefenseScreen_$2

@synthesize this$0 = this$0_;

- (void)onReleaseWithPlaynCorePointer_Event:(id<PlaynCorePointer_Event>)event
                                   withBOOL:(BOOL)inButton {
  if (inButton) {
    [((TuxkidsTuxblocksCoreDefenseRoundLevel *) nil_chk([((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(this$0_.grid)) level])) startNextRound];
  }
}

- (id)initWithTuxkidsTuxblocksCoreDefenseDefenseScreen:(TuxkidsTuxblocksCoreDefenseDefenseScreen *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TuxkidsTuxblocksCoreDefenseDefenseScreen_$2 *typedCopy = (TuxkidsTuxblocksCoreDefenseDefenseScreen_$2 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
