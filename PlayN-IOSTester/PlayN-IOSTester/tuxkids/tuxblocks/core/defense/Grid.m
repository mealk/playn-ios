//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: core/src/main/java/tuxkids/tuxblocks/core/defense/Grid.java
//
//  Created by Thomas on 7/25/13.
//

#include "IOSBooleanArray.h"
#include "IOSClass.h"
#include "IOSIntArray.h"
#include "IOSObjectArray.h"
#include "java/lang/Boolean.h"
#include "java/lang/Float.h"
#include "java/lang/Math.h"
#include "java/util/ArrayList.h"
#include "java/util/HashMap.h"
#include "java/util/Iterator.h"
#include "java/util/List.h"
#include "playn/core/Canvas.h"
#include "playn/core/CanvasImage.h"
#include "playn/core/Graphics.h"
#include "playn/core/GroupLayer.h"
#include "playn/core/Image.h"
#include "playn/core/ImageLayer.h"
#include "playn/core/Layer.h"
#include "playn/core/Platform.h"
#include "playn/core/PlayN.h"
#include "playn/core/Touch.h"
#include "playn/core/util/Clock.h"
#include "pythagoras/f/Vector.h"
#include "pythagoras/i/Point.h"
#include "tripleplay/particle/Emitter.h"
#include "tripleplay/particle/Particles.h"
#include "tripleplay/particle/TuxParticles.h"
#include "tripleplay/util/Colors.h"
#include "tuxkids/tuxblocks/core/GameState.h"
#include "tuxkids/tuxblocks/core/ImageLayerTintable.h"
#include "tuxkids/tuxblocks/core/PlayNObject.h"
#include "tuxkids/tuxblocks/core/defense/Grid.h"
#include "tuxkids/tuxblocks/core/defense/GridObject.h"
#include "tuxkids/tuxblocks/core/defense/Pathing.h"
#include "tuxkids/tuxblocks/core/defense/projectile/ChainProjectile.h"
#include "tuxkids/tuxblocks/core/defense/projectile/Projectile.h"
#include "tuxkids/tuxblocks/core/defense/round/Level.h"
#include "tuxkids/tuxblocks/core/defense/round/Round.h"
#include "tuxkids/tuxblocks/core/defense/tower/Tower.h"
#include "tuxkids/tuxblocks/core/defense/walker/Walker.h"
#include "tuxkids/tuxblocks/core/effect/Effect.h"
#include "tuxkids/tuxblocks/core/utils/MultiList.h"

@implementation TuxkidsTuxblocksCoreDefenseGrid

@synthesize cellSize_ = cellSize__;
@synthesize rows_ = rows__;
@synthesize cols_ = cols__;
@synthesize layer_ = layer__;
@synthesize gridLayer = gridLayer_;
@synthesize overlayLayer = overlayLayer_;
@synthesize gridSprite = gridSprite_;
@synthesize passability = passability_;
@synthesize walkers = walkers_;
@synthesize projectiles = projectiles_;
@synthesize towers = towers_;
@synthesize effects = effects_;
@synthesize gridObjects = gridObjects_;
@synthesize walkerStart = walkerStart_;
@synthesize walkerDestination = walkerDestination_;
@synthesize toPlace = toPlace_;
@synthesize toPlaceRadius = toPlaceRadius_;
@synthesize currentPath_ = currentPath__;
@synthesize level_ = level__;
@synthesize targetAlpha = targetAlpha_;
@synthesize towerColor_ = towerColor__;
@synthesize particles_ = particles__;
@synthesize state = state_;
@synthesize validPlacementMap = validPlacementMap_;

- (TripleplayParticleParticles *)particles {
  return particles__;
}

- (TuxkidsTuxblocksCoreDefenseRoundLevel *)level {
  return level__;
}

- (int)towerColor {
  return towerColor__;
}

- (int)width {
  return cols__ * cellSize__;
}

- (int)height {
  return rows__ * cellSize__;
}

- (int)rows {
  return rows__;
}

- (int)cols {
  return cols__;
}

- (id<JavaUtilList>)currentPath {
  return currentPath__;
}

- (id<PlaynCoreGroupLayer>)layer {
  return layer__;
}

- (IOSObjectArray *)getPassability {
  return passability_;
}

- (float)cellSize {
  return cellSize__;
}

- (void)setTowerColorWithInt:(int)themeColor {
  self.towerColor_ = themeColor;
}

- (id)initWithTuxkidsTuxblocksCoreGameState:(TuxkidsTuxblocksCoreGameState *)gameState
                                    withInt:(int)rows
                                    withInt:(int)cols
                                    withInt:(int)maxWidth
                                    withInt:(int)maxHeight {
  if ((self = [super init])) {
    walkers_ = [[JavaUtilArrayList alloc] init];
    projectiles_ = [[JavaUtilArrayList alloc] init];
    towers_ = [[JavaUtilArrayList alloc] init];
    effects_ = [[JavaUtilArrayList alloc] init];
    gridObjects_ = [[TuxkidsTuxblocksCoreUtilsMultiList alloc] initWithJavaUtilListArray:[IOSObjectArray arrayWithObjects:(id[]){ walkers_, projectiles_, towers_, effects_ } count:4 type:[IOSClass classWithProtocol:@protocol(JavaUtilList)]]];
    targetAlpha_ = 1;
    validPlacementMap_ = [[JavaUtilHashMap alloc] init];
    self.state = gameState;
    self.rows_ = rows;
    self.cols_ = cols;
    passability_ = [IOSBooleanArray arrayWithDimensions:2 lengths:(int[]){ rows, cols }];
    for (int i = 0; i < rows; i++) {
      for (int j = 0; j < cols; j++) {
        (*[((IOSBooleanArray *) nil_chk([((IOSObjectArray *) nil_chk(passability_)) objectAtIndex:i])) booleanRefAtIndex:j]) = YES;
      }
    }
    int maxRowSize = maxHeight / rows, maxColSize = maxWidth / cols;
    cellSize__ = [JavaLangMath minWithInt:maxRowSize withInt:maxColSize];
    layer__ = [((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCorePlayNObject graphics])) createGroupLayer];
    gridLayer_ = [((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCorePlayNObject graphics])) createGroupLayer];
    [((id<PlaynCoreGroupLayer>) nil_chk(layer__)) addWithPlaynCoreLayer:gridLayer_];
    overlayLayer_ = [((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCorePlayNObject graphics])) createGroupLayer];
    (void) [((id<PlaynCoreGroupLayer>) nil_chk(overlayLayer_)) setDepthWithFloat:1];
    [((id<PlaynCoreGroupLayer>) nil_chk(layer__)) addWithPlaynCoreLayer:overlayLayer_];
    walkerStart_ = [[PythagorasIPoint alloc] initWithInt:rows / 2 withInt:0];
    walkerDestination_ = [[PythagorasIPoint alloc] initWithInt:rows / 2 withInt:cols - 1];
    for (int i = 0; i < rows; i++) {
      if (i != rows / 2) {
        (*[((IOSBooleanArray *) nil_chk([((IOSObjectArray *) nil_chk(passability_)) objectAtIndex:i])) booleanRefAtIndex:0]) = NO;
        (*[((IOSBooleanArray *) nil_chk([((IOSObjectArray *) nil_chk(passability_)) objectAtIndex:i])) booleanRefAtIndex:cols - 1]) = NO;
      }
    }
    for (int i = 0; i < cols; i++) {
      (*[((IOSBooleanArray *) nil_chk([((IOSObjectArray *) nil_chk(passability_)) objectAtIndex:0])) booleanRefAtIndex:i]) = NO;
      (*[((IOSBooleanArray *) nil_chk([((IOSObjectArray *) nil_chk(passability_)) objectAtIndex:rows - 1])) booleanRefAtIndex:i]) = NO;
    }
    [self refreshPath];
    [self createGridSprite];
    particles__ = [[TripleplayParticleTuxParticles alloc] init];
    level__ = [TuxkidsTuxblocksCoreDefenseRoundLevel generate];
    [((TuxkidsTuxblocksCoreDefenseRoundLevel *) nil_chk(level__)) setRoundCompletedListenerWithTuxkidsTuxblocksCoreDefenseRoundLevel_RoundCompletedListener:self];
  }
  return self;
}

- (TripleplayParticleEmitter *)createEmitterWithInt:(int)maxParticles
                                 withPlaynCoreImage:(id<PlaynCoreImage>)image {
  TripleplayParticleEmitter *e = [((TripleplayParticleParticles *) nil_chk(particles__)) createEmitterWithInt:maxParticles withPlaynCoreImage:image withPlaynCoreGroupLayer:overlayLayer_];
  return e;
}

- (void)fadeInWithFloat:(float)targetAlpha {
  self.targetAlpha = targetAlpha;
  (void) [((id<PlaynCoreGroupLayer>) nil_chk(layer__)) setAlphaWithFloat:0];
}

- (void)updateWithInt:(int)delta {
  if ([((id<PlaynCoreGroupLayer>) nil_chk(layer__)) alpha] < targetAlpha_ * 0.99f) {
    (void) [((id<PlaynCoreGroupLayer>) nil_chk(layer__)) setAlphaWithFloat:[TuxkidsTuxblocksCorePlayNObject lerpTimeWithFloat:[((id<PlaynCoreGroupLayer>) nil_chk(layer__)) alpha] withFloat:targetAlpha_ withFloat:0.99f withFloat:delta]];
  }
  else {
    (void) [((id<PlaynCoreGroupLayer>) nil_chk(layer__)) setAlphaWithFloat:targetAlpha_];
  }
  TuxkidsTuxblocksCoreDefenseWalkerWalker *walker = [((TuxkidsTuxblocksCoreDefenseRoundLevel *) nil_chk(level__)) updateWithInt:delta];
  if (walker != nil) {
    [self addWalkerWithTuxkidsTuxblocksCoreDefenseWalkerWalker:[walker placeWithTuxkidsTuxblocksCoreDefenseGrid:self withPythagorasIPoint:walkerStart_ withPythagorasIPoint:walkerDestination_ withFloat:0]];
  }
  int nObjects = [((TuxkidsTuxblocksCoreUtilsMultiList *) nil_chk(gridObjects_)) size];
  for (int i = 0; i < nObjects; i++) {
    TuxkidsTuxblocksCoreDefenseGridObject *gridObject = [((TuxkidsTuxblocksCoreUtilsMultiList *) nil_chk(gridObjects_)) getWithInt:i];
    if ([((TuxkidsTuxblocksCoreDefenseGridObject *) nil_chk(gridObject)) updateWithInt:delta]) {
      [((TuxkidsTuxblocksCoreUtilsMultiList *) nil_chk(gridObjects_)) removeWithId:gridObject];
      i--;
      nObjects--;
      continue;
    }
  }
  [self updateToPlace];
}

- (void)paintWithPlaynCoreUtilClock:(id<PlaynCoreUtilClock>)clock {
  int nObjects = [((TuxkidsTuxblocksCoreUtilsMultiList *) nil_chk(gridObjects_)) size];
  for (int i = 0; i < nObjects; i++) {
    TuxkidsTuxblocksCoreDefenseGridObject *gridObject = [((TuxkidsTuxblocksCoreUtilsMultiList *) nil_chk(gridObjects_)) getWithInt:i];
    [((TuxkidsTuxblocksCoreDefenseGridObject *) nil_chk(gridObject)) paintWithPlaynCoreUtilClock:clock];
  }
  [((TripleplayParticleParticles *) nil_chk(particles__)) paintWithPlaynCoreUtilClock:clock];
}

- (void)refreshPath {
  currentPath__ = [TuxkidsTuxblocksCoreDefensePathing getPathWithTuxkidsTuxblocksCoreDefenseGrid:self withPythagorasIPoint:walkerStart_ withPythagorasIPoint:walkerDestination_];
}

- (void)addWalkerWithTuxkidsTuxblocksCoreDefenseWalkerWalker:(TuxkidsTuxblocksCoreDefenseWalkerWalker *)walker {
  [((id<JavaUtilList>) nil_chk(walkers_)) addWithId:walker];
  [((id<PlaynCoreGroupLayer>) nil_chk(gridLayer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk(walker)) layerAddable]];
}

- (void)createGridSprite {
  if (gridSprite_ != nil) {
    [((id<PlaynCoreGroupLayer>) nil_chk(gridLayer_)) removeWithPlaynCoreLayer:gridSprite_];
  }
  id<PlaynCoreCanvasImage> image = [((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCorePlayNObject graphics])) createImageWithFloat:[self width] withFloat:[self height]];
  id<PlaynCoreCanvas> canvas = [((id<PlaynCoreCanvasImage>) nil_chk(image)) canvas];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) setFillColorWithInt:[TripleplayUtilColors WHITE]];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) fillRectWithFloat:0 withFloat:0 withFloat:[self width] withFloat:[self height]];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) setStrokeColorWithInt:[TripleplayUtilColors BLACK]];
  for (int i = 0; i < rows__; i++) {
    for (int j = 0; j < cols__; j++) {
      int x = j * cellSize__;
      int y = i * cellSize__;
      (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) setFillColorWithInt:[TripleplayUtilColors WHITE]];
      if (![((IOSBooleanArray *) nil_chk([((IOSObjectArray *) nil_chk(passability_)) objectAtIndex:i])) booleanAtIndex:j]) {
        (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) setFillColorWithInt:[TripleplayUtilColors GRAY]];
      }
      (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) fillRectWithFloat:x withFloat:y withFloat:cellSize__ withFloat:cellSize__];
      if (TuxkidsTuxblocksCoreDefenseGrid_SHOW_GRID) (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) strokeRectWithFloat:x withFloat:y withFloat:cellSize__ withFloat:cellSize__];
    }
  }
  gridSprite_ = [((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCorePlayNObject graphics])) createImageLayerWithPlaynCoreImage:image];
  [((id<PlaynCoreGroupLayer>) nil_chk(gridLayer_)) addWithPlaynCoreLayer:gridSprite_];
  (void) [((id<PlaynCoreImageLayer>) nil_chk(gridSprite_)) setDepthWithFloat:-1];
}

- (PythagorasIPoint *)getCellWithFloat:(float)x
                             withFloat:(float)y {
  int r = [JavaLangMath minWithInt:[JavaLangMath maxWithInt:(int) y / cellSize__ withInt:0] withInt:rows__ - 1];
  int c = [JavaLangMath minWithInt:[JavaLangMath maxWithInt:(int) x / cellSize__ withInt:0] withInt:cols__ - 1];
  return [[PythagorasIPoint alloc] initWithInt:r withInt:c];
}

- (PythagorasIPoint *)getCellWithFloat:(float)x
                             withFloat:(float)y
                             withFloat:(float)width
                             withFloat:(float)height {
  return [self getCellWithFloat:x - width / 2 + [self cellSize] / 2 withFloat:y - height / 2 + [self cellSize] / 2];
}

- (float)getPlaceXWithFloat:(float)globalX {
  float placeX = globalX - [TuxkidsTuxblocksCorePlayNObject getGlobalTxWithPlaynCoreLayer:gridLayer_];
  if ([((id<PlaynCoreTouch>) nil_chk([((id<PlaynCorePlatform>) nil_chk([PlaynCorePlayN platform])) touch])) hasTouch]) placeX -= [self width] / 20;
  return placeX;
}

- (float)getPlaceYWithFloat:(float)globalY {
  float placeY = globalY - [TuxkidsTuxblocksCorePlayNObject getGlobalTyWithPlaynCoreLayer:gridLayer_];
  if ([((id<PlaynCoreTouch>) nil_chk([((id<PlaynCorePlatform>) nil_chk([PlaynCorePlayN platform])) touch])) hasTouch]) placeY -= [self width] / 20;
  return placeY;
}

- (void)startPlacementWithTuxkidsTuxblocksCoreDefenseTowerTower:(TuxkidsTuxblocksCoreDefenseTowerTower *)toPlace {
  self.toPlace = toPlace;
  (void) [((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace)) previewWithTuxkidsTuxblocksCoreDefenseGrid:self];
  [((TuxkidsTuxblocksCoreImageLayerTintable *) nil_chk([((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace)) layer])) setVisibleWithBOOL:NO];
  [((id<PlaynCoreGroupLayer>) nil_chk(overlayLayer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace)) layerAddable]];
  [((JavaUtilHashMap *) nil_chk(validPlacementMap_)) clear];
  toPlaceRadius_ = [((id<PlaynCoreGraphics>) nil_chk([TuxkidsTuxblocksCorePlayNObject graphics])) createImageLayerWithPlaynCoreImage:[((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace)) createRadiusImage]];
  [TuxkidsTuxblocksCorePlayNObject centerImageLayerWithPlaynCoreImageLayer:toPlaceRadius_];
  [((id<PlaynCoreGroupLayer>) nil_chk(gridLayer_)) addWithPlaynCoreLayer:toPlaceRadius_];
  [self updateToPlace];
}

- (void)updatePlacementWithFloat:(float)globalX
                       withFloat:(float)globalY {
  float placeX = [self getPlaceXWithFloat:globalX], placeY = [self getPlaceYWithFloat:globalY];
  if (toPlace_ != nil) {
    PythagorasIPoint *cell = [self getCellWithFloat:placeX withFloat:placeY withFloat:[toPlace_ baseWidth] withFloat:[toPlace_ baseHeight]];
    [toPlace_ setCoordinatesWithPythagorasIPoint:cell];
    [((TuxkidsTuxblocksCoreImageLayerTintable *) nil_chk([toPlace_ layer])) setVisibleWithBOOL:![self isOutOfBoundsWithFloat:placeX withFloat:placeY]];
    [self updateToPlace];
  }
}

- (BOOL)endPlacementWithFloat:(float)globalX
                    withFloat:(float)globalY {
  BOOL canPlace = [self canPlace];
  if (canPlace) {
    (void) [((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace_)) placeWithTuxkidsTuxblocksCoreDefenseGrid:self withPythagorasIPoint:[((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace_)) coordinates]];
    [((id<PlaynCoreGroupLayer>) nil_chk(overlayLayer_)) removeWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace_)) layerAddable]];
    [((id<PlaynCoreGroupLayer>) nil_chk(gridLayer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace_)) layerAddable]];
    [((id<JavaUtilList>) nil_chk(towers_)) addWithId:toPlace_];
    [((id<PlaynCoreImageLayer>) nil_chk(toPlaceRadius_)) destroy];
    [self refreshPath];
  }
  else if (toPlace_ != nil) {
    [((TuxkidsTuxblocksCoreImageLayerTintable *) nil_chk([toPlace_ layer])) destroy];
  }
  toPlace_ = nil;
  [((id<PlaynCoreImageLayer>) nil_chk(toPlaceRadius_)) destroy];
  toPlaceRadius_ = nil;
  return canPlace;
}

- (void)updateToPlace {
  if (toPlace_ == nil) return;
  [((TuxkidsTuxblocksCoreImageLayerTintable *) nil_chk([((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace_)) layer])) setAlphaWithFloat:[self canPlace] ? 1 : 0.5f];
  (void) [((id<PlaynCoreImageLayer>) nil_chk(toPlaceRadius_)) setTranslationWithFloat:((PythagorasFVector *) nil_chk([((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace_)) position])).x_ withFloat:((PythagorasFVector *) nil_chk([((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace_)) position])).y_];
  (void) [((id<PlaynCoreImageLayer>) nil_chk(toPlaceRadius_)) setVisibleWithBOOL:[((TuxkidsTuxblocksCoreImageLayerTintable *) nil_chk([((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace_)) layer])) visible] && [((TuxkidsTuxblocksCoreImageLayerTintable *) nil_chk([((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace_)) layer])) alpha] == 1];
}

- (BOOL)canPlace {
  if (toPlace_ == nil) return NO;
  PythagorasIPoint *p = [((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace_)) coordinates];
  int rows = [((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace_)) rows], cols = [((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace_)) cols];
  if (((PythagorasIPoint *) nil_chk(p)).x_ < 0 || ((PythagorasIPoint *) nil_chk(p)).x_ + rows > self.rows_ || ((PythagorasIPoint *) nil_chk(p)).y_ < 0 || ((PythagorasIPoint *) nil_chk(p)).y_ + cols > self.cols_) {
    return NO;
  }
  for (int i = 0; i < rows; i++) {
    for (int j = 0; j < cols; j++) {
      {
        id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk(walkers_)) iterator];
        while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
          TuxkidsTuxblocksCoreDefenseWalkerWalker *walker = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
          PythagorasIPoint *walkerPos = [((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk(walker)) coordinates];
          if (((PythagorasIPoint *) nil_chk(walkerPos)).x_ == ((PythagorasIPoint *) nil_chk(p)).x_ + i && ((PythagorasIPoint *) nil_chk(walkerPos)).y_ == ((PythagorasIPoint *) nil_chk(p)).y_ + j) {
            return NO;
          }
        }
      }
    }
  }
  if ([((JavaUtilHashMap *) nil_chk(validPlacementMap_)) containsKeyWithId:p]) return [((JavaLangBoolean *) nil_chk([((JavaUtilHashMap *) nil_chk(validPlacementMap_)) getWithId:p])) booleanValue];
  BOOL canPlace = [self canPlaceStaticWithPythagorasIPoint:p];
  (void) [((JavaUtilHashMap *) nil_chk(validPlacementMap_)) putWithId:[((PythagorasIPoint *) nil_chk(p)) clone] withId:[JavaLangBoolean valueOfWithBOOL:canPlace]];
  return canPlace;
}

- (BOOL)canPlaceStaticWithPythagorasIPoint:(PythagorasIPoint *)p {
  int rows = [((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace_)) rows], cols = [((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(toPlace_)) cols];
  if ([((PythagorasIPoint *) nil_chk(p)) isEqual:walkerStart_]) return NO;
  for (int i = 0; i < rows; i++) {
    for (int j = 0; j < cols; j++) {
      if (![((IOSBooleanArray *) nil_chk([((IOSObjectArray *) nil_chk(passability_)) objectAtIndex:((PythagorasIPoint *) nil_chk(p)).x_ + i])) booleanAtIndex:((PythagorasIPoint *) nil_chk(p)).y_ + j]) return NO;
    }
  }
  for (int i = 0; i < rows; i++) {
    for (int j = 0; j < cols; j++) {
      (*[((IOSBooleanArray *) nil_chk([((IOSObjectArray *) nil_chk(passability_)) objectAtIndex:((PythagorasIPoint *) nil_chk(p)).x_ + i])) booleanRefAtIndex:((PythagorasIPoint *) nil_chk(p)).y_ + j]) = NO;
    }
  }
  id<JavaUtilList> path = [TuxkidsTuxblocksCoreDefensePathing getPathWithTuxkidsTuxblocksCoreDefenseGrid:self withPythagorasIPoint:walkerStart_ withPythagorasIPoint:walkerDestination_];
  for (int i = 0; i < rows; i++) {
    for (int j = 0; j < cols; j++) {
      (*[((IOSBooleanArray *) nil_chk([((IOSObjectArray *) nil_chk(passability_)) objectAtIndex:((PythagorasIPoint *) nil_chk(p)).x_ + i])) booleanRefAtIndex:((PythagorasIPoint *) nil_chk(p)).y_ + j]) = YES;
    }
  }
  return path != nil;
}

- (BOOL)fireProjectileWithTuxkidsTuxblocksCoreDefenseTowerTower:(TuxkidsTuxblocksCoreDefenseTowerTower *)tower {
  if ([((id<JavaUtilList>) nil_chk(walkers_)) size] == 0) return NO;
  TuxkidsTuxblocksCoreDefenseWalkerWalker *target = nil;
  float targetDis = JavaLangFloat_MAX_VALUE;
  {
    id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk(walkers_)) iterator];
    while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
      TuxkidsTuxblocksCoreDefenseWalkerWalker *walker = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
      if (![((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk(walker)) isAlive]) continue;
      float dis = [((PythagorasFVector *) nil_chk([((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk(walker)) position])) distanceWithPythagorasFIVector:[((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(tower)) position]];
      if (dis < [((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(tower)) range] * cellSize__) {
        if (walker == [((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(tower)) lastTarget]) {
          target = walker;
          targetDis = dis;
          break;
        }
        else if (dis < targetDis) {
          target = walker;
          targetDis = dis;
        }
      }
    }
  }
  [((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(tower)) setLastTargetWithTuxkidsTuxblocksCoreDefenseWalkerWalker:target];
  if (target == nil) return NO;
  TuxkidsTuxblocksCoreDefenseProjectileProjectile *p = [((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(tower)) createProjectile];
  [((TuxkidsTuxblocksCoreDefenseProjectileProjectile *) nil_chk(p)) placeWithTuxkidsTuxblocksCoreDefenseGrid:self withTuxkidsTuxblocksCoreDefenseWalkerWalker:target withTuxkidsTuxblocksCoreDefenseTowerTower:tower];
  [((id<PlaynCoreGroupLayer>) nil_chk(gridLayer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreDefenseProjectileProjectile *) nil_chk(p)) layer]];
  [((id<JavaUtilList>) nil_chk(projectiles_)) addWithId:p];
  return YES;
}

- (BOOL)fireProjectileWithTuxkidsTuxblocksCoreDefenseProjectileChainProjectile:(TuxkidsTuxblocksCoreDefenseProjectileChainProjectile *)from {
  if ([((id<JavaUtilList>) nil_chk(walkers_)) size] == 0) return NO;
  TuxkidsTuxblocksCoreDefenseWalkerWalker *target = nil;
  float targetDis = JavaLangFloat_MAX_VALUE;
  {
    id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk(walkers_)) iterator];
    while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
      TuxkidsTuxblocksCoreDefenseWalkerWalker *walker = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
      if (![((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk(walker)) isAlive]) continue;
      if ([((TuxkidsTuxblocksCoreDefenseProjectileChainProjectile *) nil_chk(from)) partOfChainWithTuxkidsTuxblocksCoreDefenseWalkerWalker:walker]) continue;
      float dis = [((PythagorasFVector *) nil_chk([((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk(walker)) position])) distanceWithPythagorasFIVector:[((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk([((TuxkidsTuxblocksCoreDefenseProjectileChainProjectile *) nil_chk(from)) target])) position]];
      if (dis < [((TuxkidsTuxblocksCoreDefenseProjectileChainProjectile *) nil_chk(from)) range] * cellSize__ && dis < targetDis) {
        target = walker;
        targetDis = dis;
      }
    }
  }
  if (target == nil) return NO;
  TuxkidsTuxblocksCoreDefenseProjectileChainProjectile *p = [((TuxkidsTuxblocksCoreDefenseProjectileChainProjectile *) nil_chk(from)) createProjectile];
  [((TuxkidsTuxblocksCoreDefenseProjectileChainProjectile *) nil_chk(p)) placeWithTuxkidsTuxblocksCoreDefenseGrid:self withTuxkidsTuxblocksCoreDefenseWalkerWalker:target withTuxkidsTuxblocksCoreDefenseProjectileChainProjectile:from];
  [((id<PlaynCoreGroupLayer>) nil_chk(gridLayer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreDefenseProjectileChainProjectile *) nil_chk(p)) layer]];
  [((id<JavaUtilList>) nil_chk(projectiles_)) addWithId:p];
  return YES;
}

- (void)dealDamageWithTuxkidsTuxblocksCoreDefenseTowerTower:(TuxkidsTuxblocksCoreDefenseTowerTower *)source
                withTuxkidsTuxblocksCoreDefenseWalkerWalker:(TuxkidsTuxblocksCoreDefenseWalkerWalker *)target
                                                  withFloat:(float)damage
                                      withPythagorasFVector:(PythagorasFVector *)hit {
  if ([((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(source)) splashRadius] == 0) {
    [((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk(target)) damageWithFloat:damage];
    [((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(source)) addBuffsWithTuxkidsTuxblocksCoreDefenseWalkerWalker:target];
  }
  else {
    float actualRadius = [((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(source)) splashRadius] * cellSize__;
    {
      id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk(walkers_)) iterator];
      while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
        TuxkidsTuxblocksCoreDefenseWalkerWalker *walker = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
        float distance = [((PythagorasFVector *) nil_chk([((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk(walker)) position])) distanceWithPythagorasFIVector:hit];
        float perc = (actualRadius - distance) / actualRadius;
        float dealt = perc * damage;
        if (dealt > 0) {
          [((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk(walker)) damageWithFloat:dealt];
          [((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(source)) addBuffsWithTuxkidsTuxblocksCoreDefenseWalkerWalker:walker];
        }
      }
    }
  }
}

- (TuxkidsTuxblocksCoreDefenseWalkerWalker *)getHitWalkerWithPythagorasFVector:(PythagorasFVector *)position {
  {
    id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk(walkers_)) iterator];
    while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
      TuxkidsTuxblocksCoreDefenseWalkerWalker *walker = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
      if (![((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk(walker)) isAlive]) continue;
      float dx = ((PythagorasFVector *) nil_chk([((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk(walker)) position])).x_ - ((PythagorasFVector *) nil_chk(position)).x_;
      float dy = ((PythagorasFVector *) nil_chk([((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk(walker)) position])).y_ - ((PythagorasFVector *) nil_chk(position)).y_;
      if ([JavaLangMath absWithFloat:dx] < [((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk(walker)) width] / 2 && [JavaLangMath absWithFloat:dy] < [((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk(walker)) height] / 2) {
        return walker;
      }
    }
  }
  return nil;
}

- (BOOL)isOutOfBoundsWithPythagorasFVector:(PythagorasFVector *)position {
  return [self isOutOfBoundsWithFloat:((PythagorasFVector *) nil_chk(position)).x_ withFloat:((PythagorasFVector *) nil_chk(position)).y_];
}

- (BOOL)isOutOfBoundsWithFloat:(float)x
                     withFloat:(float)y {
  return x < 0 || y < 0 || x >= [self width] || y >= [self height];
}

- (void)addEffectWithTuxkidsTuxblocksCoreEffectEffect:(TuxkidsTuxblocksCoreEffectEffect *)effect {
  [((id<JavaUtilList>) nil_chk(effects_)) addWithId:effect];
  (void) [((id<PlaynCoreLayer>) nil_chk([((TuxkidsTuxblocksCoreEffectEffect *) nil_chk(effect)) layer])) setDepthWithFloat:5];
  [((id<PlaynCoreGroupLayer>) nil_chk(gridLayer_)) addWithPlaynCoreLayer:[((TuxkidsTuxblocksCoreEffectEffect *) nil_chk(effect)) layer]];
}

- (void)onRoundCompletedWithTuxkidsTuxblocksCoreDefenseRoundRound:(TuxkidsTuxblocksCoreDefenseRoundRound *)round {
  [((TuxkidsTuxblocksCoreDefenseRoundRound *) nil_chk(round)) winRoundWithTuxkidsTuxblocksCoreGameState:state_];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TuxkidsTuxblocksCoreDefenseGrid *typedCopy = (TuxkidsTuxblocksCoreDefenseGrid *) copy;
  typedCopy.cellSize_ = cellSize__;
  typedCopy.rows_ = rows__;
  typedCopy.cols_ = cols__;
  typedCopy.layer_ = layer__;
  typedCopy.gridLayer = gridLayer_;
  typedCopy.overlayLayer = overlayLayer_;
  typedCopy.gridSprite = gridSprite_;
  typedCopy.passability = passability_;
  typedCopy.walkers = walkers_;
  typedCopy.projectiles = projectiles_;
  typedCopy.towers = towers_;
  typedCopy.effects = effects_;
  typedCopy.gridObjects = gridObjects_;
  typedCopy.walkerStart = walkerStart_;
  typedCopy.walkerDestination = walkerDestination_;
  typedCopy.toPlace = toPlace_;
  typedCopy.toPlaceRadius = toPlaceRadius_;
  typedCopy.currentPath_ = currentPath__;
  typedCopy.level_ = level__;
  typedCopy.targetAlpha = targetAlpha_;
  typedCopy.towerColor_ = towerColor__;
  typedCopy.particles_ = particles__;
  typedCopy.state = state_;
  typedCopy.validPlacementMap = validPlacementMap_;
}

@end
