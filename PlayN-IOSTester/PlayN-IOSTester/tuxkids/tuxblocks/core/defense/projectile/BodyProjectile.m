//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: core/src/main/java/tuxkids/tuxblocks/core/defense/projectile/BodyProjectile.java
//
//  Created by Thomas on 7/25/13.
//

#include "playn/core/ImageLayer.h"
#include "playn/core/Layer.h"
#include "playn/core/util/Clock.h"
#include "pythagoras/f/Vector.h"
#include "tuxkids/tuxblocks/core/PlayNObject.h"
#include "tuxkids/tuxblocks/core/defense/Grid.h"
#include "tuxkids/tuxblocks/core/defense/projectile/BodyProjectile.h"
#include "tuxkids/tuxblocks/core/defense/projectile/Projectile.h"
#include "tuxkids/tuxblocks/core/defense/tower/Tower.h"
#include "tuxkids/tuxblocks/core/defense/walker/Walker.h"

@implementation TuxkidsTuxblocksCoreDefenseProjectileBodyProjectile

@synthesize position = position_;
@synthesize velocity = velocity_;
@synthesize temp = temp_;

- (float)maxSpeed {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (float)acceleration {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (void)placeWithTuxkidsTuxblocksCoreDefenseGrid:(TuxkidsTuxblocksCoreDefenseGrid *)grid
     withTuxkidsTuxblocksCoreDefenseWalkerWalker:(TuxkidsTuxblocksCoreDefenseWalkerWalker *)target
       withTuxkidsTuxblocksCoreDefenseTowerTower:(TuxkidsTuxblocksCoreDefenseTowerTower *)source {
  [super placeWithTuxkidsTuxblocksCoreDefenseGrid:grid withTuxkidsTuxblocksCoreDefenseWalkerWalker:target withTuxkidsTuxblocksCoreDefenseTowerTower:source];
  [TuxkidsTuxblocksCorePlayNObject centerImageLayerWithPlaynCoreImageLayer:layer__];
  self.position = [((PythagorasFVector *) nil_chk([((TuxkidsTuxblocksCoreDefenseTowerTower *) nil_chk(source)) projectileStart])) clone];
  velocity_ = [[PythagorasFVector alloc] init];
  [self updateWithInt:0];
}

- (BOOL)doUpdateWithInt:(int)delta {
  TuxkidsTuxblocksCoreDefenseWalkerWalker *hit = [((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(grid_)) getHitWalkerWithPythagorasFVector:position_];
  if (hit != nil) {
    [self dealDamage];
    return YES;
  }
  if ([((TuxkidsTuxblocksCoreDefenseGrid *) nil_chk(grid_)) isOutOfBoundsWithPythagorasFVector:position_]) {
    return YES;
  }
  if ([((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk(target__)) isAlive]) {
    (void) [((PythagorasFVector *) nil_chk([((TuxkidsTuxblocksCoreDefenseWalkerWalker *) nil_chk(target__)) position])) subtractWithPythagorasFIVector:position_ withPythagorasFVector:temp_];
    (void) [((PythagorasFVector *) nil_chk(temp_)) normalizeLocal];
    (void) [((id<PlaynCoreImageLayer>) nil_chk(layer__)) setRotationWithFloat:[((PythagorasFVector *) nil_chk(temp_)) angle]];
    (void) [((PythagorasFVector *) nil_chk(velocity_)) addScaledWithPythagorasFIVector:temp_ withFloat:[self acceleration] * delta * 30 withPythagorasFVector:velocity_];
    if ([((PythagorasFVector *) nil_chk(velocity_)) length] > [self maxSpeed]) (void) [((PythagorasFVector *) nil_chk(velocity_)) scale__WithFloat:[self maxSpeed] / [((PythagorasFVector *) nil_chk(velocity_)) length] withPythagorasFVector:velocity_];
  }
  else if ([((PythagorasFVector *) nil_chk(velocity_)) length] == 0) {
    return YES;
  }
  return NO;
}

- (void)paintWithPlaynCoreUtilClock:(id<PlaynCoreUtilClock>)clock {
  ((PythagorasFVector *) nil_chk(position_)).x_ += ((PythagorasFVector *) nil_chk(velocity_)).x_ * [((id<PlaynCoreUtilClock>) nil_chk(clock)) dt];
  ((PythagorasFVector *) nil_chk(position_)).y_ += ((PythagorasFVector *) nil_chk(velocity_)).y_ * [((id<PlaynCoreUtilClock>) nil_chk(clock)) dt];
  (void) [((id<PlaynCoreImageLayer>) nil_chk(layer__)) setTranslationWithFloat:((PythagorasFVector *) nil_chk(position_)).x_ withFloat:((PythagorasFVector *) nil_chk(position_)).y_];
}

- (PythagorasFVector *)getHitPosition {
  return position_;
}

- (id)init {
  if ((self = [super init])) {
    temp_ = [[PythagorasFVector alloc] init];
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TuxkidsTuxblocksCoreDefenseProjectileBodyProjectile *typedCopy = (TuxkidsTuxblocksCoreDefenseProjectileBodyProjectile *) copy;
  typedCopy.position = position_;
  typedCopy.velocity = velocity_;
  typedCopy.temp = temp_;
}

@end
