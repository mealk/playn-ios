//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: pythagoras/d/CrossingHelper.java
//
//  Created by Thomas on 7/25/13.
//

#include "IOSClass.h"
#include "IOSDoubleArray.h"
#include "IOSIntArray.h"
#include "IOSObjectArray.h"
#include "java/lang/IndexOutOfBoundsException.h"
#include "java/util/ArrayList.h"
#include "java/util/Iterator.h"
#include "java/util/List.h"
#include "pythagoras/d/CrossingHelper.h"
#include "pythagoras/d/GeometryUtil.h"
#include "pythagoras/d/IntersectPoint.h"

@implementation PythagorasDCrossingHelper

@synthesize coords = coords_;
@synthesize sizes = sizes_;
@synthesize isectPoints = isectPoints_;

- (id)initWithDoubleArray2:(IOSObjectArray *)coords
              withIntArray:(IOSIntArray *)sizes {
  if ((self = [super init])) {
    isectPoints_ = [[JavaUtilArrayList alloc] init];
    self.coords = coords;
    self.sizes = sizes;
  }
  return self;
}

- (IOSObjectArray *)findCrossing {
  int pointCount1 = [((IOSIntArray *) nil_chk(sizes_)) intAtIndex:0] / 2;
  int pointCount2 = [((IOSIntArray *) nil_chk(sizes_)) intAtIndex:1] / 2;
  IOSIntArray *indices = [IOSIntArray arrayWithLength:pointCount1 + pointCount2];
  for (int i = 0; i < pointCount1 + pointCount2; i++) {
    (*[((IOSIntArray *) nil_chk(indices)) intRefAtIndex:i]) = i;
  }
  [PythagorasDCrossingHelper sortWithDoubleArray:[((IOSObjectArray *) nil_chk(coords_)) objectAtIndex:0] withInt:pointCount1 withDoubleArray:[((IOSObjectArray *) nil_chk(coords_)) objectAtIndex:1] withInt:pointCount2 withIntArray:indices];
  id<JavaUtilList> edges = [[JavaUtilArrayList alloc] init];
  PythagorasDCrossingHelper_Edge *edge;
  int begIndex, endIndex;
  int areaNumber;
  for (int i = 0; i < (int) [((IOSIntArray *) nil_chk(indices)) count]; i++) {
    if ([((IOSIntArray *) nil_chk(indices)) intAtIndex:i] < pointCount1) {
      begIndex = [((IOSIntArray *) nil_chk(indices)) intAtIndex:i];
      endIndex = [((IOSIntArray *) nil_chk(indices)) intAtIndex:i] - 1;
      if (endIndex < 0) {
        endIndex = pointCount1 - 1;
      }
      areaNumber = 0;
    }
    else if ([((IOSIntArray *) nil_chk(indices)) intAtIndex:i] < pointCount1 + pointCount2) {
      begIndex = [((IOSIntArray *) nil_chk(indices)) intAtIndex:i] - pointCount1;
      endIndex = [((IOSIntArray *) nil_chk(indices)) intAtIndex:i] - 1 - pointCount1;
      if (endIndex < 0) {
        endIndex = pointCount2 - 1;
      }
      areaNumber = 1;
    }
    else {
      @throw [[JavaLangIndexOutOfBoundsException alloc] init];
    }
    if (![self removeEdgeWithJavaUtilList:edges withInt:begIndex withInt:endIndex]) {
      edge = [[PythagorasDCrossingHelper_Edge alloc] initWithInt:begIndex withInt:endIndex withInt:areaNumber];
      [self intersectShapeWithJavaUtilList:edges withDoubleArray:[((IOSObjectArray *) nil_chk(coords_)) objectAtIndex:0] withInt:pointCount1 withDoubleArray:[((IOSObjectArray *) nil_chk(coords_)) objectAtIndex:1] withInt:pointCount2 withPythagorasDCrossingHelper_Edge:edge];
      [((id<JavaUtilList>) nil_chk(edges)) addWithId:edge];
    }
    begIndex = [((IOSIntArray *) nil_chk(indices)) intAtIndex:i];
    endIndex = [((IOSIntArray *) nil_chk(indices)) intAtIndex:i] + 1;
    if ((begIndex < pointCount1) && (endIndex == pointCount1)) {
      endIndex = 0;
    }
    else if ((begIndex >= pointCount1) && (endIndex == (pointCount2 + pointCount1))) {
      endIndex = pointCount1;
    }
    if (endIndex < pointCount1) {
      areaNumber = 0;
    }
    else {
      areaNumber = 1;
      endIndex -= pointCount1;
      begIndex -= pointCount1;
    }
    if (![self removeEdgeWithJavaUtilList:edges withInt:begIndex withInt:endIndex]) {
      edge = [[PythagorasDCrossingHelper_Edge alloc] initWithInt:begIndex withInt:endIndex withInt:areaNumber];
      [self intersectShapeWithJavaUtilList:edges withDoubleArray:[((IOSObjectArray *) nil_chk(coords_)) objectAtIndex:0] withInt:pointCount1 withDoubleArray:[((IOSObjectArray *) nil_chk(coords_)) objectAtIndex:1] withInt:pointCount2 withPythagorasDCrossingHelper_Edge:edge];
      [((id<JavaUtilList>) nil_chk(edges)) addWithId:edge];
    }
  }
  return [((id<JavaUtilList>) nil_chk(isectPoints_)) toArrayWithNSObjectArray:[IOSObjectArray arrayWithLength:[((id<JavaUtilList>) nil_chk(isectPoints_)) size] type:[IOSClass classWithClass:[PythagorasDIntersectPoint class]]]];
}

- (BOOL)removeEdgeWithJavaUtilList:(id<JavaUtilList>)edges
                           withInt:(int)begIndex
                           withInt:(int)endIndex {
  {
    id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk(edges)) iterator];
    while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
      PythagorasDCrossingHelper_Edge *edge = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
      if ([((PythagorasDCrossingHelper_Edge *) nil_chk(edge)) reverseCompareWithInt:begIndex withInt:endIndex]) {
        [((id<JavaUtilList>) nil_chk(edges)) removeWithId:edge];
        return YES;
      }
    }
  }
  return NO;
}

- (void)intersectShapeWithJavaUtilList:(id<JavaUtilList>)edges
                       withDoubleArray:(IOSDoubleArray *)coords1
                               withInt:(int)length1
                       withDoubleArray:(IOSDoubleArray *)coords2
                               withInt:(int)length2
    withPythagorasDCrossingHelper_Edge:(PythagorasDCrossingHelper_Edge *)initEdge {
  int areaOfEdge1, areaOfEdge2;
  int initBegin, initEnd;
  int addBegin, addEnd;
  double x1, y1, x2, y2, x3, y3, x4, y4;
  IOSDoubleArray *point = [IOSDoubleArray arrayWithLength:2];
  PythagorasDCrossingHelper_Edge *edge;
  if (((PythagorasDCrossingHelper_Edge *) nil_chk(initEdge)).areaNumber == 0) {
    x1 = [((IOSDoubleArray *) nil_chk(coords1)) doubleAtIndex:2 * ((PythagorasDCrossingHelper_Edge *) nil_chk(initEdge)).begIndex];
    y1 = [((IOSDoubleArray *) nil_chk(coords1)) doubleAtIndex:2 * ((PythagorasDCrossingHelper_Edge *) nil_chk(initEdge)).begIndex + 1];
    x2 = [((IOSDoubleArray *) nil_chk(coords1)) doubleAtIndex:2 * ((PythagorasDCrossingHelper_Edge *) nil_chk(initEdge)).endIndex];
    y2 = [((IOSDoubleArray *) nil_chk(coords1)) doubleAtIndex:2 * ((PythagorasDCrossingHelper_Edge *) nil_chk(initEdge)).endIndex + 1];
    areaOfEdge1 = 0;
  }
  else {
    x1 = [((IOSDoubleArray *) nil_chk(coords2)) doubleAtIndex:2 * ((PythagorasDCrossingHelper_Edge *) nil_chk(initEdge)).begIndex];
    y1 = [((IOSDoubleArray *) nil_chk(coords2)) doubleAtIndex:2 * ((PythagorasDCrossingHelper_Edge *) nil_chk(initEdge)).begIndex + 1];
    x2 = [((IOSDoubleArray *) nil_chk(coords2)) doubleAtIndex:2 * ((PythagorasDCrossingHelper_Edge *) nil_chk(initEdge)).endIndex];
    y2 = [((IOSDoubleArray *) nil_chk(coords2)) doubleAtIndex:2 * ((PythagorasDCrossingHelper_Edge *) nil_chk(initEdge)).endIndex + 1];
    areaOfEdge1 = 1;
  }
  for (id<JavaUtilIterator> iter = [((id<JavaUtilList>) nil_chk(edges)) iterator]; [((id<JavaUtilIterator>) nil_chk(iter)) hasNext]; ) {
    edge = [((id<JavaUtilIterator>) nil_chk(iter)) next];
    if (((PythagorasDCrossingHelper_Edge *) nil_chk(edge)).areaNumber == 0) {
      x3 = [((IOSDoubleArray *) nil_chk(coords1)) doubleAtIndex:2 * ((PythagorasDCrossingHelper_Edge *) nil_chk(edge)).begIndex];
      y3 = [((IOSDoubleArray *) nil_chk(coords1)) doubleAtIndex:2 * ((PythagorasDCrossingHelper_Edge *) nil_chk(edge)).begIndex + 1];
      x4 = [((IOSDoubleArray *) nil_chk(coords1)) doubleAtIndex:2 * ((PythagorasDCrossingHelper_Edge *) nil_chk(edge)).endIndex];
      y4 = [((IOSDoubleArray *) nil_chk(coords1)) doubleAtIndex:2 * ((PythagorasDCrossingHelper_Edge *) nil_chk(edge)).endIndex + 1];
      areaOfEdge2 = 0;
    }
    else {
      x3 = [((IOSDoubleArray *) nil_chk(coords2)) doubleAtIndex:2 * ((PythagorasDCrossingHelper_Edge *) nil_chk(edge)).begIndex];
      y3 = [((IOSDoubleArray *) nil_chk(coords2)) doubleAtIndex:2 * ((PythagorasDCrossingHelper_Edge *) nil_chk(edge)).begIndex + 1];
      x4 = [((IOSDoubleArray *) nil_chk(coords2)) doubleAtIndex:2 * ((PythagorasDCrossingHelper_Edge *) nil_chk(edge)).endIndex];
      y4 = [((IOSDoubleArray *) nil_chk(coords2)) doubleAtIndex:2 * ((PythagorasDCrossingHelper_Edge *) nil_chk(edge)).endIndex + 1];
      areaOfEdge2 = 1;
    }
    if ((areaOfEdge1 != areaOfEdge2) && ([PythagorasDGeometryUtil intersectLinesWithDouble:x1 withDouble:y1 withDouble:x2 withDouble:y2 withDouble:x3 withDouble:y3 withDouble:x4 withDouble:y4 withDoubleArray:point] == 1) && (![self containsPointWithDoubleArray:point])) {
      if (((PythagorasDCrossingHelper_Edge *) nil_chk(initEdge)).areaNumber == 0) {
        initBegin = ((PythagorasDCrossingHelper_Edge *) nil_chk(initEdge)).begIndex;
        initEnd = ((PythagorasDCrossingHelper_Edge *) nil_chk(initEdge)).endIndex;
        addBegin = ((PythagorasDCrossingHelper_Edge *) nil_chk(edge)).begIndex;
        addEnd = ((PythagorasDCrossingHelper_Edge *) nil_chk(edge)).endIndex;
      }
      else {
        initBegin = ((PythagorasDCrossingHelper_Edge *) nil_chk(edge)).begIndex;
        initEnd = ((PythagorasDCrossingHelper_Edge *) nil_chk(edge)).endIndex;
        addBegin = ((PythagorasDCrossingHelper_Edge *) nil_chk(initEdge)).begIndex;
        addEnd = ((PythagorasDCrossingHelper_Edge *) nil_chk(initEdge)).endIndex;
      }
      if (((initEnd == length1 - 1) && (initBegin == 0 && initEnd > initBegin)) || (((initEnd != length1 - 1) || (initBegin != 0)) && ((initBegin != length1 - 1) || (initEnd != 0)) && (initBegin > initEnd))) {
        int temp = initBegin;
        initBegin = initEnd;
        initEnd = temp;
      }
      if (((addEnd == length2 - 1) && (addBegin == 0) && (addEnd > addBegin)) || (((addEnd != length2 - 1) || (addBegin != 0)) && ((addBegin != length2 - 1) || (addEnd != 0)) && (addBegin > addEnd))) {
        int temp = addBegin;
        addBegin = addEnd;
        addEnd = temp;
      }
      PythagorasDIntersectPoint *ip;
      for (id<JavaUtilIterator> i = [((id<JavaUtilList>) nil_chk(isectPoints_)) iterator]; [((id<JavaUtilIterator>) nil_chk(i)) hasNext]; ) {
        ip = [((id<JavaUtilIterator>) nil_chk(i)) next];
        if ((initBegin == [((PythagorasDIntersectPoint *) nil_chk(ip)) begIndexWithBOOL:YES]) && (initEnd == [((PythagorasDIntersectPoint *) nil_chk(ip)) endIndexWithBOOL:YES])) {
          if ([PythagorasDCrossingHelper compareWithDouble:[((PythagorasDIntersectPoint *) nil_chk(ip)) x] withDouble:[((PythagorasDIntersectPoint *) nil_chk(ip)) y] withDouble:[((IOSDoubleArray *) nil_chk(point)) doubleAtIndex:0] withDouble:[((IOSDoubleArray *) nil_chk(point)) doubleAtIndex:1]] > 0) {
            initEnd = -([((id<JavaUtilList>) nil_chk(isectPoints_)) indexOfWithId:ip] + 1);
            [((PythagorasDIntersectPoint *) nil_chk(ip)) setBegIndex1WithInt:-([((id<JavaUtilList>) nil_chk(isectPoints_)) size] + 1)];
          }
          else {
            initBegin = -([((id<JavaUtilList>) nil_chk(isectPoints_)) indexOfWithId:ip] + 1);
            [((PythagorasDIntersectPoint *) nil_chk(ip)) setEndIndex1WithInt:-([((id<JavaUtilList>) nil_chk(isectPoints_)) size] + 1)];
          }
        }
        if ((addBegin == [((PythagorasDIntersectPoint *) nil_chk(ip)) begIndexWithBOOL:NO]) && (addEnd == [((PythagorasDIntersectPoint *) nil_chk(ip)) endIndexWithBOOL:NO])) {
          if ([PythagorasDCrossingHelper compareWithDouble:[((PythagorasDIntersectPoint *) nil_chk(ip)) x] withDouble:[((PythagorasDIntersectPoint *) nil_chk(ip)) y] withDouble:[((IOSDoubleArray *) nil_chk(point)) doubleAtIndex:0] withDouble:[((IOSDoubleArray *) nil_chk(point)) doubleAtIndex:1]] > 0) {
            addEnd = -([((id<JavaUtilList>) nil_chk(isectPoints_)) indexOfWithId:ip] + 1);
            [((PythagorasDIntersectPoint *) nil_chk(ip)) setBegIndex2WithInt:-([((id<JavaUtilList>) nil_chk(isectPoints_)) size] + 1)];
          }
          else {
            addBegin = -([((id<JavaUtilList>) nil_chk(isectPoints_)) indexOfWithId:ip] + 1);
            [((PythagorasDIntersectPoint *) nil_chk(ip)) setEndIndex2WithInt:-([((id<JavaUtilList>) nil_chk(isectPoints_)) size] + 1)];
          }
        }
      }
      [((id<JavaUtilList>) nil_chk(isectPoints_)) addWithId:[[PythagorasDIntersectPoint alloc] initWithInt:initBegin withInt:initEnd withInt:addBegin withInt:addEnd withDouble:[((IOSDoubleArray *) nil_chk(point)) doubleAtIndex:0] withDouble:[((IOSDoubleArray *) nil_chk(point)) doubleAtIndex:1]]];
    }
  }
}

+ (void)sortWithDoubleArray:(IOSDoubleArray *)coords1
                    withInt:(int)length1
            withDoubleArray:(IOSDoubleArray *)coords2
                    withInt:(int)length2
               withIntArray:(IOSIntArray *)array {
  int temp;
  int length = length1 + length2;
  double x1, y1, x2, y2;
  for (int i = 1; i < length; i++) {
    if ([((IOSIntArray *) nil_chk(array)) intAtIndex:i - 1] < length1) {
      x1 = [((IOSDoubleArray *) nil_chk(coords1)) doubleAtIndex:2 * [((IOSIntArray *) nil_chk(array)) intAtIndex:i - 1]];
      y1 = [((IOSDoubleArray *) nil_chk(coords1)) doubleAtIndex:2 * [((IOSIntArray *) nil_chk(array)) intAtIndex:i - 1] + 1];
    }
    else {
      x1 = [((IOSDoubleArray *) nil_chk(coords2)) doubleAtIndex:2 * ([((IOSIntArray *) nil_chk(array)) intAtIndex:i - 1] - length1)];
      y1 = [((IOSDoubleArray *) nil_chk(coords2)) doubleAtIndex:2 * ([((IOSIntArray *) nil_chk(array)) intAtIndex:i - 1] - length1) + 1];
    }
    if ([((IOSIntArray *) nil_chk(array)) intAtIndex:i] < length1) {
      x2 = [((IOSDoubleArray *) nil_chk(coords1)) doubleAtIndex:2 * [((IOSIntArray *) nil_chk(array)) intAtIndex:i]];
      y2 = [((IOSDoubleArray *) nil_chk(coords1)) doubleAtIndex:2 * [((IOSIntArray *) nil_chk(array)) intAtIndex:i] + 1];
    }
    else {
      x2 = [((IOSDoubleArray *) nil_chk(coords2)) doubleAtIndex:2 * ([((IOSIntArray *) nil_chk(array)) intAtIndex:i] - length1)];
      y2 = [((IOSDoubleArray *) nil_chk(coords2)) doubleAtIndex:2 * ([((IOSIntArray *) nil_chk(array)) intAtIndex:i] - length1) + 1];
    }
    int j = i;
    while (j > 0 && [PythagorasDCrossingHelper compareWithDouble:x1 withDouble:y1 withDouble:x2 withDouble:y2] <= 0) {
      temp = [((IOSIntArray *) nil_chk(array)) intAtIndex:j];
      (*[((IOSIntArray *) nil_chk(array)) intRefAtIndex:j]) = [((IOSIntArray *) nil_chk(array)) intAtIndex:j - 1];
      (*[((IOSIntArray *) nil_chk(array)) intRefAtIndex:j - 1]) = temp;
      j--;
      if (j > 0) {
        if ([((IOSIntArray *) nil_chk(array)) intAtIndex:j - 1] < length1) {
          x1 = [((IOSDoubleArray *) nil_chk(coords1)) doubleAtIndex:2 * [((IOSIntArray *) nil_chk(array)) intAtIndex:j - 1]];
          y1 = [((IOSDoubleArray *) nil_chk(coords1)) doubleAtIndex:2 * [((IOSIntArray *) nil_chk(array)) intAtIndex:j - 1] + 1];
        }
        else {
          x1 = [((IOSDoubleArray *) nil_chk(coords2)) doubleAtIndex:2 * ([((IOSIntArray *) nil_chk(array)) intAtIndex:j - 1] - length1)];
          y1 = [((IOSDoubleArray *) nil_chk(coords2)) doubleAtIndex:2 * ([((IOSIntArray *) nil_chk(array)) intAtIndex:j - 1] - length1) + 1];
        }
        if ([((IOSIntArray *) nil_chk(array)) intAtIndex:j] < length1) {
          x2 = [((IOSDoubleArray *) nil_chk(coords1)) doubleAtIndex:2 * [((IOSIntArray *) nil_chk(array)) intAtIndex:j]];
          y2 = [((IOSDoubleArray *) nil_chk(coords1)) doubleAtIndex:2 * [((IOSIntArray *) nil_chk(array)) intAtIndex:j] + 1];
        }
        else {
          x2 = [((IOSDoubleArray *) nil_chk(coords2)) doubleAtIndex:2 * ([((IOSIntArray *) nil_chk(array)) intAtIndex:j] - length1)];
          y2 = [((IOSDoubleArray *) nil_chk(coords2)) doubleAtIndex:2 * ([((IOSIntArray *) nil_chk(array)) intAtIndex:j] - length1) + 1];
        }
      }
    }
  }
}

- (BOOL)containsPointWithDoubleArray:(IOSDoubleArray *)point {
  PythagorasDIntersectPoint *ipoint;
  for (id<JavaUtilIterator> i = [((id<JavaUtilList>) nil_chk(isectPoints_)) iterator]; [((id<JavaUtilIterator>) nil_chk(i)) hasNext]; ) {
    ipoint = [((id<JavaUtilIterator>) nil_chk(i)) next];
    if ([((PythagorasDIntersectPoint *) nil_chk(ipoint)) x] == [((IOSDoubleArray *) nil_chk(point)) doubleAtIndex:0] && [((PythagorasDIntersectPoint *) nil_chk(ipoint)) y] == [((IOSDoubleArray *) nil_chk(point)) doubleAtIndex:1]) {
      return YES;
    }
  }
  return NO;
}

+ (int)compareWithDouble:(double)x1
              withDouble:(double)y1
              withDouble:(double)x2
              withDouble:(double)y2 {
  if ((x1 < x2) || (x1 == x2 && y1 < y2)) {
    return 1;
  }
  else if (x1 == x2 && y1 == y2) {
    return 0;
  }
  return -1;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  PythagorasDCrossingHelper *typedCopy = (PythagorasDCrossingHelper *) copy;
  typedCopy.coords = coords_;
  typedCopy.sizes = sizes_;
  typedCopy.isectPoints = isectPoints_;
}

@end
@implementation PythagorasDCrossingHelper_Edge

@synthesize begIndex = begIndex_;
@synthesize endIndex = endIndex_;
@synthesize areaNumber = areaNumber_;

- (id)initWithInt:(int)begIndex
          withInt:(int)endIndex
          withInt:(int)areaNumber {
  if ((self = [super init])) {
    self.begIndex = begIndex;
    self.endIndex = endIndex;
    self.areaNumber = areaNumber;
  }
  return self;
}

- (BOOL)reverseCompareWithInt:(int)begIndex
                      withInt:(int)endIndex {
  return self.begIndex == endIndex && self.endIndex == begIndex;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  PythagorasDCrossingHelper_Edge *typedCopy = (PythagorasDCrossingHelper_Edge *) copy;
  typedCopy.begIndex = begIndex_;
  typedCopy.endIndex = endIndex_;
  typedCopy.areaNumber = areaNumber_;
}

@end
