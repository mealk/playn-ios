//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: playn/core/BatchImpl.java
//
//  Created by Thomas on 7/25/13.
//

#include "IOSClass.h"
#include "java/util/HashMap.h"
#include "java/util/Iterator.h"
#include "java/util/Map.h"
#include "java/util/Set.h"
#include "playn/core/BatchImpl.h"
#include "playn/core/Storage.h"

@implementation PlaynCoreBatchImpl

@synthesize storage = storage_;
@synthesize updates = updates_;

- (id)initWithPlaynCoreStorage:(id<PlaynCoreStorage>)storage {
  if ((self = [super init])) {
    updates_ = [[JavaUtilHashMap alloc] init];
    self.storage = storage;
  }
  return self;
}

- (void)setItemWithNSString:(NSString *)key
               withNSString:(NSString *)data {
  (void) [((id<JavaUtilMap>) nil_chk(updates_)) putWithId:key withId:data];
}

- (void)removeItemWithNSString:(NSString *)key {
  (void) [((id<JavaUtilMap>) nil_chk(updates_)) putWithId:key withId:nil];
}

- (void)commit {
  @try {
    [self onBeforeCommit];
    {
      id<JavaUtilIterator> iter__ = [((id<JavaUtilSet>) nil_chk([((id<JavaUtilMap>) nil_chk(updates_)) entrySet])) iterator];
      while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
        id<JavaUtilMap_Entry> entry = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
        NSString *key = [((id<JavaUtilMap_Entry>) nil_chk(entry)) getKey], *data = [((id<JavaUtilMap_Entry>) nil_chk(entry)) getValue];
        if (data == nil) [self removeImplWithNSString:key];
        else [self setImplWithNSString:key withNSString:data];
      }
    }
    [self onAfterCommit];
  }
  @finally {
    updates_ = nil;
  }
}

- (void)onBeforeCommit {
}

- (void)setImplWithNSString:(NSString *)key
               withNSString:(NSString *)data {
  [((id<PlaynCoreStorage>) nil_chk(storage_)) setItemWithNSString:key withNSString:data];
}

- (void)removeImplWithNSString:(NSString *)key {
  [((id<PlaynCoreStorage>) nil_chk(storage_)) removeItemWithNSString:key];
}

- (void)onAfterCommit {
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  PlaynCoreBatchImpl *typedCopy = (PlaynCoreBatchImpl *) copy;
  typedCopy.storage = storage_;
  typedCopy.updates = updates_;
}

@end
