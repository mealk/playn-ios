//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: tripleplay/ui/Field.java
//
//  Created by Thomas on 7/25/13.
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "java/lang/Boolean.h"
#include "java/lang/Integer.h"
#include "java/lang/Throwable.h"
#include "playn/core/Font.h"
#include "playn/core/GroupLayer.h"
#include "playn/core/ImageLayer.h"
#include "playn/core/Keyboard.h"
#include "playn/core/Layer.h"
#include "playn/core/PlayN.h"
#include "playn/core/Pointer.h"
#include "pythagoras/f/Dimension.h"
#include "pythagoras/f/Point.h"
#include "pythagoras/f/Rectangle.h"
#include "react/Connection.h"
#include "react/Signal.h"
#include "react/SignalView.h"
#include "react/UnitSlot.h"
#include "react/Value.h"
#include "tripleplay/platform/NativeTextField.h"
#include "tripleplay/platform/TPPlatform.h"
#include "tripleplay/ui/Background.h"
#include "tripleplay/ui/Element.h"
#include "tripleplay/ui/Field.h"
#include "tripleplay/ui/Icon.h"
#include "tripleplay/ui/Log.h"
#include "tripleplay/ui/Style.h"
#include "tripleplay/ui/Styles.h"
#include "tripleplay/ui/TextWidget.h"
#include "tripleplay/ui/Widget.h"
#include "tripleplay/util/Logger.h"

@implementation TripleplayUiField

static TripleplayUiStyle_Flag * TripleplayUiField_FULLTIME_NATIVE_FIELD_;
static TripleplayUiStyle_Flag * TripleplayUiField_AUTOCAPITALIZATION_;
static TripleplayUiStyle_Flag * TripleplayUiField_AUTOCORRECTION_;
static TripleplayUiStyle_Flag * TripleplayUiField_SECURE_TEXT_ENTRY_;
static TripleplayUiStyle * TripleplayUiField_TEXT_TYPE_;
static TripleplayUiStyle * TripleplayUiField_MAXIMUM_INPUT_LENGTH_;
static TripleplayUiStyle * TripleplayUiField_RETURN_KEY_LABEL_;
static TripleplayUiStyle_Flag * TripleplayUiField_MULTILINE_;

@synthesize text_ = text__;
@synthesize _nativeField = _nativeField_;
@synthesize _defaultTransformer = _defaultTransformer_;
@synthesize _defaultValidator = _defaultValidator_;
@synthesize _finishedEditing = _finishedEditing_;
@synthesize _popupLabel = _popupLabel_;
@synthesize _maxFieldLength = _maxFieldLength_;

+ (TripleplayUiStyle_Flag *)FULLTIME_NATIVE_FIELD {
  return TripleplayUiField_FULLTIME_NATIVE_FIELD_;
}

+ (TripleplayUiStyle_Flag *)AUTOCAPITALIZATION {
  return TripleplayUiField_AUTOCAPITALIZATION_;
}

+ (TripleplayUiStyle_Flag *)AUTOCORRECTION {
  return TripleplayUiField_AUTOCORRECTION_;
}

+ (TripleplayUiStyle_Flag *)SECURE_TEXT_ENTRY {
  return TripleplayUiField_SECURE_TEXT_ENTRY_;
}

+ (TripleplayUiStyle *)TEXT_TYPE {
  return TripleplayUiField_TEXT_TYPE_;
}

+ (TripleplayUiStyle *)MAXIMUM_INPUT_LENGTH {
  return TripleplayUiField_MAXIMUM_INPUT_LENGTH_;
}

+ (TripleplayUiStyle *)RETURN_KEY_LABEL {
  return TripleplayUiField_RETURN_KEY_LABEL_;
}

+ (TripleplayUiStyle_Flag *)MULTILINE {
  return TripleplayUiField_MULTILINE_;
}

- (id)init {
  return [self initTripleplayUiFieldWithNSString:@""];
}

- (id)initTripleplayUiFieldWithNSString:(NSString *)initialText {
  return [self initTripleplayUiFieldWithNSString:initialText withTripleplayUiStyles:[TripleplayUiStyles none]];
}

- (id)initWithNSString:(NSString *)initialText {
  return [self initTripleplayUiFieldWithNSString:initialText];
}

- (id)initWithTripleplayUiStyles:(TripleplayUiStyles *)styles {
  return [self initTripleplayUiFieldWithNSString:@"" withTripleplayUiStyles:styles];
}

- (id)initTripleplayUiFieldWithNSString:(NSString *)initialText
                 withTripleplayUiStyles:(TripleplayUiStyles *)styles {
  if ((self = [super init])) {
    _defaultTransformer_ = [[TripleplayUiField_$3 alloc] initWithTripleplayUiField:self];
    _defaultValidator_ = [[TripleplayUiField_$4 alloc] initWithTripleplayUiField:self];
    _maxFieldLength_ = 0;
    [self enableInteraction];
    (void) [self setStylesWithTripleplayUiStyles:styles];
    if ([((TripleplayPlatformTPPlatform *) nil_chk([TripleplayPlatformTPPlatform instance])) hasNativeTextFields]) {
      _nativeField_ = [((TripleplayPlatformTPPlatform *) nil_chk([TripleplayPlatformTPPlatform instance])) createNativeTextField];
      (void) [self setValidatorWithTripleplayPlatformNativeTextField_Validator:nil];
      (void) [self setTransformerWithTripleplayPlatformNativeTextField_Transformer:nil];
      text__ = [((id<TripleplayPlatformNativeTextField>) nil_chk(_nativeField_)) text];
      _finishedEditing_ = [((id<TripleplayPlatformNativeTextField>) nil_chk(_nativeField_)) finishedEditing];
      (void) [((ReactSignal *) nil_chk(_finishedEditing_)) connectWithReactSlot:[[TripleplayUiField_$1 alloc] initWithTripleplayUiField:self]];
    }
    else {
      _nativeField_ = nil;
      text__ = [ReactValue createWithId:@""];
      _finishedEditing_ = [ReactSignal create];
    }
    (void) [((ReactValue *) nil_chk(self.text_)) updateWithId:initialText];
    (void) [((ReactValue *) nil_chk(self.text_)) connectWithReactValueView_Listener:[self textDidChange]];
  }
  return self;
}

- (id)initWithNSString:(NSString *)initialText
withTripleplayUiStyles:(TripleplayUiStyles *)styles {
  return [self initTripleplayUiFieldWithNSString:initialText withTripleplayUiStyles:styles];
}

- (id<ReactSignalView>)finishedEditing {
  return _finishedEditing_;
}

- (TripleplayUiField *)setTextTypeWithPlaynCoreKeyboard_TextTypeEnum:(PlaynCoreKeyboard_TextTypeEnum *)type {
  return [self addStylesWithTripleplayUiStyle_BindingArray:[IOSObjectArray arrayWithObjects:(id[]){ [((TripleplayUiStyle *) nil_chk(TripleplayUiField_TEXT_TYPE_)) isWithId:type] } count:1 type:[IOSClass classWithClass:[TripleplayUiStyle_Binding class]]]];
}

- (TripleplayUiField *)setPopupLabelWithNSString:(NSString *)label {
  _popupLabel_ = label;
  return self;
}

- (TripleplayUiField *)setValidatorWithTripleplayPlatformNativeTextField_Validator:(id<TripleplayPlatformNativeTextField_Validator>)validator {
  if (_nativeField_ != nil) (void) [_nativeField_ setValidatorWithTripleplayPlatformNativeTextField_Validator:validator == nil ? _defaultValidator_ : validator];
  return self;
}

- (TripleplayUiField *)setTransformerWithTripleplayPlatformNativeTextField_Transformer:(id<TripleplayPlatformNativeTextField_Transformer>)transformer {
  if (_nativeField_ != nil) (void) [_nativeField_ setTransformerWithTripleplayPlatformNativeTextField_Transformer:transformer == nil ? _defaultTransformer_ : transformer];
  return self;
}

- (TripleplayUiField *)updateNativeFieldBounds {
  if (_nativeField_ != nil) (void) [_nativeField_ setBoundsWithPythagorasFIRectangle:[self getNativeFieldBounds]];
  return self;
}

- (BOOL)hasFocus {
  return _nativeField_ != nil && [((id<TripleplayPlatformNativeTextField>) nil_chk(_nativeField_)) hasFocus];
}

- (BOOL)textIsValidWithNSString:(NSString *)text {
  int maxLength = _maxFieldLength_;
  int textLength = text == nil ? 0 : [((NSString *) nil_chk(text)) length];
  return maxLength < 1 || textLength <= maxLength;
}

- (NSString *)transformTextWithNSString:(NSString *)text {
  return text;
}

- (IOSClass *)getStyleClass {
  return [IOSClass classWithClass:[TripleplayUiField class]];
}

- (NSString *)text {
  NSString *ctext = [((ReactValue *) nil_chk(text__)) get];
  return (ctext == nil || [((NSString *) nil_chk(ctext)) length] == 0) ? @" " : ctext;
}

- (id<TripleplayUiIcon>)icon {
  return nil;
}

- (void)onPointerStartWithPlaynCorePointer_Event:(id<PlaynCorePointer_Event>)event
                                       withFloat:(float)x
                                       withFloat:(float)y {
  [super onPointerStartWithPlaynCorePointer_Event:event withFloat:x withFloat:y];
  if (![self isEnabled] || [self fulltimeNativeField]) return;
  if (_nativeField_ != nil) {
    [self updateModeWithBOOL:YES];
    [_nativeField_ focus];
  }
  else {
    [((id<PlaynCoreKeyboard>) nil_chk([PlaynCorePlayN keyboard])) getTextWithPlaynCoreKeyboard_TextTypeEnum:[self resolveStyleWithTripleplayUiStyle:TripleplayUiField_TEXT_TYPE_] withNSString:_popupLabel_ withNSString:[((ReactValue *) nil_chk(text__)) get] withPlaynCoreUtilCallback:[[TripleplayUiField_$2 alloc] initWithTripleplayUiField:self]];
  }
}

- (void)wasRemoved {
  [super wasRemoved];
  [self updateModeWithBOOL:NO];
}

- (TripleplayUiElement_LayoutData *)createLayoutDataWithFloat:(float)hintX
                                                    withFloat:(float)hintY {
  return [[TripleplayUiField_FieldLayoutData alloc] initWithTripleplayUiField:self withFloat:hintX withFloat:hintY];
}

- (BOOL)fulltimeNativeField {
  return _nativeField_ != nil && [((JavaLangBoolean *) nil_chk([self resolveStyleWithTripleplayUiStyle:TripleplayUiField_FULLTIME_NATIVE_FIELD_])) booleanValue];
}

- (PythagorasFRectangle *)getNativeFieldBounds {
  TripleplayUiBackground *bg = [self resolveStyleWithTripleplayUiStyle:[TripleplayUiStyle BACKGROUND]];
  PythagorasFPoint *screenCoords = [PlaynCoreLayer_Util layerToScreenWithPlaynCoreLayer:layer_ withFloat:((TripleplayUiBackground *) nil_chk(bg)).left withFloat:((TripleplayUiBackground *) nil_chk(bg)).top];
  return [[PythagorasFRectangle alloc] initWithFloat:((PythagorasFPoint *) nil_chk(screenCoords)).x_ withFloat:((PythagorasFPoint *) nil_chk(screenCoords)).y_ withFloat:((PythagorasFDimension *) nil_chk(_size_)).width_ - [((TripleplayUiBackground *) nil_chk(bg)) width] withFloat:((PythagorasFDimension *) nil_chk(_size_)).height_ - [((TripleplayUiBackground *) nil_chk(bg)) height]];
}

- (void)updateModeWithBOOL:(BOOL)nativeField {
  if (_nativeField_ == nil) return;
  if (nativeField) {
    TripleplayPlatformNativeTextField_ModeEnum *mode = [TripleplayPlatformNativeTextField_ModeEnum NORMAL];
    BOOL multiLine = [((JavaLangBoolean *) nil_chk([self resolveStyleWithTripleplayUiStyle:TripleplayUiField_MULTILINE_])) booleanValue];
    if ([((JavaLangBoolean *) nil_chk([self resolveStyleWithTripleplayUiStyle:TripleplayUiField_SECURE_TEXT_ENTRY_])) booleanValue]) {
      if (multiLine) [((TripleplayUtilLogger *) nil_chk([TripleplayUiLog log])) warningWithNSString:@"Ignoring MULTILINE Style" withNSObjectArray:[IOSObjectArray arrayWithLength:0 type:[IOSClass classWithClass:[NSObject class]]]];
      mode = [TripleplayPlatformNativeTextField_ModeEnum SECURE];
    }
    else if (multiLine) {
      mode = [TripleplayPlatformNativeTextField_ModeEnum MULTI_LINE];
    }
    id<TripleplayPlatformNativeTextField> newField = [((id<TripleplayPlatformNativeTextField>) nil_chk(_nativeField_)) refreshModeWithTripleplayPlatformNativeTextField_ModeEnum:mode];
    if (newField != _nativeField_) {
      [((id<TripleplayPlatformNativeTextField>) nil_chk(_nativeField_)) remove];
      _nativeField_ = newField;
    }
    (void) [((id<TripleplayPlatformNativeTextField>) nil_chk([((id<TripleplayPlatformNativeTextField>) nil_chk([((id<TripleplayPlatformNativeTextField>) nil_chk([((id<TripleplayPlatformNativeTextField>) nil_chk([((id<TripleplayPlatformNativeTextField>) nil_chk(_nativeField_)) setTextTypeWithPlaynCoreKeyboard_TextTypeEnum:[self resolveStyleWithTripleplayUiStyle:TripleplayUiField_TEXT_TYPE_]])) setFontWithPlaynCoreFont:[self resolveStyleWithTripleplayUiStyle:[TripleplayUiStyle FONT]]])) setAutocapitalizationWithBOOL:[((JavaLangBoolean *) nil_chk([self resolveStyleWithTripleplayUiStyle:TripleplayUiField_AUTOCAPITALIZATION_])) booleanValue]])) setAutocorrectionWithBOOL:[((JavaLangBoolean *) nil_chk([self resolveStyleWithTripleplayUiStyle:TripleplayUiField_AUTOCORRECTION_])) booleanValue]])) setReturnKeyLabelWithNSString:[self resolveStyleWithTripleplayUiStyle:TripleplayUiField_RETURN_KEY_LABEL_]];
    (void) [self updateNativeFieldBounds];
    [((id<TripleplayPlatformNativeTextField>) nil_chk(_nativeField_)) add];
    [self setGlyphLayerAlphaWithFloat:0];
  }
  else {
    [((id<TripleplayPlatformNativeTextField>) nil_chk(_nativeField_)) remove];
    [self setGlyphLayerAlphaWithFloat:1];
  }
}

- (void)setGlyphLayerAlphaWithFloat:(float)alpha {
  if ([((TripleplayUiWidget_Glyph *) nil_chk(_tglyph_)) layer] != nil) (void) [((id<PlaynCoreImageLayer>) nil_chk([((TripleplayUiWidget_Glyph *) nil_chk(_tglyph_)) layer])) setAlphaWithFloat:alpha];
}

+ (void)initialize {
  if (self == [TripleplayUiField class]) {
    TripleplayUiField_FULLTIME_NATIVE_FIELD_ = [TripleplayUiStyle newFlagWithBOOL:NO withBOOL:YES];
    TripleplayUiField_AUTOCAPITALIZATION_ = [TripleplayUiStyle newFlagWithBOOL:NO withBOOL:YES];
    TripleplayUiField_AUTOCORRECTION_ = [TripleplayUiStyle newFlagWithBOOL:NO withBOOL:YES];
    TripleplayUiField_SECURE_TEXT_ENTRY_ = [TripleplayUiStyle newFlagWithBOOL:NO withBOOL:NO];
    TripleplayUiField_TEXT_TYPE_ = [TripleplayUiStyle newStyleWithBOOL:NO withId:[PlaynCoreKeyboard_TextTypeEnum DEFAULT]];
    TripleplayUiField_MAXIMUM_INPUT_LENGTH_ = [TripleplayUiStyle newStyleWithBOOL:NO withId:[JavaLangInteger valueOfWithInt:0]];
    TripleplayUiField_RETURN_KEY_LABEL_ = [TripleplayUiStyle newStyleWithBOOL:NO withId:nil];
    TripleplayUiField_MULTILINE_ = [TripleplayUiStyle newFlagWithBOOL:NO withBOOL:NO];
  }
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayUiField *typedCopy = (TripleplayUiField *) copy;
  typedCopy.text_ = text__;
  typedCopy._nativeField = _nativeField_;
  typedCopy._defaultTransformer = _defaultTransformer_;
  typedCopy._defaultValidator = _defaultValidator_;
  typedCopy._finishedEditing = _finishedEditing_;
  typedCopy._popupLabel = _popupLabel_;
  typedCopy._maxFieldLength = _maxFieldLength_;
}

@end
@implementation TripleplayUiField_FieldLayoutData

@synthesize this$3 = this$3_;

- (id)initWithTripleplayUiField:(TripleplayUiField *)outer$
                      withFloat:(float)hintX
                      withFloat:(float)hintY {
  if ((self = [super initWithTripleplayUiTextWidget:outer$ withFloat:hintX withFloat:hintY])) {
    this$3_ = outer$;
  }
  return self;
}

- (void)layoutWithFloat:(float)left
              withFloat:(float)top
              withFloat:(float)width
              withFloat:(float)height {
  [super layoutWithFloat:left withFloat:top withFloat:width withFloat:height];
  if ([this$3_ fulltimeNativeField]) [this$3_ updateModeWithBOOL:YES];
  this$3_._maxFieldLength = [((JavaLangInteger *) nil_chk([this$3_ resolveStyleWithTripleplayUiStyle:[TripleplayUiField MAXIMUM_INPUT_LENGTH]])) intValue];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayUiField_FieldLayoutData *typedCopy = (TripleplayUiField_FieldLayoutData *) copy;
  typedCopy.this$3 = this$3_;
}

@end
@implementation TripleplayUiField_$1

@synthesize this$0 = this$0_;

- (void)onEmitWithId:(JavaLangBoolean *)event {
  if (![this$0_ fulltimeNativeField]) [this$0_ updateModeWithBOOL:NO];
}

- (id)initWithTripleplayUiField:(TripleplayUiField *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayUiField_$1 *typedCopy = (TripleplayUiField_$1 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
@implementation TripleplayUiField_$2

@synthesize this$0 = this$0_;

- (void)onSuccessWithId:(NSString *)result {
  if (result != nil) (void) [((ReactValue *) nil_chk(this$0_.text_)) updateWithId:result];
  [((ReactSignal *) nil_chk(this$0_._finishedEditing)) emitWithId:[JavaLangBoolean valueOfWithBOOL:result != nil]];
}

- (void)onFailureWithJavaLangThrowable:(JavaLangThrowable *)cause {
}

- (id)initWithTripleplayUiField:(TripleplayUiField *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayUiField_$2 *typedCopy = (TripleplayUiField_$2 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
@implementation TripleplayUiField_$3

@synthesize this$0 = this$0_;

- (NSString *)transformWithNSString:(NSString *)text {
  return [this$0_ transformTextWithNSString:text];
}

- (id)initWithTripleplayUiField:(TripleplayUiField *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayUiField_$3 *typedCopy = (TripleplayUiField_$3 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
@implementation TripleplayUiField_$4

@synthesize this$0 = this$0_;

- (BOOL)isValidWithNSString:(NSString *)text {
  return [this$0_ textIsValidWithNSString:text];
}

- (id)initWithTripleplayUiField:(TripleplayUiField *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayUiField_$4 *typedCopy = (TripleplayUiField_$4 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
