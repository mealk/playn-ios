//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: tripleplay/game/trans/FlipTransition.java
//
//  Created by Thomas on 7/25/13.
//

#include "IOSClass.h"
#include "playn/core/Graphics.h"
#include "playn/core/GroupLayer.h"
#include "playn/core/Layer.h"
#include "playn/core/PlayN.h"
#include "playn/core/gl/GLContext.h"
#include "pythagoras/f/FloatMath.h"
#include "tripleplay/game/Screen.h"
#include "tripleplay/game/trans/FlipTransition.h"
#include "tripleplay/shaders/RotateYShader.h"
#include "tripleplay/util/Interpolator.h"

@implementation TripleplayGameTransFlipTransition

@synthesize _flipped = _flipped_;
@synthesize _unflip = _unflip_;
@synthesize _oshader = _oshader_;
@synthesize _nshader = _nshader_;

- (TripleplayGameTransFlipTransition *)unflip {
  _unflip_ = YES;
  return self;
}

- (void)init__WithTripleplayGameScreen:(TripleplayGameScreen *)oscreen
              withTripleplayGameScreen:(TripleplayGameScreen *)nscreen OBJC_METHOD_FAMILY_NONE {
  [super init__WithTripleplayGameScreen:oscreen withTripleplayGameScreen:nscreen];
  (void) [((id<PlaynCoreGroupLayer>) nil_chk(((TripleplayGameScreen *) nil_chk(nscreen)).layer)) setDepthWithFloat:-1];
  _oshader_ = [[TripleplayShadersRotateYShader alloc] initWithPlaynCoreGlGLContext:[((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) ctx] withFloat:0.5f withFloat:0.5f withFloat:1];
  (void) [((id<PlaynCoreGroupLayer>) nil_chk(((TripleplayGameScreen *) nil_chk(oscreen)).layer)) setShaderWithPlaynCoreGlGLShader:_oshader_];
  _nshader_ = [[TripleplayShadersRotateYShader alloc] initWithPlaynCoreGlGLContext:[((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) ctx] withFloat:0.5f withFloat:0.5f withFloat:1];
  (void) [((id<PlaynCoreGroupLayer>) nil_chk(((TripleplayGameScreen *) nil_chk(nscreen)).layer)) setShaderWithPlaynCoreGlGLShader:_nshader_];
}

- (BOOL)updateWithTripleplayGameScreen:(TripleplayGameScreen *)oscreen
              withTripleplayGameScreen:(TripleplayGameScreen *)nscreen
                             withFloat:(float)elapsed {
  float pct = [((TripleplayUtilInterpolator *) nil_chk(_interp_)) applyWithFloat:0 withFloat:1 withFloat:elapsed withFloat:_duration_];
  if (pct >= 0.5f && !_flipped_) {
    (void) [((id<PlaynCoreGroupLayer>) nil_chk(((TripleplayGameScreen *) nil_chk(nscreen)).layer)) setDepthWithFloat:0];
    (void) [((id<PlaynCoreGroupLayer>) nil_chk(((TripleplayGameScreen *) nil_chk(oscreen)).layer)) setDepthWithFloat:-1];
  }
  if (_unflip_) pct = -pct;
  ((TripleplayShadersRotateYShader *) nil_chk(_oshader_)).angle = PythagorasFFloatMath_PI * pct;
  ((TripleplayShadersRotateYShader *) nil_chk(_nshader_)).angle = PythagorasFFloatMath_PI * (pct - 1);
  return elapsed >= _duration_;
}

- (void)completeWithTripleplayGameScreen:(TripleplayGameScreen *)oscreen
                withTripleplayGameScreen:(TripleplayGameScreen *)nscreen {
  [super completeWithTripleplayGameScreen:oscreen withTripleplayGameScreen:nscreen];
  (void) [((id<PlaynCoreGroupLayer>) nil_chk(((TripleplayGameScreen *) nil_chk(oscreen)).layer)) setDepthWithFloat:0];
  (void) [((id<PlaynCoreGroupLayer>) nil_chk(((TripleplayGameScreen *) nil_chk(oscreen)).layer)) setShaderWithPlaynCoreGlGLShader:nil];
  (void) [((id<PlaynCoreGroupLayer>) nil_chk(((TripleplayGameScreen *) nil_chk(nscreen)).layer)) setDepthWithFloat:0];
  (void) [((id<PlaynCoreGroupLayer>) nil_chk(((TripleplayGameScreen *) nil_chk(nscreen)).layer)) setShaderWithPlaynCoreGlGLShader:nil];
}

- (TripleplayUtilInterpolator *)defaultInterpolator {
  return [TripleplayUtilInterpolator LINEAR];
}

- (id)init {
  return [super init];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayGameTransFlipTransition *typedCopy = (TripleplayGameTransFlipTransition *) copy;
  typedCopy._flipped = _flipped_;
  typedCopy._unflip = _unflip_;
  typedCopy._oshader = _oshader_;
  typedCopy._nshader = _nshader_;
}

@end
