//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: tripleplay/util/Layers.java
//
//  Created by Thomas on 7/25/13.
//

#include "playn/core/Canvas.h"
#include "playn/core/CanvasImage.h"
#include "playn/core/Graphics.h"
#include "playn/core/GroupLayer.h"
#include "playn/core/Image.h"
#include "playn/core/ImageLayer.h"
#include "playn/core/ImmediateLayer.h"
#include "playn/core/Layer.h"
#include "playn/core/PlayN.h"
#include "playn/core/canvas/CanvasSurface.h"
#include "pythagoras/f/AffineTransform.h"
#include "pythagoras/f/IPoint.h"
#include "pythagoras/f/Point.h"
#include "pythagoras/f/Rectangle.h"
#include "pythagoras/f/Transform.h"
#include "tripleplay/util/Layers.h"

@implementation TripleplayUtilLayers

+ (PythagorasFPoint *)transformWithPythagorasFIPoint:(id<PythagorasFIPoint>)p
                                  withPlaynCoreLayer:(id<PlaynCoreLayer>)from
                                  withPlaynCoreLayer:(id<PlaynCoreLayer>)to
                                withPythagorasFPoint:(PythagorasFPoint *)result {
  (void) [PlaynCoreLayer_Util layerToScreenWithPlaynCoreLayer:from withPythagorasFIPoint:p withPythagorasFPoint:result];
  (void) [PlaynCoreLayer_Util screenToLayerWithPlaynCoreLayer:to withPythagorasFIPoint:result withPythagorasFPoint:result];
  return result;
}

+ (PythagorasFPoint *)transformWithPythagorasFIPoint:(id<PythagorasFIPoint>)p
                                  withPlaynCoreLayer:(id<PlaynCoreLayer>)from
                                  withPlaynCoreLayer:(id<PlaynCoreLayer>)to {
  return [TripleplayUtilLayers transformWithPythagorasFIPoint:p withPlaynCoreLayer:from withPlaynCoreLayer:to withPythagorasFPoint:[[PythagorasFPoint alloc] init]];
}

+ (void)reparentWithPlaynCoreLayer:(id<PlaynCoreLayer>)layer
           withPlaynCoreGroupLayer:(id<PlaynCoreGroupLayer>)target {
  PythagorasFPoint *pos = [[PythagorasFPoint alloc] initWithFloat:[((id<PlaynCoreLayer>) nil_chk(layer)) tx] withFloat:[((id<PlaynCoreLayer>) nil_chk(layer)) ty]];
  (void) [PlaynCoreLayer_Util layerToScreenWithPlaynCoreLayer:[((id<PlaynCoreLayer>) nil_chk(layer)) parent] withPythagorasFIPoint:pos withPythagorasFPoint:pos];
  [((id<PlaynCoreGroupLayer>) nil_chk(target)) addWithPlaynCoreLayer:layer];
  (void) [PlaynCoreLayer_Util screenToLayerWithPlaynCoreLayer:[((id<PlaynCoreLayer>) nil_chk(layer)) parent] withPythagorasFIPoint:pos withPythagorasFPoint:pos];
  (void) [((id<PlaynCoreLayer>) nil_chk(layer)) setTranslationWithFloat:((PythagorasFPoint *) nil_chk(pos)).x_ withFloat:((PythagorasFPoint *) nil_chk(pos)).y_];
}

+ (BOOL)containsWithPlaynCoreGroupLayer:(id<PlaynCoreGroupLayer>)group
                     withPlaynCoreLayer:(id<PlaynCoreLayer>)layer {
  while (layer != nil) {
    layer = [((id<PlaynCoreLayer>) nil_chk(layer)) parent];
    if (layer == group) return YES;
  }
  return NO;
}

+ (PythagorasFRectangle *)totalBoundsWithPlaynCoreLayer:(id<PlaynCoreLayer>)root {
  PythagorasFRectangle *r = [[PythagorasFRectangle alloc] initWithFloat:0 - [((id<PlaynCoreLayer>) nil_chk(root)) originX] withFloat:0 - [((id<PlaynCoreLayer>) nil_chk(root)) originY] withFloat:0 withFloat:0];
  [TripleplayUtilLayers addBoundsWithPlaynCoreLayer:root withPlaynCoreLayer:root withPythagorasFRectangle:r withPythagorasFPoint:[[PythagorasFPoint alloc] init]];
  return r;
}

+ (void)captureWithPlaynCoreLayer:(id<PlaynCoreLayer>)layer
              withPlaynCoreCanvas:(id<PlaynCoreCanvas>)canvas {
  if (![((id<PlaynCoreLayer>) nil_chk(layer)) visible]) return;
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) save];
  [TripleplayUtilLayers concatTransformWithPlaynCoreCanvas:canvas withPythagorasFTransform:[((id<PlaynCoreLayer>) nil_chk(layer)) transform]];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) translateWithFloat:-[((id<PlaynCoreLayer>) nil_chk(layer)) originX] withFloat:-[((id<PlaynCoreLayer>) nil_chk(layer)) originY]];
  if ([(id) layer conformsToProtocol: @protocol(PlaynCoreGroupLayer)]) {
    id<PlaynCoreGroupLayer> gl = (id<PlaynCoreGroupLayer>) layer;
    for (int ii = 0, ll = [((id<PlaynCoreGroupLayer>) nil_chk(gl)) size]; ii < ll; ii++) {
      [TripleplayUtilLayers captureWithPlaynCoreLayer:[((id<PlaynCoreGroupLayer>) nil_chk(gl)) getWithInt:ii] withPlaynCoreCanvas:canvas];
    }
  }
  else if ([(id) layer conformsToProtocol: @protocol(PlaynCoreImageLayer)]) {
    id<PlaynCoreImageLayer> il = (id<PlaynCoreImageLayer>) layer;
    (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) drawImageWithPlaynCoreImage:[((id<PlaynCoreImageLayer>) nil_chk(il)) image] withFloat:0 withFloat:0];
  }
  else if ([(id) layer conformsToProtocol: @protocol(PlaynCoreImmediateLayer)]) {
    id<PlaynCoreImmediateLayer> il = (id<PlaynCoreImmediateLayer>) layer;
    [((id<PlaynCoreImmediateLayer_Renderer>) nil_chk([((id<PlaynCoreImmediateLayer>) nil_chk(il)) renderer])) renderWithPlaynCoreSurface:[[PlaynCoreCanvasCanvasSurface alloc] initWithPlaynCoreCanvas:canvas]];
  }
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) restore];
}

+ (id<PlaynCoreCanvasImage>)captureWithPlaynCoreLayer:(id<PlaynCoreLayer>)layer
                                            withFloat:(float)width
                                            withFloat:(float)height {
  id<PlaynCoreCanvasImage> image = [((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) createImageWithFloat:width withFloat:height];
  [TripleplayUtilLayers captureWithPlaynCoreLayer:layer withPlaynCoreCanvas:[((id<PlaynCoreCanvasImage>) nil_chk(image)) canvas]];
  return image;
}

+ (void)addBoundsWithPlaynCoreLayer:(id<PlaynCoreLayer>)root
                 withPlaynCoreLayer:(id<PlaynCoreLayer>)l
           withPythagorasFRectangle:(PythagorasFRectangle *)bounds
               withPythagorasFPoint:(PythagorasFPoint *)scratch {
  if ([(id) l conformsToProtocol: @protocol(PlaynCoreLayer_HasSize)]) {
    id<PlaynCoreLayer_HasSize> lhs = (id<PlaynCoreLayer_HasSize>) l;
    float w = [((id<PlaynCoreLayer_HasSize>) nil_chk(lhs)) width], h = [((id<PlaynCoreLayer_HasSize>) nil_chk(lhs)) height];
    if (w != 0 || h != 0) {
      [((PythagorasFRectangle *) nil_chk(bounds)) addWithPythagorasFIPoint:[PlaynCoreLayer_Util layerToParentWithPlaynCoreLayer:l withPlaynCoreLayer:root withPythagorasFIPoint:[((PythagorasFPoint *) nil_chk(scratch)) setWithFloat:0 withFloat:0] withPythagorasFPoint:scratch]];
      [((PythagorasFRectangle *) nil_chk(bounds)) addWithPythagorasFIPoint:[PlaynCoreLayer_Util layerToParentWithPlaynCoreLayer:l withPlaynCoreLayer:root withPythagorasFIPoint:[((PythagorasFPoint *) nil_chk(scratch)) setWithFloat:w withFloat:h] withPythagorasFPoint:scratch]];
    }
  }
  if ([(id) l conformsToProtocol: @protocol(PlaynCoreGroupLayer)]) {
    id<PlaynCoreGroupLayer> group = (id<PlaynCoreGroupLayer>) l;
    for (int ii = 0, ll = [((id<PlaynCoreGroupLayer>) nil_chk(group)) size]; ii < ll; ++ii) {
      [TripleplayUtilLayers addBoundsWithPlaynCoreLayer:root withPlaynCoreLayer:[((id<PlaynCoreGroupLayer>) nil_chk(group)) getWithInt:ii] withPythagorasFRectangle:bounds withPythagorasFPoint:scratch];
    }
  }
}

+ (PythagorasFAffineTransform *)toAffineWithPythagorasFTransform:(id<PythagorasFTransform>)t {
  if ([(id) t isKindOfClass:[PythagorasFAffineTransform class]]) return (PythagorasFAffineTransform *) t;
  else return [[PythagorasFAffineTransform alloc] initWithFloat:[((id<PythagorasFTransform>) nil_chk(t)) scaleX] withFloat:[((id<PythagorasFTransform>) nil_chk(t)) scaleY] withFloat:[((id<PythagorasFTransform>) nil_chk(t)) rotation] withFloat:[((id<PythagorasFTransform>) nil_chk(t)) tx] withFloat:[((id<PythagorasFTransform>) nil_chk(t)) ty]];
}

+ (void)concatTransformWithPlaynCoreCanvas:(id<PlaynCoreCanvas>)canvas
            withPythagorasFAffineTransform:(PythagorasFAffineTransform *)at {
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) transformWithFloat:((PythagorasFAffineTransform *) nil_chk(at)).m00 withFloat:((PythagorasFAffineTransform *) nil_chk(at)).m01 withFloat:((PythagorasFAffineTransform *) nil_chk(at)).m10 withFloat:((PythagorasFAffineTransform *) nil_chk(at)).m11 withFloat:((PythagorasFAffineTransform *) nil_chk(at)).tx_ withFloat:((PythagorasFAffineTransform *) nil_chk(at)).ty_];
}

+ (void)concatTransformWithPlaynCoreCanvas:(id<PlaynCoreCanvas>)canvas
                  withPythagorasFTransform:(id<PythagorasFTransform>)t {
  [TripleplayUtilLayers concatTransformWithPlaynCoreCanvas:canvas withPythagorasFAffineTransform:[TripleplayUtilLayers toAffineWithPythagorasFTransform:t]];
}

- (id)init {
  return [super init];
}

@end
