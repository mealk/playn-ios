//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: tripleplay/util/Hud.java
//
//  Created by Thomas on 7/25/13.
//

#include "java/lang/IllegalStateException.h"
#include "java/lang/Integer.h"
#include "java/lang/Math.h"
#include "java/lang/System.h"
#include "java/util/ArrayList.h"
#include "java/util/Iterator.h"
#include "java/util/List.h"
#include "playn/core/Canvas.h"
#include "playn/core/CanvasImage.h"
#include "playn/core/Font.h"
#include "playn/core/Graphics.h"
#include "playn/core/ImageLayer.h"
#include "playn/core/PlayN.h"
#include "playn/core/TextFormat.h"
#include "playn/core/TextLayout.h"
#include "playn/core/gl/GLContext.h"
#include "react/Value.h"
#include "tripleplay/util/Hud.h"

@implementation TripleplayUtilHud

@synthesize layer = layer_;
@synthesize _rows = _rows_;
@synthesize _paints = _paints_;
@synthesize _fmt = _fmt_;
@synthesize _textColor = _textColor_;
@synthesize _bgColor = _bgColor_;
@synthesize _image = _image_;

+ (float)GAP {
  return TripleplayUtilHud_GAP;
}

- (id)init {
  if ((self = [super init])) {
    _rows_ = [[JavaUtilArrayList alloc] init];
    _fmt_ = [((PlaynCoreTextFormat *) [[PlaynCoreTextFormat alloc] init]) withFontWithPlaynCoreFont:[((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) createFontWithNSString:@"Helvetica" withPlaynCoreFont_StyleEnum:[PlaynCoreFont_StyleEnum PLAIN] withFloat:12]];
    _textColor_ = (int) 0xFF000000;
    _bgColor_ = (int) 0xFFFFFFFF;
    _image_ = [((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) createImageWithFloat:1 withFloat:1];
    layer_ = [((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) createImageLayerWithPlaynCoreImage:_image_];
  }
  return self;
}

- (TripleplayUtilHud *)setFontWithPlaynCoreFont:(id<PlaynCoreFont>)font {
  if (![((id<JavaUtilList>) nil_chk(_rows_)) isEmpty]) @throw [[JavaLangIllegalStateException alloc] initWithNSString:@"Set font before adding rows."];
  _fmt_ = [((PlaynCoreTextFormat *) nil_chk(_fmt_)) withFontWithPlaynCoreFont:font];
  return self;
}

- (TripleplayUtilHud *)setColorsWithInt:(int)textColor
                                withInt:(int)bgColor {
  if (![((id<JavaUtilList>) nil_chk(_rows_)) isEmpty]) @throw [[JavaLangIllegalStateException alloc] initWithNSString:@"Set colors before adding rows."];
  _textColor_ = textColor;
  _bgColor_ = bgColor;
  return self;
}

- (void)addWithNSString:(NSString *)label
               withBOOL:(BOOL)header {
  id<PlaynCoreTextLayout> layout = [((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) layoutTextWithNSString:label withPlaynCoreTextFormat:_fmt_];
  [((id<JavaUtilList>) nil_chk(_rows_)) addWithId:[[TripleplayUtilHud_$1 alloc] initWithPlaynCoreTextLayout:layout withBOOL:header]];
}

- (void)addWithReactValue:(ReactValue *)label {
  [((id<JavaUtilList>) nil_chk(_rows_)) addWithId:[[TripleplayUtilHud_$2 alloc] initWithTripleplayUtilHud:self withReactValue:label]];
}

- (void)addWithNSString:(NSString *)label
         withReactValue:(ReactValue *)value {
  id<PlaynCoreTextLayout> llayout = [((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) layoutTextWithNSString:label withPlaynCoreTextFormat:_fmt_];
  [((id<JavaUtilList>) nil_chk(_rows_)) addWithId:[[TripleplayUtilHud_$3 alloc] initWithTripleplayUtilHud:self withReactValue:value withPlaynCoreTextLayout:llayout]];
}

- (void)update {
  float width = 0, height = 0, labelWidth = 0;
  {
    id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk(_rows_)) iterator];
    while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
      id<TripleplayUtilHud_Row> row = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
      [((id<TripleplayUtilHud_Row>) nil_chk(row)) update];
      width = [JavaLangMath maxWithFloat:[((id<TripleplayUtilHud_Row>) nil_chk(row)) width] withFloat:width];
      labelWidth = [JavaLangMath maxWithFloat:[((id<TripleplayUtilHud_Row>) nil_chk(row)) labelWidth] withFloat:labelWidth];
      height += [((id<TripleplayUtilHud_Row>) nil_chk(row)) height];
    }
  }
  width += 2 * TripleplayUtilHud_GAP;
  height += TripleplayUtilHud_GAP * [((id<JavaUtilList>) nil_chk(_rows_)) size] + TripleplayUtilHud_GAP;
  if ([((id<PlaynCoreCanvasImage>) nil_chk(_image_)) width] < width || [((id<PlaynCoreCanvasImage>) nil_chk(_image_)) height] < height) {
    (void) [((id<PlaynCoreImageLayer>) nil_chk(layer_)) setImageWithPlaynCoreImage:_image_ = [((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) createImageWithFloat:width withFloat:height]];
  }
  id<PlaynCoreCanvas> canvas = [((id<PlaynCoreCanvasImage>) nil_chk(_image_)) canvas];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) clear];
  (void) [((id<PlaynCoreCanvas>) nil_chk([((id<PlaynCoreCanvas>) nil_chk(canvas)) setFillColorWithInt:_bgColor_])) fillRectWithFloat:0 withFloat:0 withFloat:width withFloat:height];
  (void) [((id<PlaynCoreCanvas>) nil_chk([((id<PlaynCoreCanvas>) nil_chk(canvas)) setStrokeColorWithInt:_textColor_])) setFillColorWithInt:_textColor_];
  float x = TripleplayUtilHud_GAP, y = TripleplayUtilHud_GAP, valueX = labelWidth + 2 * TripleplayUtilHud_GAP;
  {
    id<JavaUtilIterator> iter__ = [((id<JavaUtilList>) nil_chk(_rows_)) iterator];
    while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
      id<TripleplayUtilHud_Row> row = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
      [((id<TripleplayUtilHud_Row>) nil_chk(row)) renderWithPlaynCoreCanvas:canvas withFloat:x withFloat:y withFloat:valueX];
      y += [((id<TripleplayUtilHud_Row>) nil_chk(row)) height] + TripleplayUtilHud_GAP;
    }
  }
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayUtilHud *typedCopy = (TripleplayUtilHud *) copy;
  typedCopy.layer = layer_;
  typedCopy._rows = _rows_;
  typedCopy._paints = _paints_;
  typedCopy._fmt = _fmt_;
  typedCopy._textColor = _textColor_;
  typedCopy._bgColor = _bgColor_;
  typedCopy._image = _image_;
}

@end
@implementation TripleplayUtilHud_Stock

@synthesize _haveGL = _haveGL_;
@synthesize _nextSec = _nextSec_;
@synthesize _frames = _frames_;
@synthesize _shaderCreates = _shaderCreates_;
@synthesize _fbCreates = _fbCreates_;
@synthesize _texCreates = _texCreates_;
@synthesize _shaderBinds = _shaderBinds_;
@synthesize _fbBinds = _fbBinds_;
@synthesize _texBinds = _texBinds_;
@synthesize _rQuads = _rQuads_;
@synthesize _rTris = _rTris_;
@synthesize _shaderFlushes = _shaderFlushes_;
@synthesize _quadShader = _quadShader_;
@synthesize _trisShader = _trisShader_;

- (id)init {
  if ((self = [super init])) {
    _frames_ = [ReactValue createWithId:[JavaLangInteger valueOfWithInt:0]];
    _shaderCreates_ = [ReactValue createWithId:[JavaLangInteger valueOfWithInt:0]];
    _fbCreates_ = [ReactValue createWithId:[JavaLangInteger valueOfWithInt:0]];
    _texCreates_ = [ReactValue createWithId:[JavaLangInteger valueOfWithInt:0]];
    _shaderBinds_ = [ReactValue createWithId:[JavaLangInteger valueOfWithInt:0]];
    _fbBinds_ = [ReactValue createWithId:[JavaLangInteger valueOfWithInt:0]];
    _texBinds_ = [ReactValue createWithId:[JavaLangInteger valueOfWithInt:0]];
    _rQuads_ = [ReactValue createWithId:[JavaLangInteger valueOfWithInt:0]];
    _rTris_ = [ReactValue createWithId:[JavaLangInteger valueOfWithInt:0]];
    _shaderFlushes_ = [ReactValue createWithId:[JavaLangInteger valueOfWithInt:0]];
    _quadShader_ = [ReactValue createWithId:@""];
    _trisShader_ = [ReactValue createWithId:@""];
    _haveGL_ = ([((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) ctx] != nil);
    if (_haveGL_) {
      [self addWithNSString:@"Shader info:" withBOOL:YES];
      [self addWithReactValue:_quadShader_];
      [self addWithReactValue:_trisShader_];
    }
    [self addWithNSString:@"Per second:" withBOOL:YES];
    [self addWithNSString:@"Frames:" withReactValue:_frames_];
    if (_haveGL_) {
      [self addWithNSString:@"Shader creates:" withReactValue:_shaderCreates_];
      [self addWithNSString:@"FB creates:" withReactValue:_fbCreates_];
      [self addWithNSString:@"Tex creates:" withReactValue:_texCreates_];
      [self addWithNSString:@"Per frame:" withBOOL:YES];
      [self addWithNSString:@"Shader binds:" withReactValue:_shaderBinds_];
      [self addWithNSString:@"FB binds:" withReactValue:_fbBinds_];
      [self addWithNSString:@"Tex binds:" withReactValue:_texBinds_];
      [self addWithNSString:@"Quads drawn:" withReactValue:_rQuads_];
      [self addWithNSString:@"Tris drawn:" withReactValue:_rTris_];
      [self addWithNSString:@"Shader flushes:" withReactValue:_shaderFlushes_];
    }
  }
  return self;
}

- (void)updateWithInt:(int)delta {
  long long int now = [JavaLangSystem currentTimeMillis];
  if (now > _nextSec_) {
    [self willUpdate];
    [self update];
    _nextSec_ = now + 1000;
  }
}

- (void)paint {
  _paints_ += 1;
}

- (void)willUpdate {
  if (_haveGL_) {
    PlaynCoreGlGLContext_Stats *stats = [((PlaynCoreGlGLContext *) nil_chk([((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) ctx])) stats];
    int frames = [JavaLangMath maxWithInt:((PlaynCoreGlGLContext_Stats *) nil_chk(stats)).frames withInt:1];
    (void) [((ReactValue *) nil_chk(_frames_)) updateWithId:[JavaLangInteger valueOfWithInt:frames]];
    (void) [((ReactValue *) nil_chk(_shaderCreates_)) updateWithId:[JavaLangInteger valueOfWithInt:((PlaynCoreGlGLContext_Stats *) nil_chk(stats)).shaderCreates]];
    (void) [((ReactValue *) nil_chk(_fbCreates_)) updateWithId:[JavaLangInteger valueOfWithInt:((PlaynCoreGlGLContext_Stats *) nil_chk(stats)).frameBufferCreates]];
    (void) [((ReactValue *) nil_chk(_texCreates_)) updateWithId:[JavaLangInteger valueOfWithInt:((PlaynCoreGlGLContext_Stats *) nil_chk(stats)).texCreates]];
    (void) [((ReactValue *) nil_chk(_shaderBinds_)) updateWithId:[JavaLangInteger valueOfWithInt:((PlaynCoreGlGLContext_Stats *) nil_chk(stats)).shaderBinds / frames]];
    (void) [((ReactValue *) nil_chk(_fbBinds_)) updateWithId:[JavaLangInteger valueOfWithInt:((PlaynCoreGlGLContext_Stats *) nil_chk(stats)).frameBufferBinds / frames]];
    (void) [((ReactValue *) nil_chk(_texBinds_)) updateWithId:[JavaLangInteger valueOfWithInt:((PlaynCoreGlGLContext_Stats *) nil_chk(stats)).texBinds / frames]];
    (void) [((ReactValue *) nil_chk(_rQuads_)) updateWithId:[JavaLangInteger valueOfWithInt:((PlaynCoreGlGLContext_Stats *) nil_chk(stats)).quadsRendered / frames]];
    (void) [((ReactValue *) nil_chk(_rTris_)) updateWithId:[JavaLangInteger valueOfWithInt:((PlaynCoreGlGLContext_Stats *) nil_chk(stats)).trisRendered / frames]];
    (void) [((ReactValue *) nil_chk(_shaderFlushes_)) updateWithId:[JavaLangInteger valueOfWithInt:((PlaynCoreGlGLContext_Stats *) nil_chk(stats)).shaderFlushes / frames]];
    [((PlaynCoreGlGLContext_Stats *) nil_chk(stats)) reset];
    (void) [((ReactValue *) nil_chk(_quadShader_)) updateWithId:[NSString stringWithFormat:@"Quad: %@", [((PlaynCoreGlGLContext *) nil_chk([((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) ctx])) quadShaderInfo]]];
    (void) [((ReactValue *) nil_chk(_trisShader_)) updateWithId:[NSString stringWithFormat:@"Tris: %@", [((PlaynCoreGlGLContext *) nil_chk([((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) ctx])) trisShaderInfo]]];
  }
  else {
    (void) [((ReactValue *) nil_chk(_frames_)) updateWithId:[JavaLangInteger valueOfWithInt:_paints_]];
    _paints_ = 0;
  }
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayUtilHud_Stock *typedCopy = (TripleplayUtilHud_Stock *) copy;
  typedCopy._haveGL = _haveGL_;
  typedCopy._nextSec = _nextSec_;
  typedCopy._frames = _frames_;
  typedCopy._shaderCreates = _shaderCreates_;
  typedCopy._fbCreates = _fbCreates_;
  typedCopy._texCreates = _texCreates_;
  typedCopy._shaderBinds = _shaderBinds_;
  typedCopy._fbBinds = _fbBinds_;
  typedCopy._texBinds = _texBinds_;
  typedCopy._rQuads = _rQuads_;
  typedCopy._rTris = _rTris_;
  typedCopy._shaderFlushes = _shaderFlushes_;
  typedCopy._quadShader = _quadShader_;
  typedCopy._trisShader = _trisShader_;
}

@end
@implementation TripleplayUtilHud_$1

@synthesize val$layout = val$layout_;
@synthesize val$header = val$header_;

- (void)update {
}

- (float)labelWidth {
  return 0;
}

- (float)width {
  return [((id<PlaynCoreTextLayout>) nil_chk(val$layout_)) width];
}

- (float)height {
  return [((id<PlaynCoreTextLayout>) nil_chk(val$layout_)) height];
}

- (void)renderWithPlaynCoreCanvas:(id<PlaynCoreCanvas>)canvas
                        withFloat:(float)x
                        withFloat:(float)y
                        withFloat:(float)valueX {
  if (val$header_) (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) drawLineWithFloat:0 withFloat:y - 1 withFloat:[((id<PlaynCoreCanvas>) nil_chk(canvas)) width] withFloat:y - 1];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) fillTextWithPlaynCoreTextLayout:val$layout_ withFloat:x withFloat:y];
  float by = y + [((id<PlaynCoreTextLayout>) nil_chk(val$layout_)) height];
  if (val$header_) (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) drawLineWithFloat:0 withFloat:by withFloat:[((id<PlaynCoreCanvas>) nil_chk(canvas)) width] withFloat:by];
}

- (id)initWithPlaynCoreTextLayout:(id<PlaynCoreTextLayout>)capture$0
                         withBOOL:(BOOL)capture$1 {
  if ((self = [super init])) {
    val$layout_ = capture$0;
    val$header_ = capture$1;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayUtilHud_$1 *typedCopy = (TripleplayUtilHud_$1 *) copy;
  typedCopy.val$layout = val$layout_;
  typedCopy.val$header = val$header_;
}

@end
@implementation TripleplayUtilHud_$2

@synthesize this$0 = this$0_;
@synthesize _layout = _layout_;
@synthesize val$label = val$label_;

- (void)update {
  _layout_ = [((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) layoutTextWithNSString:[NSString valueOf:[((ReactValue *) nil_chk(val$label_)) get]] withPlaynCoreTextFormat:this$0_._fmt];
}

- (float)labelWidth {
  return 0;
}

- (float)width {
  return [((id<PlaynCoreTextLayout>) nil_chk(_layout_)) width];
}

- (float)height {
  return [((id<PlaynCoreTextLayout>) nil_chk(_layout_)) height];
}

- (void)renderWithPlaynCoreCanvas:(id<PlaynCoreCanvas>)canvas
                        withFloat:(float)x
                        withFloat:(float)y
                        withFloat:(float)valueX {
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) fillTextWithPlaynCoreTextLayout:_layout_ withFloat:x withFloat:y];
}

- (id)initWithTripleplayUtilHud:(TripleplayUtilHud *)outer$
                 withReactValue:(ReactValue *)capture$0 {
  if ((self = [super init])) {
    this$0_ = outer$;
    val$label_ = capture$0;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayUtilHud_$2 *typedCopy = (TripleplayUtilHud_$2 *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy._layout = _layout_;
  typedCopy.val$label = val$label_;
}

@end
@implementation TripleplayUtilHud_$3

@synthesize this$0 = this$0_;
@synthesize _vlayout = _vlayout_;
@synthesize val$value = val$value_;
@synthesize val$llayout = val$llayout_;

- (void)update {
  _vlayout_ = [((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) layoutTextWithNSString:[NSString valueOf:[((ReactValue *) nil_chk(val$value_)) get]] withPlaynCoreTextFormat:this$0_._fmt];
}

- (float)labelWidth {
  return [((id<PlaynCoreTextLayout>) nil_chk(val$llayout_)) width];
}

- (float)width {
  return [((id<PlaynCoreTextLayout>) nil_chk(val$llayout_)) width] + TripleplayUtilHud_GAP + [((id<PlaynCoreTextLayout>) nil_chk(_vlayout_)) width];
}

- (float)height {
  return [JavaLangMath maxWithFloat:[((id<PlaynCoreTextLayout>) nil_chk(val$llayout_)) height] withFloat:[((id<PlaynCoreTextLayout>) nil_chk(_vlayout_)) height]];
}

- (void)renderWithPlaynCoreCanvas:(id<PlaynCoreCanvas>)canvas
                        withFloat:(float)x
                        withFloat:(float)y
                        withFloat:(float)valueX {
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) fillTextWithPlaynCoreTextLayout:val$llayout_ withFloat:x withFloat:y];
  (void) [((id<PlaynCoreCanvas>) nil_chk(canvas)) fillTextWithPlaynCoreTextLayout:_vlayout_ withFloat:valueX withFloat:y];
}

- (id)initWithTripleplayUtilHud:(TripleplayUtilHud *)outer$
                 withReactValue:(ReactValue *)capture$0
        withPlaynCoreTextLayout:(id<PlaynCoreTextLayout>)capture$1 {
  if ((self = [super init])) {
    this$0_ = outer$;
    val$value_ = capture$0;
    val$llayout_ = capture$1;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayUtilHud_$3 *typedCopy = (TripleplayUtilHud_$3 *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy._vlayout = _vlayout_;
  typedCopy.val$value = val$value_;
  typedCopy.val$llayout = val$llayout_;
}

@end
