//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: tripleplay/util/Glyph.java
//
//  Created by Thomas on 7/25/13.
//

#include "IOSClass.h"
#include "java/lang/Float.h"
#include "playn/core/Canvas.h"
#include "playn/core/CanvasImage.h"
#include "playn/core/Graphics.h"
#include "playn/core/GroupLayer.h"
#include "playn/core/ImageLayer.h"
#include "playn/core/Layer.h"
#include "playn/core/PlayN.h"
#include "playn/core/TextLayout.h"
#include "pythagoras/f/IDimension.h"
#include "tripleplay/util/EffectRenderer.h"
#include "tripleplay/util/Glyph.h"
#include "tripleplay/util/Ref.h"
#include "tripleplay/util/TextConfig.h"

@implementation TripleplayUtilGlyph

@synthesize _parent = _parent_;
@synthesize _depth = _depth_;
@synthesize _image = _image_;
@synthesize _layer = _layer_;
@synthesize _preparedWidth = _preparedWidth_;
@synthesize _preparedHeight = _preparedHeight_;

- (id)initWithPlaynCoreGroupLayer:(id<PlaynCoreGroupLayer>)parent {
  if ((self = [super init])) {
    _layer_ = [TripleplayUtilRef createWithId:nil];
    _parent_ = parent;
    _depth_ = nil;
  }
  return self;
}

- (id)initWithPlaynCoreGroupLayer:(id<PlaynCoreGroupLayer>)parent
                        withFloat:(float)depth {
  if ((self = [super init])) {
    _layer_ = [TripleplayUtilRef createWithId:nil];
    _parent_ = parent;
    _depth_ = [JavaLangFloat valueOfWithFloat:depth];
  }
  return self;
}

- (void)prepareWithPythagorasFIDimension:(id<PythagorasFIDimension>)dim {
  [self prepareWithFloat:[((id<PythagorasFIDimension>) nil_chk(dim)) width] withFloat:[((id<PythagorasFIDimension>) nil_chk(dim)) height]];
}

- (void)prepareWithFloat:(float)width
               withFloat:(float)height {
  id<PlaynCoreImageLayer> layer = [((TripleplayUtilRef *) nil_chk(_layer_)) get];
  if (_image_ == nil || [((id<PlaynCoreCanvasImage>) nil_chk(_image_)) width] < width || [((id<PlaynCoreCanvasImage>) nil_chk(_image_)) height] < height) {
    _image_ = [((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) createImageWithFloat:width withFloat:height];
    if (layer != nil) (void) [layer setImageWithPlaynCoreImage:_image_];
  }
  else {
    (void) [((id<PlaynCoreCanvas>) nil_chk([((id<PlaynCoreCanvasImage>) nil_chk(_image_)) canvas])) clear];
  }
  if (layer == nil) {
    layer = [((TripleplayUtilRef *) nil_chk(_layer_)) setWithId:[((id<PlaynCoreGraphics>) nil_chk([PlaynCorePlayN graphics])) createImageLayerWithPlaynCoreImage:_image_]];
    if (_depth_ != nil) (void) [((id<PlaynCoreImageLayer>) nil_chk(layer)) setDepthWithFloat:[_depth_ floatValue]];
    [((id<PlaynCoreGroupLayer>) nil_chk(_parent_)) addWithPlaynCoreLayer:layer];
  }
  _preparedWidth_ = width;
  _preparedHeight_ = height;
}

- (id<PlaynCoreImageLayer>)layer {
  return [((TripleplayUtilRef *) nil_chk(_layer_)) get];
}

- (id<PlaynCoreCanvas>)canvas {
  return [((id<PlaynCoreCanvasImage>) nil_chk(_image_)) canvas];
}

- (void)destroy {
  [((TripleplayUtilRef *) nil_chk(_layer_)) clear];
  _image_ = nil;
}

- (float)preparedWidth {
  return _preparedWidth_;
}

- (float)preparedHeight {
  return _preparedHeight_;
}

- (void)renderTextWithTripleplayUtilTextConfig:(TripleplayUtilTextConfig *)config
                                  withNSString:(NSString *)text {
  [self renderTextWithTripleplayUtilTextConfig:config withPlaynCoreTextLayout:[((TripleplayUtilTextConfig *) nil_chk(config)) layoutWithNSString:text]];
}

- (void)renderTextWithTripleplayUtilTextConfig:(TripleplayUtilTextConfig *)config
                       withPlaynCoreTextLayout:(id<PlaynCoreTextLayout>)layout {
  [self prepareWithFloat:[((TripleplayUtilEffectRenderer *) nil_chk(((TripleplayUtilTextConfig *) nil_chk(config)).effect)) adjustWidthWithFloat:[((id<PlaynCoreTextLayout>) nil_chk(layout)) width]] withFloat:[((TripleplayUtilEffectRenderer *) nil_chk(((TripleplayUtilTextConfig *) nil_chk(config)).effect)) adjustHeightWithFloat:[((id<PlaynCoreTextLayout>) nil_chk(layout)) height]]];
  [((TripleplayUtilTextConfig *) nil_chk(config)) renderWithPlaynCoreCanvas:[self canvas] withPlaynCoreTextLayout:layout withFloat:0 withFloat:0];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayUtilGlyph *typedCopy = (TripleplayUtilGlyph *) copy;
  typedCopy._parent = _parent_;
  typedCopy._depth = _depth_;
  typedCopy._image = _image_;
  typedCopy._layer = _layer_;
  typedCopy._preparedWidth = _preparedWidth_;
  typedCopy._preparedHeight = _preparedHeight_;
}

@end
