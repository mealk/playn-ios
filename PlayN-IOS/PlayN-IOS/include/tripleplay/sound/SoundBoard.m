//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: tripleplay/sound/SoundBoard.java
//
//  Created by Thomas on 7/25/13.
//

#include "IOSClass.h"
#include "java/lang/Boolean.h"
#include "java/lang/Float.h"
#include "java/util/ArrayList.h"
#include "java/util/HashSet.h"
#include "java/util/Iterator.h"
#include "java/util/List.h"
#include "java/util/Set.h"
#include "playn/core/Assets.h"
#include "playn/core/PlayN.h"
#include "playn/core/Sound.h"
#include "pythagoras/f/MathUtil.h"
#include "react/Connection.h"
#include "react/Value.h"
#include "tripleplay/sound/Clip.h"
#include "tripleplay/sound/Loop.h"
#include "tripleplay/sound/SoundBoard.h"
#include "tripleplay/util/Interpolator.h"

@implementation TripleplaySoundSoundBoard

@synthesize volume = volume_;
@synthesize muted = muted_;
@synthesize _active = _active_;
@synthesize _faders = _faders_;

+ (float)FADE_DURATION {
  return TripleplaySoundSoundBoard_FADE_DURATION;
}

- (id)init {
  if ((self = [super init])) {
    volume_ = [[TripleplaySoundSoundBoard_$1 alloc] initWithJavaLangFloat:[JavaLangFloat valueOfWithFloat:1.0f]];
    muted_ = [ReactValue createWithId:[JavaLangBoolean valueOfWithBOOL:NO]];
    _active_ = [[JavaUtilHashSet alloc] init];
    _faders_ = [[JavaUtilArrayList alloc] init];
    (void) [((ReactValue *) nil_chk(volume_)) connectWithReactValueView_Listener:[[TripleplaySoundSoundBoard_$2 alloc] initWithTripleplaySoundSoundBoard:self]];
    (void) [((ReactValue *) nil_chk(muted_)) connectWithReactValueView_Listener:[[TripleplaySoundSoundBoard_$3 alloc] initWithTripleplaySoundSoundBoard:self]];
  }
  return self;
}

- (void)updateWithInt:(int)delta {
  for (int ii = 0, ll = [((id<JavaUtilList>) nil_chk(_faders_)) size]; ii < ll; ii++) {
    if ([((TripleplaySoundSoundBoard_Fader *) nil_chk([((id<JavaUtilList>) nil_chk(_faders_)) getWithInt:ii])) updateWithInt:delta]) {
      (void) [((id<JavaUtilList>) nil_chk(_faders_)) removeWithInt:ii--];
      ll--;
    }
  }
}

- (id<TripleplaySoundClip>)getClipWithNSString:(NSString *)path {
  return [[TripleplaySoundSoundBoard_$4 alloc] initWithTripleplaySoundSoundBoard:self withNSString:path];
}

- (id<TripleplaySoundLoop>)getLoopWithNSString:(NSString *)path {
  return [[TripleplaySoundSoundBoard_$5 alloc] initWithTripleplaySoundSoundBoard:self withNSString:path];
}

- (BOOL)shouldPlay {
  return ![((JavaLangBoolean *) nil_chk([((ReactValue *) nil_chk(muted_)) get])) booleanValue] && [((JavaLangFloat *) nil_chk([((ReactValue *) nil_chk(volume_)) get])) floatValue] > 0;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard *typedCopy = (TripleplaySoundSoundBoard *) copy;
  typedCopy.volume = volume_;
  typedCopy.muted = muted_;
  typedCopy._active = _active_;
  typedCopy._faders = _faders_;
}

@end
@implementation TripleplaySoundSoundBoard_ClipImpl_$1

@synthesize this$0 = this$0_;

- (BOOL)play {
  [this$0_ play];
  return YES;
}

- (void)stop {
  [this$0_ stop];
}

- (id)initWithTripleplaySoundSoundBoard_ClipImpl:(TripleplaySoundSoundBoard_ClipImpl *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_ClipImpl_$1 *typedCopy = (TripleplaySoundSoundBoard_ClipImpl_$1 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
@implementation TripleplaySoundSoundBoard_Fader

- (BOOL)updateWithInt:(int)delta {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (id)initWithTripleplaySoundSoundBoard:(TripleplaySoundSoundBoard *)outer$ {
  return [super init];
}

@end
@implementation TripleplaySoundSoundBoard_LazySound_$1

@synthesize this$1 = this$1_;
@synthesize _range = _range_;
@synthesize _elapsed = _elapsed_;
@synthesize val$fadeMillis = val$fadeMillis_;

- (BOOL)updateWithInt:(int)delta {
  _elapsed_ += delta;
  float vol = [((TripleplayUtilInterpolator *) nil_chk([TripleplayUtilInterpolator LINEAR])) applyWithFloat:0 withFloat:_range_ withFloat:_elapsed_ withFloat:val$fadeMillis_];
  [this$1_ updateVolumeWithFloat:vol];
  return (vol >= _range_);
}

- (id)initWithTripleplaySoundSoundBoard_LazySound:(TripleplaySoundSoundBoard_LazySound *)outer$
                                        withFloat:(float)capture$0 {
  if ((self = [super initWithTripleplaySoundSoundBoard:outer$.this$0])) {
    this$1_ = outer$;
    val$fadeMillis_ = capture$0;
    _range_ = [((JavaLangFloat *) nil_chk([((ReactValue *) nil_chk(outer$.this$0.volume)) get])) floatValue];
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_LazySound_$1 *typedCopy = (TripleplaySoundSoundBoard_LazySound_$1 *) copy;
  typedCopy.this$1 = this$1_;
  typedCopy._range = _range_;
  typedCopy._elapsed = _elapsed_;
  typedCopy.val$fadeMillis = val$fadeMillis_;
}

@end
@implementation TripleplaySoundSoundBoard_LazySound_$2

@synthesize this$1 = this$1_;
@synthesize _start = _start_;
@synthesize _elapsed = _elapsed_;
@synthesize val$fadeMillis = val$fadeMillis_;

- (BOOL)updateWithInt:(int)delta {
  _elapsed_ += delta;
  float vol = [((TripleplayUtilInterpolator *) nil_chk([TripleplayUtilInterpolator LINEAR])) applyWithFloat:_start_ withFloat:-_start_ withFloat:_elapsed_ withFloat:val$fadeMillis_];
  [this$1_ updateVolumeWithFloat:vol];
  if (vol > 0) return NO;
  else {
    [this$1_ fadeOutComplete];
    return YES;
  }
}

- (id)initWithTripleplaySoundSoundBoard_LazySound:(TripleplaySoundSoundBoard_LazySound *)outer$
                                        withFloat:(float)capture$0 {
  if ((self = [super initWithTripleplaySoundSoundBoard:outer$.this$0])) {
    this$1_ = outer$;
    val$fadeMillis_ = capture$0;
    _start_ = [((JavaLangFloat *) nil_chk([((ReactValue *) nil_chk(outer$.this$0.volume)) get])) floatValue];
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_LazySound_$2 *typedCopy = (TripleplaySoundSoundBoard_LazySound_$2 *) copy;
  typedCopy.this$1 = this$1_;
  typedCopy._start = _start_;
  typedCopy._elapsed = _elapsed_;
  typedCopy.val$fadeMillis = val$fadeMillis_;
}

@end
@implementation TripleplaySoundSoundBoard_$1

- (JavaLangFloat *)updateAndNotifyIfWithId:(JavaLangFloat *)value {
  return [super updateAndNotifyIfWithId:[[JavaLangFloat alloc] initWithFloat:[PythagorasFMathUtil clampWithFloat:[((JavaLangFloat *) nil_chk(value)) floatValue] withFloat:0 withFloat:1]]];
}

- (id)initWithJavaLangFloat:(JavaLangFloat *)arg$0 {
  return [super initWithId:arg$0];
}

@end
@implementation TripleplaySoundSoundBoard_$2

@synthesize this$0 = this$0_;

- (void)onEmitWithId:(JavaLangFloat *)volume {
  {
    id<JavaUtilIterator> iter__ = [((id<JavaUtilSet>) nil_chk(this$0_._active)) iterator];
    while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
      TripleplaySoundSoundBoard_LoopImpl *active = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
      [((TripleplaySoundSoundBoard_LoopImpl *) nil_chk(active)) updateVolumeWithFloat:[((JavaLangFloat *) nil_chk(volume)) floatValue]];
    }
  }
}

- (id)initWithTripleplaySoundSoundBoard:(TripleplaySoundSoundBoard *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_$2 *typedCopy = (TripleplaySoundSoundBoard_$2 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
@implementation TripleplaySoundSoundBoard_$3

@synthesize this$0 = this$0_;

- (void)onEmitWithId:(JavaLangBoolean *)muted {
  {
    id<JavaUtilIterator> iter__ = [((id<JavaUtilSet>) nil_chk(this$0_._active)) iterator];
    while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
      TripleplaySoundSoundBoard_LoopImpl *active = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
      [((TripleplaySoundSoundBoard_LoopImpl *) nil_chk(active)) fadeForMuteWithBOOL:[((JavaLangBoolean *) nil_chk(muted)) booleanValue]];
    }
  }
}

- (id)initWithTripleplaySoundSoundBoard:(TripleplaySoundSoundBoard *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_$3 *typedCopy = (TripleplaySoundSoundBoard_$3 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
@implementation TripleplaySoundSoundBoard_LazySound

@synthesize this$0 = this$0_;
@synthesize sound = sound_;
@synthesize _volume = _volume_;

- (BOOL)isPlaying {
  return (sound_ == nil) ? NO : [((id<PlaynCoreSound>) nil_chk(sound_)) isPlaying];
}

- (void)setVolumeWithFloat:(float)volume {
  _volume_ = volume;
  [self updateVolumeWithFloat:[((JavaLangFloat *) nil_chk([((ReactValue *) nil_chk(this$0_.volume)) get])) floatValue]];
}

- (float)volume {
  return _volume_;
}

- (void)release__ {
  if (sound_ != nil) {
    if ([sound_ isPlaying]) [sound_ stop];
    [sound_ release__];
    sound_ = nil;
  }
}

- (NSUInteger)hash {
  return [((NSString *) nil_chk([self path])) hash];
}

- (BOOL)isEqual:(id)other {
  return (other == self) ? YES : (other != nil) && [nil_chk(other) getClass] == [self getClass] && [((NSString *) nil_chk([self path])) isEqual:[((TripleplaySoundSoundBoard_LazySound *) other) path]];
}

- (void)updateVolumeWithFloat:(float)volume {
  if ([self isPlaying]) {
    float effectiveVolume = volume * _volume_;
    if (effectiveVolume > 0) [((id<PlaynCoreSound>) nil_chk(sound_)) setVolumeWithFloat:effectiveVolume];
    else [((id<PlaynCoreSound>) nil_chk(sound_)) stop];
  }
}

- (void)startFadeInWithFloat:(float)fadeMillis {
  if (![self isPlaying]) [((id<PlaynCoreSound>) nil_chk([self prepareSound])) play];
  [((id<PlaynCoreSound>) nil_chk(sound_)) setVolumeWithFloat:0];
  [((id<JavaUtilList>) nil_chk(this$0_._faders)) addWithId:[[TripleplaySoundSoundBoard_LazySound_$1 alloc] initWithTripleplaySoundSoundBoard_LazySound:self withFloat:fadeMillis]];
}

- (void)startFadeOutWithFloat:(float)fadeMillis {
  if ([self isPlaying]) [((id<JavaUtilList>) nil_chk(this$0_._faders)) addWithId:[[TripleplaySoundSoundBoard_LazySound_$2 alloc] initWithTripleplaySoundSoundBoard_LazySound:self withFloat:fadeMillis]];
}

- (id<PlaynCoreSound>)prepareSound {
  if (sound_ == nil) sound_ = [self loadSoundWithNSString:[self path]];
  [((id<PlaynCoreSound>) nil_chk(sound_)) setVolumeWithFloat:[((JavaLangFloat *) nil_chk([((ReactValue *) nil_chk(this$0_.volume)) get])) floatValue] * _volume_];
  return sound_;
}

- (void)fadeOutComplete {
}

- (id<PlaynCoreSound>)loadSoundWithNSString:(NSString *)path {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (NSString *)path {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (void)play {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
}

- (void)stop {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
}

- (id)initWithTripleplaySoundSoundBoard:(TripleplaySoundSoundBoard *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
    _volume_ = 1;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_LazySound *typedCopy = (TripleplaySoundSoundBoard_LazySound *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy.sound = sound_;
  typedCopy._volume = _volume_;
}

@end
@implementation TripleplaySoundSoundBoard_ClipImpl

@synthesize this$1 = this$1_;

- (void)preload {
  if ([this$1_ shouldPlay]) (void) [self prepareSound];
}

- (void)play {
  if ([this$1_ shouldPlay]) [((id<PlaynCoreSound>) nil_chk([self prepareSound])) play];
}

- (void)fadeInWithFloat:(float)fadeMillis {
  if ([this$1_ shouldPlay]) [self startFadeInWithFloat:fadeMillis];
}

- (void)fadeOutWithFloat:(float)fadeMillis {
  if ([this$1_ shouldPlay]) [self startFadeOutWithFloat:fadeMillis];
}

- (void)stop {
  if ([self isPlaying]) [((id<PlaynCoreSound>) nil_chk(sound_)) stop];
}

- (id<PlaynCoreSound>)asSound {
  return [[TripleplaySoundSoundBoard_ClipImpl_$1 alloc] initWithTripleplaySoundSoundBoard_ClipImpl:self];
}

- (NSString *)description {
  return [NSString stringWithFormat:@"clip:%@", sound_];
}

- (id<PlaynCoreSound>)loadSoundWithNSString:(NSString *)path {
  return [((id<PlaynCoreAssets>) nil_chk([PlaynCorePlayN assets])) getSoundWithNSString:path];
}

- (id)initWithTripleplaySoundSoundBoard:(TripleplaySoundSoundBoard *)outer$ {
  if ((self = [super initWithTripleplaySoundSoundBoard:outer$])) {
    this$1_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_ClipImpl *typedCopy = (TripleplaySoundSoundBoard_ClipImpl *) copy;
  typedCopy.this$1 = this$1_;
}

@end
@implementation TripleplaySoundSoundBoard_$4

@synthesize val$path = val$path_;

- (NSString *)path {
  return val$path_;
}

- (id)initWithTripleplaySoundSoundBoard:(TripleplaySoundSoundBoard *)outer$
                           withNSString:(NSString *)capture$0 {
  if ((self = [super initWithTripleplaySoundSoundBoard:outer$])) {
    val$path_ = capture$0;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_$4 *typedCopy = (TripleplaySoundSoundBoard_$4 *) copy;
  typedCopy.val$path = val$path_;
}

@end
@implementation TripleplaySoundSoundBoard_LoopImpl

@synthesize this$1 = this$1_;

- (void)fadeForMuteWithBOOL:(BOOL)muted {
  if (muted) [self startFadeOutWithFloat:TripleplaySoundSoundBoard_FADE_DURATION];
  else [self startFadeInWithFloat:TripleplaySoundSoundBoard_FADE_DURATION];
}

- (void)play {
  if (![((id<JavaUtilSet>) nil_chk(this$1_._active)) addWithId:self]) return;
  if ([this$1_ shouldPlay] && ![self isPlaying]) [((id<PlaynCoreSound>) nil_chk([self prepareSound])) play];
}

- (void)fadeInWithFloat:(float)fadeMillis {
  if ([((id<JavaUtilSet>) nil_chk(this$1_._active)) addWithId:self] && [this$1_ shouldPlay]) [self startFadeInWithFloat:fadeMillis];
}

- (void)fadeOutWithFloat:(float)fadeMillis {
  if ([((id<JavaUtilSet>) nil_chk(this$1_._active)) removeWithId:self] && [this$1_ shouldPlay]) [self startFadeOutWithFloat:fadeMillis];
}

- (void)stop {
  if ([((id<JavaUtilSet>) nil_chk(this$1_._active)) removeWithId:self] && [self isPlaying]) [((id<PlaynCoreSound>) nil_chk(sound_)) stop];
}

- (NSString *)description {
  return [NSString stringWithFormat:@"loop:%@", sound_];
}

- (id<PlaynCoreSound>)prepareSound {
  id<PlaynCoreSound> sound = [super prepareSound];
  [((id<PlaynCoreSound>) nil_chk(sound)) setLoopingWithBOOL:YES];
  return sound;
}

- (void)fadeOutComplete {
  [((id<PlaynCoreSound>) nil_chk(sound_)) release__];
  sound_ = nil;
}

- (id<PlaynCoreSound>)loadSoundWithNSString:(NSString *)path {
  return [((id<PlaynCoreAssets>) nil_chk([PlaynCorePlayN assets])) getMusicWithNSString:path];
}

- (id)initWithTripleplaySoundSoundBoard:(TripleplaySoundSoundBoard *)outer$ {
  if ((self = [super initWithTripleplaySoundSoundBoard:outer$])) {
    this$1_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_LoopImpl *typedCopy = (TripleplaySoundSoundBoard_LoopImpl *) copy;
  typedCopy.this$1 = this$1_;
}

@end
@implementation TripleplaySoundSoundBoard_$5

@synthesize val$path = val$path_;

- (NSString *)path {
  return val$path_;
}

- (id)initWithTripleplaySoundSoundBoard:(TripleplaySoundSoundBoard *)outer$
                           withNSString:(NSString *)capture$0 {
  if ((self = [super initWithTripleplaySoundSoundBoard:outer$])) {
    val$path_ = capture$0;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_$5 *typedCopy = (TripleplaySoundSoundBoard_$5 *) copy;
  typedCopy.val$path = val$path_;
}

@end
