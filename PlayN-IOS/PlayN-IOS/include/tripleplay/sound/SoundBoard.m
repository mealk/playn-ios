//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: tripleplay/sound/SoundBoard.java
//
//  Created by Thomas on 7/10/13.
//

#import "IOSClass.h"
#import "java/lang/Boolean.h"
#import "java/lang/Float.h"
#import "java/util/ArrayList.h"
#import "java/util/HashSet.h"
#import "java/util/Iterator.h"
#import "java/util/List.h"
#import "java/util/Set.h"
#import "playn/core/Assets.h"
#import "playn/core/PlayN.h"
#import "playn/core/Sound.h"
#import "pythagoras/f/MathUtil.h"
#import "react/Connection.h"
#import "react/Value.h"
#import "tripleplay/sound/Clip.h"
#import "tripleplay/sound/Loop.h"
#import "tripleplay/sound/SoundBoard.h"
#import "tripleplay/util/Interpolator.h"
#import "tripleplay/sound/SoundBoard_Sub.h"

@implementation TripleplaySoundSoundBoard

@synthesize volume = volume_;
@synthesize muted = muted_;
@synthesize _active = _active_;
@synthesize _faders = _faders_;

+ (float)FADE_DURATION {
  return TripleplaySoundSoundBoard_FADE_DURATION;
}

- (id)init {
  if ((self = [super init])) {
    volume_ = [[TripleplaySoundSoundBoard_$1 alloc] initWithJavaLangFloat:[JavaLangFloat valueOfWithFloat:1.0f]];
    muted_ = ((ReactValue *) [ReactValue createWithId:[JavaLangBoolean valueOfWithBOOL:NO]]);
    _active_ = [[JavaUtilHashSet alloc] init];
    _faders_ = [[JavaUtilArrayList alloc] init];
    (void) [((ReactValue *) NIL_CHK(volume_)) connectWithReactValueView_Listener:[[TripleplaySoundSoundBoard_$2 alloc] initWithTripleplaySoundSoundBoard:self]];
    (void) [((ReactValue *) NIL_CHK(muted_)) connectWithReactValueView_Listener:[[TripleplaySoundSoundBoard_$3 alloc] initWithTripleplaySoundSoundBoard:self]];
  }
  return self;
}

- (void)updateWithInt:(int)delta {
  for (int ii = 0, ll = [((id<JavaUtilList>) NIL_CHK(_faders_)) size]; ii < ll; ii++) {
    if ([((TripleplaySoundSoundBoard_Fader *) [((id<JavaUtilList>) NIL_CHK(_faders_)) getWithInt:ii]) updateWithInt:delta]) {
      (void) [((id<JavaUtilList>) NIL_CHK(_faders_)) removeWithInt:ii--];
      ll--;
    }
  }
}

- (id<TripleplaySoundClip>)getClipWithNSString:(NSString *)path {
  return [[TripleplaySoundSoundBoard_$4 alloc] initWithTripleplaySoundSoundBoard:self withNSString:path];
}

- (id<TripleplaySoundLoop>)getLoopWithNSString:(NSString *)path {
  return [[TripleplaySoundSoundBoard_$5 alloc] initWithTripleplaySoundSoundBoard:self withNSString:path];
}

- (BOOL)shouldPlay {
  return ![((JavaLangBoolean *) [((ReactValue *) NIL_CHK(muted_)) get]) booleanValue] && [((JavaLangFloat *) [((ReactValue *) NIL_CHK(volume_)) get]) floatValue] > 0;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard *typedCopy = (TripleplaySoundSoundBoard *) copy;
  typedCopy.volume = volume_;
  typedCopy.muted = muted_;
  typedCopy._active = _active_;
  typedCopy._faders = _faders_;
}

@end
@implementation TripleplaySoundSoundBoard_ClipImpl_$1

@synthesize this$0 = this$0_;

- (BOOL)play {
  [this$0_ play];
  return YES;
}

- (void)stop {
  [this$0_ stop];
}

- (id)initWithTripleplaySoundSoundBoard_ClipImpl:(TripleplaySoundSoundBoard_ClipImpl *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_ClipImpl_$1 *typedCopy = (TripleplaySoundSoundBoard_ClipImpl_$1 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
@implementation TripleplaySoundSoundBoard_Fader

- (BOOL)updateWithInt:(int)delta {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (id)initWithTripleplaySoundSoundBoard:(TripleplaySoundSoundBoard *)outer$ {
  return [super init];
}

@end
@implementation TripleplaySoundSoundBoard_LazySound_$1

@synthesize this$1 = this$1_;
@synthesize _range = _range_;
@synthesize _elapsed = _elapsed_;
@synthesize val$fadeMillis = val$fadeMillis_;

- (BOOL)updateWithInt:(int)delta {
  _elapsed_ += delta;
  float vol = [((TripleplayUtilInterpolator *) NIL_CHK([TripleplayUtilInterpolator LINEAR])) applyWithFloat:0 withFloat:_range_ withFloat:_elapsed_ withFloat:val$fadeMillis_];
  [this$1_ updateVolumeWithFloat:vol];
  return (vol >= _range_);
}

- (id)initWithTripleplaySoundSoundBoard_LazySound:(TripleplaySoundSoundBoard_LazySound *)outer$
                                        withFloat:(float)capture$0 {
  if ((self = [super initWithTripleplaySoundSoundBoard:outer$.this$0])) {
    this$1_ = outer$;
    val$fadeMillis_ = capture$0;
    _range_ = [((JavaLangFloat *) [((ReactValue *) NIL_CHK(outer$.this$0.volume)) get]) floatValue];
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_LazySound_$1 *typedCopy = (TripleplaySoundSoundBoard_LazySound_$1 *) copy;
  typedCopy.this$1 = this$1_;
  typedCopy._range = _range_;
  typedCopy._elapsed = _elapsed_;
  typedCopy.val$fadeMillis = val$fadeMillis_;
}

@end
@implementation TripleplaySoundSoundBoard_LazySound_$2

@synthesize this$1 = this$1_;
@synthesize _start = _start_;
@synthesize _elapsed = _elapsed_;
@synthesize val$fadeMillis = val$fadeMillis_;

- (BOOL)updateWithInt:(int)delta {
  _elapsed_ += delta;
  float vol = [((TripleplayUtilInterpolator *) NIL_CHK([TripleplayUtilInterpolator LINEAR])) applyWithFloat:_start_ withFloat:-_start_ withFloat:_elapsed_ withFloat:val$fadeMillis_];
  [this$1_ updateVolumeWithFloat:vol];
  if (vol > 0) return NO;
  else {
    [this$1_ fadeOutComplete];
    return YES;
  }
}

- (id)initWithTripleplaySoundSoundBoard_LazySound:(TripleplaySoundSoundBoard_LazySound *)outer$
                                        withFloat:(float)capture$0 {
  if ((self = [super initWithTripleplaySoundSoundBoard:outer$.this$0])) {
    this$1_ = outer$;
    val$fadeMillis_ = capture$0;
    _start_ = [((JavaLangFloat *) [((ReactValue *) NIL_CHK(outer$.this$0.volume)) get]) floatValue];
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_LazySound_$2 *typedCopy = (TripleplaySoundSoundBoard_LazySound_$2 *) copy;
  typedCopy.this$1 = this$1_;
  typedCopy._start = _start_;
  typedCopy._elapsed = _elapsed_;
  typedCopy.val$fadeMillis = val$fadeMillis_;
}

@end

@implementation TripleplaySoundSoundBoard_$2

@synthesize this$0 = this$0_;

- (void)onEmitWithId:(JavaLangFloat *)volume {
  {
    id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilSet>) NIL_CHK(this$0_._active)) iterator]);
    while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
      TripleplaySoundSoundBoard_LoopImpl *active = ((TripleplaySoundSoundBoard_LoopImpl *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
      [((TripleplaySoundSoundBoard_LoopImpl *) NIL_CHK(active)) updateVolumeWithFloat:[((JavaLangFloat *) NIL_CHK(volume)) floatValue]];
    }
  }
}

- (id)initWithTripleplaySoundSoundBoard:(TripleplaySoundSoundBoard *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_$2 *typedCopy = (TripleplaySoundSoundBoard_$2 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
@implementation TripleplaySoundSoundBoard_$3

@synthesize this$0 = this$0_;

- (void)onEmitWithId:(JavaLangBoolean *)muted {
  {
    id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilSet>) NIL_CHK(this$0_._active)) iterator]);
    while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
      TripleplaySoundSoundBoard_LoopImpl *active = ((TripleplaySoundSoundBoard_LoopImpl *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
      [((TripleplaySoundSoundBoard_LoopImpl *) NIL_CHK(active)) fadeForMuteWithBOOL:[((JavaLangBoolean *) NIL_CHK(muted)) booleanValue]];
    }
  }
}

- (id)initWithTripleplaySoundSoundBoard:(TripleplaySoundSoundBoard *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_$3 *typedCopy = (TripleplaySoundSoundBoard_$3 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
@implementation TripleplaySoundSoundBoard_LazySound

@synthesize this$0 = this$0_;
@synthesize sound = sound_;
@synthesize _volume = _volume_;

- (BOOL)isPlaying {
  return (sound_ == nil) ? NO : [((id<PlaynCoreSound>) NIL_CHK(sound_)) isPlaying];
}

- (void)setVolumeWithFloat:(float)volume {
  _volume_ = volume;
  [self updateVolumeWithFloat:[((JavaLangFloat *) [((ReactValue *) NIL_CHK(this$0_.volume)) get]) floatValue]];
}

- (float)volume {
  return _volume_;
}

- (void)release__ {
  if (sound_ != nil) {
    if ([sound_ isPlaying]) [sound_ stop];
    [sound_ release__];
    sound_ = nil;
  }
}

- (NSUInteger)hash {
  return [[self path] hash];
}

- (BOOL)isEqual:(id)other {
  return (other == self) ? YES : (other != nil) && [NIL_CHK(other) getClass] == [self getClass] && [[self path] isEqual:[((TripleplaySoundSoundBoard_LazySound *) other) path]];
}

- (void)updateVolumeWithFloat:(float)volume {
  if ([self isPlaying]) {
    float effectiveVolume = volume * _volume_;
    if (effectiveVolume > 0) [((id<PlaynCoreSound>) NIL_CHK(sound_)) setVolumeWithFloat:effectiveVolume];
    else [((id<PlaynCoreSound>) NIL_CHK(sound_)) stop];
  }
}

- (void)startFadeInWithFloat:(float)fadeMillis {
  if (![self isPlaying]) [((id<PlaynCoreSound>) [self prepareSound]) play];
  [((id<PlaynCoreSound>) NIL_CHK(sound_)) setVolumeWithFloat:0];
  [((id<JavaUtilList>) NIL_CHK(this$0_._faders)) addWithId:[[TripleplaySoundSoundBoard_LazySound_$1 alloc] initWithTripleplaySoundSoundBoard_LazySound:self withFloat:fadeMillis]];
}

- (void)startFadeOutWithFloat:(float)fadeMillis {
  if ([self isPlaying]) [((id<JavaUtilList>) NIL_CHK(this$0_._faders)) addWithId:[[TripleplaySoundSoundBoard_LazySound_$2 alloc] initWithTripleplaySoundSoundBoard_LazySound:self withFloat:fadeMillis]];
}

- (id<PlaynCoreSound>)prepareSound {
  if (sound_ == nil) sound_ = [self loadSoundWithNSString:[self path]];
  [((id<PlaynCoreSound>) NIL_CHK(sound_)) setVolumeWithFloat:[((JavaLangFloat *) [((ReactValue *) NIL_CHK(this$0_.volume)) get]) floatValue] * _volume_];
  return sound_;
}

- (void)fadeOutComplete {
}

- (id<PlaynCoreSound>)loadSoundWithNSString:(NSString *)path {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (NSString *)path {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (void)play {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
}

- (void)stop {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
}

- (id)initWithTripleplaySoundSoundBoard:(TripleplaySoundSoundBoard *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
    _volume_ = 1;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_LazySound *typedCopy = (TripleplaySoundSoundBoard_LazySound *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy.sound = sound_;
  typedCopy._volume = _volume_;
}

@end
@implementation TripleplaySoundSoundBoard_ClipImpl

@synthesize this$1 = this$1_;

- (void)preload {
  if ([this$1_ shouldPlay]) (void) [self prepareSound];
}

- (void)play {
  if ([this$1_ shouldPlay]) [((id<PlaynCoreSound>) [self prepareSound]) play];
}

- (void)fadeInWithFloat:(float)fadeMillis {
  if ([this$1_ shouldPlay]) [self startFadeInWithFloat:fadeMillis];
}

- (void)fadeOutWithFloat:(float)fadeMillis {
  if ([this$1_ shouldPlay]) [self startFadeOutWithFloat:fadeMillis];
}

- (void)stop {
  if ([self isPlaying]) [((id<PlaynCoreSound>) NIL_CHK(sound_)) stop];
}

- (id<PlaynCoreSound>)asSound {
  return [[TripleplaySoundSoundBoard_ClipImpl_$1 alloc] initWithTripleplaySoundSoundBoard_ClipImpl:self];
}

- (NSString *)description {
  return [NSString stringWithFormat:@"clip:%@", sound_];
}

- (id<PlaynCoreSound>)loadSoundWithNSString:(NSString *)path {
  return [((id<PlaynCoreAssets>) [PlaynCorePlayN assets]) getSoundWithNSString:path];
}

- (id)initWithTripleplaySoundSoundBoard:(TripleplaySoundSoundBoard *)outer$ {
  if ((self = [super initWithTripleplaySoundSoundBoard:outer$])) {
    this$1_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_ClipImpl *typedCopy = (TripleplaySoundSoundBoard_ClipImpl *) copy;
  typedCopy.this$1 = this$1_;
}

@end
@implementation TripleplaySoundSoundBoard_$4

@synthesize val$path = val$path_;

- (NSString *)path {
  return val$path_;
}

- (id)initWithTripleplaySoundSoundBoard:(TripleplaySoundSoundBoard *)outer$
                           withNSString:(NSString *)capture$0 {
  if ((self = [super initWithTripleplaySoundSoundBoard:outer$])) {
    val$path_ = capture$0;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_$4 *typedCopy = (TripleplaySoundSoundBoard_$4 *) copy;
  typedCopy.val$path = val$path_;
}

@end
@implementation TripleplaySoundSoundBoard_LoopImpl

@synthesize this$1 = this$1_;

- (void)fadeForMuteWithBOOL:(BOOL)muted {
  if (muted) [self startFadeOutWithFloat:TripleplaySoundSoundBoard_FADE_DURATION];
  else [self startFadeInWithFloat:TripleplaySoundSoundBoard_FADE_DURATION];
}

- (void)play {
  if (![((id<JavaUtilSet>) NIL_CHK(this$1_._active)) addWithId:self]) return;
  if ([this$1_ shouldPlay] && ![self isPlaying]) [((id<PlaynCoreSound>) [self prepareSound]) play];
}

- (void)fadeInWithFloat:(float)fadeMillis {
  if ([((id<JavaUtilSet>) NIL_CHK(this$1_._active)) addWithId:self] && [this$1_ shouldPlay]) [self startFadeInWithFloat:fadeMillis];
}

- (void)fadeOutWithFloat:(float)fadeMillis {
  if ([((id<JavaUtilSet>) NIL_CHK(this$1_._active)) removeWithId:self] && [this$1_ shouldPlay]) [self startFadeOutWithFloat:fadeMillis];
}

- (void)stop {
  if ([((id<JavaUtilSet>) NIL_CHK(this$1_._active)) removeWithId:self] && [self isPlaying]) [((id<PlaynCoreSound>) NIL_CHK(sound_)) stop];
}

- (NSString *)description {
  return [NSString stringWithFormat:@"loop:%@", sound_];
}

- (id<PlaynCoreSound>)prepareSound {
  id<PlaynCoreSound> sound = [super prepareSound];
  [((id<PlaynCoreSound>) NIL_CHK(sound)) setLoopingWithBOOL:YES];
  return sound;
}

- (void)fadeOutComplete {
  [((id<PlaynCoreSound>) NIL_CHK(sound_)) release__];
  sound_ = nil;
}

- (id<PlaynCoreSound>)loadSoundWithNSString:(NSString *)path {
  return [((id<PlaynCoreAssets>) [PlaynCorePlayN assets]) getMusicWithNSString:path];
}

- (id)initWithTripleplaySoundSoundBoard:(TripleplaySoundSoundBoard *)outer$ {
  if ((self = [super initWithTripleplaySoundSoundBoard:outer$])) {
    this$1_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_LoopImpl *typedCopy = (TripleplaySoundSoundBoard_LoopImpl *) copy;
  typedCopy.this$1 = this$1_;
}

@end
@implementation TripleplaySoundSoundBoard_$5

@synthesize val$path = val$path_;

- (NSString *)path {
  return val$path_;
}

- (id)initWithTripleplaySoundSoundBoard:(TripleplaySoundSoundBoard *)outer$
                           withNSString:(NSString *)capture$0 {
  if ((self = [super initWithTripleplaySoundSoundBoard:outer$])) {
    val$path_ = capture$0;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySoundSoundBoard_$5 *typedCopy = (TripleplaySoundSoundBoard_$5 *) copy;
  typedCopy.val$path = val$path_;
}

@end
