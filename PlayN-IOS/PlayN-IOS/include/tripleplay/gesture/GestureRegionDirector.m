//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: tripleplay/gesture/GestureRegionDirector.java
//
//  Created by Thomas on 7/25/13.
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "java/lang/Integer.h"
#include "java/util/Collection.h"
#include "java/util/HashMap.h"
#include "java/util/HashSet.h"
#include "java/util/Iterator.h"
#include "java/util/Map.h"
#include "java/util/Set.h"
#include "playn/core/Connection.h"
#include "playn/core/Layer.h"
#include "playn/core/Touch.h"
#include "pythagoras/f/IRectangle.h"
#include "pythagoras/f/Point.h"
#include "pythagoras/f/Rectangle.h"
#include "tripleplay/gesture/GestureDirector.h"
#include "tripleplay/gesture/GestureRegionDirector.h"
#include "tripleplay/gesture/Log.h"
#include "tripleplay/util/Logger.h"
#include "tripleplay/util/Timer.h"

@implementation TripleplayGestureGestureRegionDirector

@synthesize _timer = _timer_;
@synthesize _bounds = _bounds_;
@synthesize _connection = _connection_;
@synthesize _activeTouches = _activeTouches_;
@synthesize _ignoredTouches = _ignoredTouches_;
@synthesize _regions = _regions_;

- (id)initTripleplayGestureGestureRegionDirectorWithTripleplayUtilTimer:(TripleplayUtilTimer *)timer {
  if ((self = [super init])) {
    _activeTouches_ = [[JavaUtilHashMap alloc] init];
    _ignoredTouches_ = [[JavaUtilHashSet alloc] init];
    _regions_ = [[JavaUtilHashMap alloc] init];
    _timer_ = timer;
  }
  return self;
}

- (id)initWithTripleplayUtilTimer:(TripleplayUtilTimer *)timer {
  return [self initTripleplayGestureGestureRegionDirectorWithTripleplayUtilTimer:timer];
}

- (id)initWithTripleplayUtilTimer:(TripleplayUtilTimer *)timer
               withPlaynCoreLayer:(id<PlaynCoreLayer>)layer
        withPythagorasFIRectangle:(id<PythagorasFIRectangle>)bounds {
  if ((self = [self initTripleplayGestureGestureRegionDirectorWithTripleplayUtilTimer:timer])) {
    (void) [self setLayerWithPlaynCoreLayer:layer withPythagorasFIRectangle:bounds];
  }
  return self;
}

- (TripleplayGestureGestureRegionDirector *)setLayerWithPlaynCoreLayer:(id<PlaynCoreLayer>)layer
                                             withPythagorasFIRectangle:(id<PythagorasFIRectangle>)bounds {
  [self remove];
  _bounds_ = bounds;
  (void) [((id<PlaynCoreLayer>) nil_chk(layer)) setHitTesterWithPlaynCoreLayer_HitTester:[[TripleplayGestureGestureRegionDirector_$1 alloc] initWithTripleplayGestureGestureRegionDirector:self]];
  _connection_ = [((id<PlaynCoreLayer>) nil_chk(layer)) addListenerWithPlaynCoreTouch_LayerListener:self];
  return self;
}

- (void)remove {
  if (_connection_ != nil) [_connection_ disconnect];
}

- (id<JavaUtilCollection>)getRegions {
  return [((id<JavaUtilMap>) nil_chk(_regions_)) values];
}

- (TripleplayGestureGestureDirector *)getRegionWithFloat:(float)x
                                               withFloat:(float)y
                                               withFloat:(float)width
                                               withFloat:(float)height {
  return [self getRegionWithPythagorasFIRectangle:[[PythagorasFRectangle alloc] initWithFloat:x withFloat:y withFloat:width withFloat:height]];
}

- (TripleplayGestureGestureDirector *)getRegionWithPythagorasFIRectangle:(id<PythagorasFIRectangle>)bounds {
  if (![((id<PythagorasFIRectangle>) nil_chk(_bounds_)) intersectsWithPythagorasFIRectangle:bounds]) {
    [((TripleplayUtilLogger *) nil_chk([TripleplayGestureLog log])) warningWithNSString:@"Supplied region is not within our defined bounds" withNSObjectArray:[IOSObjectArray arrayWithObjects:(id[]){ @"_bounds", _bounds_, @"bounds", bounds } count:4 type:[IOSClass classWithClass:[NSObject class]]]];
    return nil;
  }
  PythagorasFRectangle *regionBounds = [((id<PythagorasFIRectangle>) nil_chk(_bounds_)) intersectionWithPythagorasFIRectangle:bounds];
  TripleplayGestureGestureDirector *region = [((id<JavaUtilMap>) nil_chk(_regions_)) getWithId:regionBounds];
  if (region != nil) return region;
  {
    id<JavaUtilIterator> iter__ = [((id<JavaUtilSet>) nil_chk([((id<JavaUtilMap>) nil_chk(_regions_)) keySet])) iterator];
    while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
      PythagorasFRectangle *existingRegionBounds = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
      if ([((PythagorasFRectangle *) nil_chk(existingRegionBounds)) intersectsWithPythagorasFIRectangle:regionBounds]) {
        [((TripleplayUtilLogger *) nil_chk([TripleplayGestureLog log])) warningWithNSString:@"New region intersects existing region" withNSObjectArray:[IOSObjectArray arrayWithObjects:(id[]){ @"existing", existingRegionBounds, @"new", regionBounds } count:4 type:[IOSClass classWithClass:[NSObject class]]]];
        return nil;
      }
    }
  }
  region = [[TripleplayGestureGestureDirector alloc] initWithPythagorasFIRectangle:regionBounds withTripleplayUtilTimer:_timer_];
  (void) [((id<JavaUtilMap>) nil_chk(_regions_)) putWithId:regionBounds withId:region];
  return region;
}

- (TripleplayGestureGestureDirector *)getPercentRegionWithFloat:(float)perX
                                                      withFloat:(float)perY
                                                      withFloat:(float)perWidth
                                                      withFloat:(float)perHeight {
  return [self getRegionWithFloat:[self applyPercentXWithFloat:perX] withFloat:[self applyPercentYWithFloat:perY] withFloat:[self applyPercentXWithFloat:perWidth] withFloat:[self applyPercentYWithFloat:perHeight]];
}

- (TripleplayGestureGestureDirector *)getPercentRegionWithPythagorasFIRectangle:(id<PythagorasFIRectangle>)bounds {
  return [self getRegionWithFloat:[((id<PythagorasFIRectangle>) nil_chk(bounds)) x] withFloat:[((id<PythagorasFIRectangle>) nil_chk(bounds)) y] withFloat:[((id<PythagorasFIRectangle>) nil_chk(bounds)) width] withFloat:[((id<PythagorasFIRectangle>) nil_chk(bounds)) height]];
}

- (void)onTouchStartWithPlaynCoreTouch_Event:(id<PlaynCoreTouch_Event>)event {
  if ([((id<JavaUtilMap>) nil_chk(_regions_)) isEmpty]) return;
  {
    id<JavaUtilIterator> iter__ = [((id<JavaUtilCollection>) nil_chk([((id<JavaUtilMap>) nil_chk(_regions_)) values])) iterator];
    while ([((id<JavaUtilIterator>) nil_chk(iter__)) hasNext]) {
      TripleplayGestureGestureDirector *mgr = [((id<JavaUtilIterator>) nil_chk(iter__)) next];
      if ([((TripleplayGestureGestureDirector *) nil_chk(mgr)) touchInBoundsWithPlaynCoreTouch_Event:event]) {
        (void) [((id<JavaUtilMap>) nil_chk(_activeTouches_)) putWithId:[JavaLangInteger valueOfWithInt:[((id<PlaynCoreTouch_Event>) nil_chk(event)) id__]] withId:[[TripleplayGestureGestureRegionDirector_TrackedTouch alloc] initWithTripleplayGestureGestureDirector:mgr withPlaynCoreTouch_Event:event]];
        [((TripleplayGestureGestureDirector *) nil_chk(mgr)) onTouchStartWithPlaynCoreTouch_Event:event];
        return;
      }
    }
  }
  [((id<JavaUtilSet>) nil_chk(_ignoredTouches_)) addWithId:[JavaLangInteger valueOfWithInt:[((id<PlaynCoreTouch_Event>) nil_chk(event)) id__]]];
}

- (void)onTouchMoveWithPlaynCoreTouch_Event:(id<PlaynCoreTouch_Event>)event {
  if ([((id<JavaUtilMap>) nil_chk(_regions_)) isEmpty]) return;
  TripleplayGestureGestureRegionDirector_TrackedTouch *touch = [((id<JavaUtilMap>) nil_chk(_activeTouches_)) getWithId:[JavaLangInteger valueOfWithInt:[((id<PlaynCoreTouch_Event>) nil_chk(event)) id__]]];
  if (touch == nil && ![((id<JavaUtilSet>) nil_chk(_ignoredTouches_)) containsWithId:[JavaLangInteger valueOfWithInt:[((id<PlaynCoreTouch_Event>) nil_chk(event)) id__]]]) {
    [((TripleplayUtilLogger *) nil_chk([TripleplayGestureLog log])) warningWithNSString:@"No start for move event" withNSObjectArray:[IOSObjectArray arrayWithObjects:(id[]){ @"event", event } count:2 type:[IOSClass classWithClass:[NSObject class]]]];
  }
  else if (touch != nil) {
    [((TripleplayGestureGestureDirector *) nil_chk(touch.region)) onTouchMoveWithPlaynCoreTouch_Event:event];
  }
}

- (void)onTouchEndWithPlaynCoreTouch_Event:(id<PlaynCoreTouch_Event>)event {
  if ([((id<JavaUtilMap>) nil_chk(_regions_)) isEmpty]) return;
  TripleplayGestureGestureRegionDirector_TrackedTouch *touch = [((id<JavaUtilMap>) nil_chk(_activeTouches_)) removeWithId:[JavaLangInteger valueOfWithInt:[((id<PlaynCoreTouch_Event>) nil_chk(event)) id__]]];
  if (![((id<JavaUtilSet>) nil_chk(_ignoredTouches_)) removeWithId:[JavaLangInteger valueOfWithInt:[((id<PlaynCoreTouch_Event>) nil_chk(event)) id__]]] && touch == nil) {
    [((TripleplayUtilLogger *) nil_chk([TripleplayGestureLog log])) warningWithNSString:@"No start for end event" withNSObjectArray:[IOSObjectArray arrayWithObjects:(id[]){ @"event", event } count:2 type:[IOSClass classWithClass:[NSObject class]]]];
  }
  else if (touch != nil) {
    [((TripleplayGestureGestureDirector *) nil_chk(touch.region)) onTouchEndWithPlaynCoreTouch_Event:event];
  }
}

- (void)onTouchCancelWithPlaynCoreTouch_Event:(id<PlaynCoreTouch_Event>)event {
  if ([((id<JavaUtilMap>) nil_chk(_regions_)) isEmpty]) return;
  TripleplayGestureGestureRegionDirector_TrackedTouch *touch = [((id<JavaUtilMap>) nil_chk(_activeTouches_)) removeWithId:[JavaLangInteger valueOfWithInt:[((id<PlaynCoreTouch_Event>) nil_chk(event)) id__]]];
  if (![((id<JavaUtilSet>) nil_chk(_ignoredTouches_)) removeWithId:[JavaLangInteger valueOfWithInt:[((id<PlaynCoreTouch_Event>) nil_chk(event)) id__]]] && touch == nil) {
    [((TripleplayUtilLogger *) nil_chk([TripleplayGestureLog log])) warningWithNSString:@"No start for cancel event" withNSObjectArray:[IOSObjectArray arrayWithObjects:(id[]){ @"event", event } count:2 type:[IOSClass classWithClass:[NSObject class]]]];
  }
  else if (touch != nil) {
    [((TripleplayGestureGestureDirector *) nil_chk(touch.region)) onTouchCancelWithPlaynCoreTouch_Event:event];
  }
}

- (float)applyPercentXWithFloat:(float)x {
  return [((id<PythagorasFIRectangle>) nil_chk(_bounds_)) x] + [((id<PythagorasFIRectangle>) nil_chk(_bounds_)) width] * x;
}

- (float)applyPercentYWithFloat:(float)y {
  return [((id<PythagorasFIRectangle>) nil_chk(_bounds_)) y] + [((id<PythagorasFIRectangle>) nil_chk(_bounds_)) height] * y;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayGestureGestureRegionDirector *typedCopy = (TripleplayGestureGestureRegionDirector *) copy;
  typedCopy._timer = _timer_;
  typedCopy._bounds = _bounds_;
  typedCopy._connection = _connection_;
  typedCopy._activeTouches = _activeTouches_;
  typedCopy._ignoredTouches = _ignoredTouches_;
  typedCopy._regions = _regions_;
}

@end
@implementation TripleplayGestureGestureRegionDirector_TrackedTouch

@synthesize region = region_;
@synthesize startEvent = startEvent_;

- (id)initWithTripleplayGestureGestureDirector:(TripleplayGestureGestureDirector *)region
                      withPlaynCoreTouch_Event:(id<PlaynCoreTouch_Event>)startEvent {
  if ((self = [super init])) {
    self.region = region;
    self.startEvent = startEvent;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayGestureGestureRegionDirector_TrackedTouch *typedCopy = (TripleplayGestureGestureRegionDirector_TrackedTouch *) copy;
  typedCopy.region = region_;
  typedCopy.startEvent = startEvent_;
}

@end
@implementation TripleplayGestureGestureRegionDirector_$1

@synthesize this$0 = this$0_;

- (id<PlaynCoreLayer>)hitTestWithPlaynCoreLayer:(id<PlaynCoreLayer>)layer
                           withPythagorasFPoint:(PythagorasFPoint *)p {
  return [((id<PythagorasFIRectangle>) nil_chk(this$0_._bounds)) containsWithFloat:((PythagorasFPoint *) nil_chk(p)).x_ withFloat:((PythagorasFPoint *) nil_chk(p)).y_] ? layer : nil;
}

- (id)initWithTripleplayGestureGestureRegionDirector:(TripleplayGestureGestureRegionDirector *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayGestureGestureRegionDirector_$1 *typedCopy = (TripleplayGestureGestureRegionDirector_$1 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
