//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: tripleplay/syncdb/DBUtil.java
//
//  Created by Thomas on 7/10/13.
//

#import "IOSObjectArray.h"
#import "java/lang/Iterable.h"
#import "java/lang/StringBuilder.h"
#import "java/util/ArrayList.h"
#import "java/util/Collection.h"
#import "java/util/HashSet.h"
#import "java/util/Iterator.h"
#import "java/util/List.h"
#import "java/util/Set.h"
#import "tripleplay/syncdb/Codec.h"
#import "tripleplay/syncdb/DBUtil.h"

@implementation TripleplaySyncdbDBUtil

static NSString * TripleplaySyncdbDBUtil_MAP_KEY_SEP_ = @"~";
static NSString * TripleplaySyncdbDBUtil_SUBDB_KEY_SEP_ = @"!";

+ (NSString *)MAP_KEY_SEP {
  return TripleplaySyncdbDBUtil_MAP_KEY_SEP_;
}

+ (NSString *)SUBDB_KEY_SEP {
  return TripleplaySyncdbDBUtil_SUBDB_KEY_SEP_;
}

+ (id<JavaUtilSet>)decodeSetWithNSString:(NSString *)data
               withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)codec {
  return ((JavaUtilHashSet *) [TripleplaySyncdbDBUtil decodeWithNSString:data withTripleplaySyncdbCodec:codec withId:[[JavaUtilHashSet alloc] init]]);
}

+ (NSString *)encodeSetWithJavaUtilSet:(id<JavaUtilSet>)set
             withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)codec {
  return [TripleplaySyncdbDBUtil encodeWithJavaLangIterable:set withTripleplaySyncdbCodec:codec];
}

+ (id<JavaUtilList>)decodeListWithNSString:(NSString *)data
                 withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)codec {
  return ((JavaUtilArrayList *) [TripleplaySyncdbDBUtil decodeWithNSString:data withTripleplaySyncdbCodec:codec withId:[[JavaUtilArrayList alloc] init]]);
}

+ (NSString *)encodeListWithJavaUtilList:(id<JavaUtilList>)list
               withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)codec {
  return [TripleplaySyncdbDBUtil encodeWithJavaLangIterable:list withTripleplaySyncdbCodec:codec];
}

+ (NSString *)subDBKeyWithNSString:(NSString *)prefix
                      withNSString:(NSString *)key {
  return [NSString stringWithFormat:@"%@!%@", prefix, key];
}

+ (NSString *)subDBWithNSString:(NSString *)fqKey {
  int sidx = [NIL_CHK(fqKey) indexOfString:TripleplaySyncdbDBUtil_SUBDB_KEY_SEP_];
  return (sidx < 0) ? nil : [NIL_CHK(fqKey) substring:0 endIndex:sidx];
}

+ (NSString *)mapKeyWithNSString:(NSString *)prefix
                          withId:(id)key
       withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)codec {
  return [NSString stringWithFormat:@"%@~%@", prefix, [((TripleplaySyncdbCodec *) NIL_CHK(codec)) encodeWithId:key]];
}

+ (NSString *)encodeWithJavaLangIterable:(id<JavaLangIterable>)values
               withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)codec {
  JavaLangStringBuilder *buf = [[JavaLangStringBuilder alloc] init];
  {
    id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaLangIterable>) NIL_CHK(values)) iterator]);
    while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
      id elem = [((id<JavaUtilIterator>) NIL_CHK(iter__)) next];
      if ([((JavaLangStringBuilder *) NIL_CHK(buf)) sequenceLength] > 0) (void) [((JavaLangStringBuilder *) NIL_CHK(buf)) appendWithNSString:@"\t"];
      (void) [((JavaLangStringBuilder *) NIL_CHK(buf)) appendWithNSString:[((TripleplaySyncdbCodec *) NIL_CHK(codec)) encodeWithId:elem]];
    }
  }
  return [((JavaLangStringBuilder *) NIL_CHK(buf)) description];
}

+ (id)decodeWithNSString:(NSString *)data
withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)codec
                  withId:(id<JavaUtilCollection>)into {
  if (data != nil && [NIL_CHK(data) length] > 0) {
    {
      IOSObjectArray *a__ = [NIL_CHK(data) split:@"\t"];
      int n__ = (int) [((IOSObjectArray *) NIL_CHK(a__)) count];
      for (int i__ = 0; i__ < n__; i__++) {
        NSString *edata = ((NSString *) [((IOSObjectArray *) NIL_CHK(a__)) objectAtIndex:i__]);
        [((id<JavaUtilCollection>) NIL_CHK(into)) addWithId:[((TripleplaySyncdbCodec *) NIL_CHK(codec)) decodeWithNSString:edata]];
      }
    }
  }
  return into;
}

- (id)init {
  return [super init];
}

@end
