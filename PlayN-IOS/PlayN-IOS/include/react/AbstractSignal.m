//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: react/AbstractSignal.java
//
//  Created by Thomas on 7/10/13.
//

#import "java/lang/Throwable.h"
#import "react/AbstractSignal.h"
#import "react/Connection.h"
#import "react/Cons.h"
#import "react/Function.h"
#import "react/MultiFailureException.h"
#import "react/Reactor.h"
#import "react/SignalView.h"
#import "react/Slot.h"
#import "react/AbstractSignal_Sub.h"

@implementation ReactAbstractSignal

- (id<ReactSignalView>)mapWithReactFunction:(id<ReactFunction>)func {
  ReactAbstractSignal *outer = self;
  return [[ReactAbstractSignal_$1 alloc] initWithReactAbstractSignal:outer withReactFunction:func];
}

- (id<ReactConnection>)connectWithReactSlot:(ReactSlot *)slot {
  ReactSlot *casted = (ReactSlot *) slot;
  return ((ReactCons *) [self addConnectionWithId:casted]);
}

- (void)disconnectWithReactSlot:(ReactSlot *)slot {
  ReactSlot *casted = (ReactSlot *) slot;
  [self removeConnectionWithId:casted];
}

- (void)notifyEmitWithId:(id)event {
  ReactCons *lners = ((ReactCons *) [self prepareNotify]);
  ReactMultiFailureException *error = nil;
  @try {
    for (ReactCons * cons = lners; cons != nil; cons = ((ReactCons *) NIL_CHK(cons)).next) {
      @try {
        [((ReactSlot *) NIL_CHK(cons.listener)) onEmitWithId:event];
      }
      @catch (JavaLangThrowable *t) {
        if (error == nil) error = [[ReactMultiFailureException alloc] init];
        [((ReactMultiFailureException *) NIL_CHK(error)) addFailureWithJavaLangThrowable:t];
      }
      if (((ReactCons *) NIL_CHK(cons)).oneShot) [((ReactCons *) NIL_CHK(cons)) disconnect];
    }
  }
  @finally {
    [self finishNotifyWithReactCons:lners];
  }
  if (error != nil) [error trigger];
}

- (id)init {
  return [super init];
}

@end

@implementation ReactAbstractSignal_$1_$1

@synthesize this$0 = this$0_;

- (void)onEmitWithId:(id)value {
  [this$0_ notifyEmitWithId:[((id<ReactFunction>) NIL_CHK(this$0_.val$func)) applyWithId:value]];
}

- (id)initWithReactAbstractSignal_$1:(ReactAbstractSignal_$1 *)outer$ {
  if ((self = [super init])) {
    this$0_ = outer$;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  ReactAbstractSignal_$1_$1 *typedCopy = (ReactAbstractSignal_$1_$1 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
